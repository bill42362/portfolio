{"version":3,"sources":["webpack:///./src/client/js/component/App.jsx","webpack:///./src/client/img/x-men-school.svg","webpack:///./node_modules/three/examples/jsm/shaders/MMDToonShader.js","webpack:///./node_modules/three/examples/jsm/loaders/TGALoader.js","webpack:///./node_modules/three/examples/jsm/loaders/MMDLoader.js","webpack:///./node_modules/three/examples/jsm/loaders/DDSLoader.js","webpack:///./src/client/js/resource/isWebAssemblySupported.js","webpack:///./src/client/js/resource/loadScriptTag.js","webpack:///./src/client/model/Horkeukamui/Horkeukamui-160.pmx","webpack:///./src/client/model/Horkeukamui/tex/body_N.png","webpack:///./src/client/model/Horkeukamui/Horkeukamui-185.pmx","webpack:///./src/client/model/Horkeukamui/tex/body2_N.png","webpack:///./src/client/model/Horkeukamui/tex/body.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth_N.png","webpack:///./src/client/model/Horkeukamui/tex/body2.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth23_N.png","webpack:///./src/client/model/Horkeukamui/tex/cloth.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth2.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth3.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth4.dds","webpack:///./src/client/js/resource/horkeukamuiVariables.js","webpack:///./src/client/model/Horkeukamui/tex/head.dds","webpack:///./src/client/model/Horkeukamui/tex/nose.dds","webpack:///./src/client/model/Horkeukamui/tex/Penis.dds","webpack:///./src/client/model/Horkeukamui/tex/toon.dds","webpack:///./src/client/motion/wavefile_v2.vmd","webpack:///./src/client/js/component/Main.jsx","webpack:///./src/client/img/github-icon.svg","webpack:///./src/client/js/component/Footer.jsx","webpack:///./src/client/img/email-icon.svg","webpack:///./src/client/js/index.js","webpack:///(webpack)/buildin/global.js"],"names":["GlobalStyle","createGlobalStyle","styledNormalize","isServer","window","title","description","branchName","process","env","BRANCH_NAME","__SSR_ENVIRONMENT__","App","request","console","log","defaultTitle","titleTemplate","charSet","name","content","property","StyledApp","src","XMenLogoSource","propTypes","PropTypes","object","defaultProps","styled","div","Body","sheet","props","instance","MMDToonShader","defines","TOON","MATCAP","MATCAP_BLENDING_ADD","uniforms","merge","toon","phong","matcap","vertexShader","fragmentShader","replace","manager","super","buffer","TGA_TYPE_NO_DATA","TGA_TYPE_INDEXED","TGA_TYPE_RGB","TGA_TYPE_GREY","TGA_TYPE_RLE_INDEXED","TGA_TYPE_RLE_RGB","TGA_TYPE_RLE_GREY","TGA_ORIGIN_MASK","TGA_ORIGIN_SHIFT","TGA_ORIGIN_BL","TGA_ORIGIN_BR","TGA_ORIGIN_UL","TGA_ORIGIN_UR","length","error","offset","Uint8Array","header","id_length","colormap_type","image_type","colormap_index","colormap_length","colormap_size","origin","width","height","pixel_size","flags","tgaCheckHeader","use_rle","use_pal","use_grey","imageData","result","data","pixel_data","palettes","pixel_total","subarray","c","count","i","shift","pixels","set","tgaParse","image","palette","x_start","y_start","x_step","y_step","x_end","y_end","color","x","y","tgaGetImageDataGrey8bits","tgaGetImageDataGrey16bits","colormap","tgaGetImageData8bits","tgaGetImageData16bits","tgaGetImageData24bits","tgaGetImageData32bits","getTgaRGBA","flipY","generateMipmaps","minFilter","this","loader","parser","meshBuilder","animationBuilder","animationPath","url","onLoad","onProgress","onError","builder","setCrossOrigin","crossOrigin","resourcePath","path","extractUrlBase","modelExtension","_extractExtension","toLowerCase","build","Error","loadVMD","vmd","isCamera","buildCameraAnimation","modelUrl","vmdUrl","scope","load","mesh","loadAnimation","animation","_getParser","setMimeType","undefined","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","parsePmd","parsePmx","urls","Array","isArray","vmds","vmdNum","il","push","parseVmd","mergeVmds","isUnicode","text","parseVpd","index","lastIndexOf","slice","Parser","DEFAULT_TOON_TEXTURES","NON_ALPHA_CHANNEL_FORMATS","geometryBuilder","materialBuilder","geometry","material","setResourcePath","skeleton","bones","gbone","bone","position","fromArray","pos","quaternion","rotq","scl","scale","parent","add","updateMatrixWorld","initBones","bind","positions","uvs","normals","indices","groups","skinIndices","skinWeights","morphTargets","morphPositions","iks","grants","rigidBodies","constraints","boneTypeTable","metadata","vertexCount","v","vertices","j","jl","normal","uv","faceCount","face","faces","materialCount","materials","rigidBodyCount","body","value","boneIndex","type","Math","max","boneCount","boneData","transformationClass","parentIndex","rigidBodyType","format","ikCount","ik","param","target","effector","iteration","maxAngle","links","link","enabled","indexOf","limitation","angleLimitation","rotationMin","lowerLimitationAngle","rotationMax","upperLimitationAngle","tmp1","tmp2","grantEntryMap","grant","ratio","isLocal","affectRotation","affectPosition","children","visited","rootEntry","grantEntry","parentGrantEntry","traverse","entry","child","updateAttributes","attribute","morph","elementCount","element","elements","morphs","array","morphCount","params","morph2","rigidBody","key","constraintCount","constraint","bodyA","rigidBodyIndex1","bodyB","rigidBodyIndex2","setAttribute","setIndex","addGroup","morphAttributes","morphTargetsRelative","userData","MMD","computeBoundingSphere","textureLoader","tgaLoader","textures","diffuse","opacity","specular","shininess","emissive","ambient","transparent","fog","blending","blendSrc","blendDst","blendSrcAlpha","blendDstAlpha","flag","side","fileName","fileNames","split","map","_loadTexture","extension","envMap","combine","toonFileName","toonIndex","toonTextures","gradientMap","isToonTexture","isDefaultToonTexture","_isDefaultToonTexture","outlineParameters","thickness","edgeFlag","alpha","visible","isDefaultToon","textureIndex","mapFileName","envTextureIndex","envFlag","matcapFileName","matcapCombine","toonFlag","edgeSize","edgeColor","_checkImageTransparency","multiplyScalar","checkAlphaMorph","test","filePath","fullPath","parseInt","match","e","warn","getHandler","_getTGALoader","texture","t","_getRotatedImage","magFilter","wrapS","wrapT","readyCallbacks","canvas","document","createElement","context","getContext","clearRect","translate","rotate","PI","drawImage","getImageData","groupIndex","getAlphaByUv","round","isCompressedTexture","includes","createImageData","group","centerUV","detectImageTransparency","attributes","start","tracks","buildSkeletalAnimation","tracks2","buildMorphAnimation","pushInterpolation","interpolation","motions","boneNameDictionary","motionCount","motion","boneName","sort","a","b","frameNum","times","rotations","pInterpolations","rInterpolations","basePosition","getBoneByName","toArray","time","rotation","targetName","_createTrack","morphTargetDictionary","morphName","values","weight","pushVector3","vec","z","cameras","centers","quaternions","fovs","cInterpolations","qInterpolations","fInterpolations","euler","center","rot","distance","fov","setFromEuler","applyQuaternion","q","w","node","typedKeyframeTrack","interpolations","stride","interpolateStride","aheadIndex","endIndex","track","createInterpolant","getValueSize","Float32Array","parameterPositions","sampleValues","sampleSize","resultBuffer","interpolationParams","i1","t0","t1","valueSize","offset1","offset0","weight1","x1","x2","y1","y2","_calculate","slerpFlat","s","math","sst3","stt3","ttt","ft","abs","parameters","_matcapCombine","emissiveIntensity","normalMapType","wireframeLinecap","wireframeLinejoin","flatShading","lights","Object","assign","defineProperty","get","MATCAP_BLENDING_MULTIPLY","clone","exposePropertyNames","propertyName","getOwnPropertyDescriptor","setValues","source","copy","prototype","isMMDToonMaterial","loadMipmaps","dds","mipmaps","mipmapCount","fourCCToInt32","charCodeAt","loadARGBMip","dataOffset","dataLength","srcBuffer","byteArray","dst","g","r","FOURCC_DXT1","FOURCC_DXT3","FOURCC_DXT5","FOURCC_ETC1","Int32Array","blockBytes","fourCC","isRGBAUncompressed","String","fromCharCode","caps2","isCubemap","mipmap","isWebAssemblySupported","WebAssembly","instantiate","module","Module","of","Instance","nullFunction","loadScriptTag","id","async","rest","Promise","resolve","reject","scriptElement","getElementById","isScriptMounted","keys","forEach","isLoaded","isErrored","event","addEventListener","getElementsByTagName","appendChild","englishMap","pubicHair","fundoshiBack","fundoshiFront","bigFundoshiFront","penis","bigPenis","loadingManager","LoadingManager","addHandler","DDSLoader","TextureLoader","mmdLoader","MMDLoader","initControlKeys","lightControlsConfigs","intensity","min","step","shadowIntensity","shadowBoundry","needShadowHelper","positionX","positionY","positionZ","normalMapParing","BodyNormal","Body2Normal","ClothNormal","Cloth23Normal","Main","React","createRef","gui","camera","cameraControls","scene","light","lightWithShadow","renderer","rendererControlFolder","clock","loadingTimeout","animationFrame","animationControls","shouldAnimate","fps","animationToogleUI","horkeukamui","mmdPhysics","mmdAnimationHelper","MMDAnimationHelper","afterglow","controlObject","erection","controlUIObject","Light","Horkeukamui","HorkeukamuiMorphs","updateLights","lightHelper","update","castShadow","shadowHelper","shadow","left","right","top","bottom","updateProjectionMatrix","requestAnimationFrame","renderNextFrame","initScene","Scene","AxesHelper","DirectionalLight","DirectionalLightHelper","far","mapSize","normalBias","CameraHelper","addFolder","lightControl","lightControlUI","configKey","config","onChange","initRenderer","WebGLRenderer","current","antialias","physicallyCorrectLights","toneMappingExposure","shadowMap","PCFSoftShadowMap","setClearColor","initCamera","handleWindowResize","render","updateMorphControlValues","throttle","morphControls","morphKey","updateDisplay","tick","getDelta","clientWidth","clientHeight","PerspectiveCamera","OrbitControls","setSize","setPixelRatio","devicePixelRatio","aspect","getMaterial","find","m","addKamuiControlllers","kamuiControl","morphTargetInfluences","setValue","penisMaterial","bigPenisMaterial","isBigOne","targetKey","loadModels","loadWithAnimation","WaveMotion","receiveShadow","anisotropy","capabilities","getMaxAnisotropy","normalMapFilename","normalMap","RepeatWrapping","penisHair","controlKey","needDisplay","physics","enable","setTimeout","loadAmmoPromise","dat","hideable","closed","closeOnTop","Clock","stop","Ammo","AmmoLib","destory","cancelAnimationFrame","removeEventListener","clearTimeout","StyledMain","Canvas","ref","PureComponent","githubBaseUrl","Footer","email","githubUrl","StyledFooter","Link","href","GithubIcon","alt","string","ReactDOM","Function","exports"],"mappings":"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","file":"js/bundle~bundle~31ecd969.bd46e26b.js","sourcesContent":["// App.jsx\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { hot } from 'react-hot-loader/root';\nimport styled, {\n  createGlobalStyle,\n  StyleSheetManager,\n} from 'styled-components';\nimport styledNormalize from 'styled-normalize';\nimport { Helmet } from 'react-helmet';\n\nimport Main from '../component/Main.jsx';\nimport Footer from '../component/Footer.jsx';\nimport XMenLogoSource from '../../img/x-men-school.svg';\n\nconst GlobalStyle = createGlobalStyle`\n  ${styledNormalize};\n  *, ::after, ::before { box-sizing: border-box; }\n  body {\n    background-color: #101010;\n    color: #efefef;\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\",\n      Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n    font-weight: 400;\n    -webkit-tap-highlight-color: transparent;\n    overscroll-behavior-y: contain;\n  }\n  button {\n    background-color: rgba(0, 0, 0, 0);\n    cursor: pointer;\n    &:disabled {\n      cursor: not-allowed;\n    }\n  }\n  input::placeholder,\n  input::-webkit-input-placeholder,\n  input::-moz-placeholder {\n    line-height: normal !important;\n    vertical-align: middle;\n  }\n  a { color: inherit; text-decoration: none; }\n  a > * { opacity: inherit; }\n  a:hover { opacity: .7; }\n`;\n\nconst isServer = typeof window === 'undefined';\nconst title = 'Portfolio';\nconst description = \"Bill's portfolio\";\nconst branchName = isServer\n  ? process.env.BRANCH_NAME\n  : window.__SSR_ENVIRONMENT__.branchName;\n\nconst App = ({ request }) => {\n  // eslint-disable-next-line no-console\n  console.log('App() request:', request);\n  return (\n    <>\n      <Helmet defaultTitle=\"Portfolio\" titleTemplate=\"%s - Portfolio\">\n        <meta charSet=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n\n        <meta name=\"author\" content=\"Bill\" />\n        <meta name=\"description\" content={description} />\n\n        <meta\n          property=\"og:url\"\n          content=\"https://github.com/bill42362/portfolio\"\n        />\n        <meta property=\"og:type\" content=\"website\" />\n        <meta property=\"og:title\" content={title} />\n        <meta property=\"og:description\" content={description} />\n        <meta property=\"og:site_name\" content={title} />\n        <meta property=\"twitter:card\" content=\"summary\" />\n        <meta property=\"twitter:site\" content=\"@bill_portfolio\" />\n        {/* <meta property=\"twitter:image\" content={twitterImageSource} /> */}\n      </Helmet>\n      <GlobalStyle />\n      <StyledApp>\n        {!window && <img src={XMenLogoSource} title=\"Xavier school\" />}\n        <Main />\n        <Footer branchName={branchName} />\n      </StyledApp>\n    </>\n  );\n};\n\nApp.propTypes = {\n  request: PropTypes.object,\n};\n\nApp.defaultProps = {\n  request: null,\n};\n\nconst StyledApp = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  height: 100vh;\n  background-color: #222f3e;\n`;\n\nconst Body = ({ sheet, ...props }) => {\n  if (sheet.instance) {\n    return (\n      <StyleSheetManager sheet={sheet.instance}>\n        <App {...props} />\n      </StyleSheetManager>\n    );\n  } else {\n    return <App {...props} />;\n  }\n};\n\nBody.propTypes = {\n  ...App.propTypes,\n  sheet: PropTypes.object,\n};\n\nBody.defaultProps = {\n  ...App.defaultProps,\n  sheet: {},\n};\n\nexport default hot(Body);\n","export default __webpack_public_path__ + \"img/x-men-school.0928a818.svg\";","/**\n * MMD Toon Shader\n *\n * This shader is extended from MeshPhongMaterial, and merged algorithms with\n * MeshToonMaterial and MeshMetcapMaterial.\n * Ideas came from https://github.com/mrdoob/three.js/issues/19609\n *\n * Combining steps:\n *  * Declare matcap uniform.\n *  * Add gradientmap_pars_fragment.\n *  * Use gradient irradiances instead of dotNL irradiance from MeshPhongMaterial.\n *    (Replace lights_phong_pars_fragment with lights_mmd_toon_pars_fragment)\n *  * Add mmd_toon_matcap_fragment.\n */\n\nimport { UniformsUtils, ShaderLib } from 'three';\n\nconst lights_mmd_toon_pars_fragment = `\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n`;\n\nconst mmd_toon_matcap_fragment = `\n#ifdef USE_MATCAP\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\tvec4 matcapColor = texture2D( matcap, uv );\n\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#ifdef MATCAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight *= matcapColor.rgb;\n\n\t#elif defined( MATCAP_BLENDING_ADD )\n\n\t\toutgoingLight += matcapColor.rgb;\n\n\t#endif\n\n#endif\n`;\n\nconst MMDToonShader = {\n\n\tdefines: {\n\t\tTOON: true,\n\t\tMATCAP: true,\n\t\tMATCAP_BLENDING_ADD: true,\n\t},\n\n\tuniforms: UniformsUtils.merge( [\n\t\tShaderLib.toon.uniforms,\n\t\tShaderLib.phong.uniforms,\n\t\tShaderLib.matcap.uniforms,\n\t] ),\n\n\tvertexShader: ShaderLib.phong.vertexShader,\n\n\tfragmentShader:\n\t\tShaderLib.phong.fragmentShader\n\t\t\t.replace(\n\t\t\t\t'#include <common>',\n\t\t\t\t`\n\t\t\t\t\t#ifdef USE_MATCAP\n\t\t\t\t\t\tuniform sampler2D matcap;\n\t\t\t\t\t#endif\n\n\t\t\t\t\t#include <common>\n\t\t\t\t`\n\t\t\t)\n\t\t\t.replace(\n\t\t\t\t'#include <envmap_common_pars_fragment>',\n\t\t\t\t`\n\t\t\t\t\t#include <gradientmap_pars_fragment>\n\t\t\t\t\t#include <envmap_common_pars_fragment>\n\t\t\t\t`\n\t\t\t)\n\t\t\t.replace(\n\t\t\t\t'#include <lights_phong_pars_fragment>',\n\t\t\t\tlights_mmd_toon_pars_fragment\n\t\t\t)\n\t\t\t.replace(\n\t\t\t\t'#include <envmap_fragment>',\n\t\t\t\t`\n\t\t\t\t\t#include <envmap_fragment>\n\t\t\t\t\t${mmd_toon_matcap_fragment}\n\t\t\t\t`\n\t\t\t),\n\n};\n\nexport { MMDToonShader };\n","import {\n\tDataTextureLoader,\n\tLinearMipmapLinearFilter\n} from 'three';\n\nclass TGALoader extends DataTextureLoader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tparse( buffer ) {\n\n\t\t// reference from vthibault, https://github.com/vthibault/roBrowser/blob/master/src/Loaders/Targa.js\n\n\t\tfunction tgaCheckHeader( header ) {\n\n\t\t\tswitch ( header.image_type ) {\n\n\t\t\t\t// check indexed type\n\n\t\t\t\tcase TGA_TYPE_INDEXED:\n\t\t\t\tcase TGA_TYPE_RLE_INDEXED:\n\t\t\t\t\tif ( header.colormap_length > 256 || header.colormap_size !== 24 || header.colormap_type !== 1 ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for indexed type.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\t// check colormap type\n\n\t\t\t\tcase TGA_TYPE_RGB:\n\t\t\t\tcase TGA_TYPE_GREY:\n\t\t\t\tcase TGA_TYPE_RLE_RGB:\n\t\t\t\tcase TGA_TYPE_RLE_GREY:\n\t\t\t\t\tif ( header.colormap_type ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for colormap type.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\t// What the need of a file without data ?\n\n\t\t\t\tcase TGA_TYPE_NO_DATA:\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\n\n\t\t\t\t\t// Invalid type ?\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type \"%s\".', header.image_type );\n\n\t\t\t}\n\n\t\t\t// check image width and height\n\n\t\t\tif ( header.width <= 0 || header.height <= 0 ) {\n\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid image size.' );\n\n\t\t\t}\n\n\t\t\t// check image pixel size\n\n\t\t\tif ( header.pixel_size !== 8 && header.pixel_size !== 16 &&\n\t\t\t\theader.pixel_size !== 24 && header.pixel_size !== 32 ) {\n\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid pixel size \"%s\".', header.pixel_size );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// parse tga image buffer\n\n\t\tfunction tgaParse( use_rle, use_pal, header, offset, data ) {\n\n\t\t\tlet pixel_data,\n\t\t\t\tpalettes;\n\n\t\t\tconst pixel_size = header.pixel_size >> 3;\n\t\t\tconst pixel_total = header.width * header.height * pixel_size;\n\n\t\t\t // read palettes\n\n\t\t\t if ( use_pal ) {\n\n\t\t\t\t palettes = data.subarray( offset, offset += header.colormap_length * ( header.colormap_size >> 3 ) );\n\n\t\t\t }\n\n\t\t\t // read RLE\n\n\t\t\t if ( use_rle ) {\n\n\t\t\t\t pixel_data = new Uint8Array( pixel_total );\n\n\t\t\t\tlet c, count, i;\n\t\t\t\tlet shift = 0;\n\t\t\t\tconst pixels = new Uint8Array( pixel_size );\n\n\t\t\t\twhile ( shift < pixel_total ) {\n\n\t\t\t\t\tc = data[ offset ++ ];\n\t\t\t\t\tcount = ( c & 0x7f ) + 1;\n\n\t\t\t\t\t// RLE pixels\n\n\t\t\t\t\tif ( c & 0x80 ) {\n\n\t\t\t\t\t\t// bind pixel tmp array\n\n\t\t\t\t\t\tfor ( i = 0; i < pixel_size; ++ i ) {\n\n\t\t\t\t\t\t\tpixels[ i ] = data[ offset ++ ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// copy pixel array\n\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\n\n\t\t\t\t\t\t\tpixel_data.set( pixels, shift + i * pixel_size );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshift += pixel_size * count;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// raw pixels\n\n\t\t\t\t\t\tcount *= pixel_size;\n\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\n\n\t\t\t\t\t\t\tpixel_data[ shift + i ] = data[ offset ++ ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshift += count;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t } else {\n\n\t\t\t\t// raw pixels\n\n\t\t\t\tpixel_data = data.subarray(\n\t\t\t\t\t offset, offset += ( use_pal ? header.width * header.height : pixel_total )\n\t\t\t\t);\n\n\t\t\t }\n\n\t\t\t return {\n\t\t\t\tpixel_data: pixel_data,\n\t\t\t\tpalettes: palettes\n\t\t\t };\n\n\t\t}\n\n\t\tfunction tgaGetImageData8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image, palettes ) {\n\n\t\t\tconst colormap = palettes;\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\n\n\t\t\t\t\tcolor = image[ i ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = colormap[ ( color * 3 ) + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = colormap[ ( color * 3 ) + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = colormap[ ( color * 3 ) + 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\n\n\t\t\t\t\tcolor = image[ i + 0 ] + ( image[ i + 1 ] << 8 ); // Inversed ?\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = ( color & 0x7C00 ) >> 7;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = ( color & 0x03E0 ) >> 2;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = ( color & 0x001F ) >> 3;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = ( color & 0x8000 ) ? 0 : 255;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData24bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 3 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData32bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 4 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 3 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageDataGrey8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\n\n\t\t\t\t\tcolor = image[ i ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageDataGrey16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 1 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction getTgaRGBA( data, width, height, image, palette ) {\n\n\t\t\tlet x_start,\n\t\t\t\ty_start,\n\t\t\t\tx_step,\n\t\t\t\ty_step,\n\t\t\t\tx_end,\n\t\t\t\ty_end;\n\n\t\t\tswitch ( ( header.flags & TGA_ORIGIN_MASK ) >> TGA_ORIGIN_SHIFT ) {\n\n\t\t\t\tdefault:\n\t\t\t\tcase TGA_ORIGIN_UL:\n\t\t\t\t\tx_start = 0;\n\t\t\t\t\tx_step = 1;\n\t\t\t\t\tx_end = width;\n\t\t\t\t\ty_start = 0;\n\t\t\t\t\ty_step = 1;\n\t\t\t\t\ty_end = height;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_BL:\n\t\t\t\t\tx_start = 0;\n\t\t\t\t\tx_step = 1;\n\t\t\t\t\tx_end = width;\n\t\t\t\t\ty_start = height - 1;\n\t\t\t\t\ty_step = - 1;\n\t\t\t\t\ty_end = - 1;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_UR:\n\t\t\t\t\tx_start = width - 1;\n\t\t\t\t\tx_step = - 1;\n\t\t\t\t\tx_end = - 1;\n\t\t\t\t\ty_start = 0;\n\t\t\t\t\ty_step = 1;\n\t\t\t\t\ty_end = height;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_BR:\n\t\t\t\t\tx_start = width - 1;\n\t\t\t\t\tx_step = - 1;\n\t\t\t\t\tx_end = - 1;\n\t\t\t\t\ty_start = height - 1;\n\t\t\t\t\ty_step = - 1;\n\t\t\t\t\ty_end = - 1;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( use_grey ) {\n\n\t\t\t\tswitch ( header.pixel_size ) {\n\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\ttgaGetImageDataGrey8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttgaGetImageDataGrey16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tswitch ( header.pixel_size ) {\n\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\ttgaGetImageData8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image, palette );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttgaGetImageData16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 24:\n\t\t\t\t\t\ttgaGetImageData24bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 32:\n\t\t\t\t\t\ttgaGetImageData32bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Load image data according to specific method\n\t\t\t// let func = 'tgaGetImageData' + (use_grey ? 'Grey' : '') + (header.pixel_size) + 'bits';\n\t\t\t// func(data, y_start, y_step, y_end, x_start, x_step, x_end, width, image, palette );\n\t\t\treturn data;\n\n\t\t}\n\n\t\t// TGA constants\n\n\t\tconst TGA_TYPE_NO_DATA = 0,\n\t\t\tTGA_TYPE_INDEXED = 1,\n\t\t\tTGA_TYPE_RGB = 2,\n\t\t\tTGA_TYPE_GREY = 3,\n\t\t\tTGA_TYPE_RLE_INDEXED = 9,\n\t\t\tTGA_TYPE_RLE_RGB = 10,\n\t\t\tTGA_TYPE_RLE_GREY = 11,\n\n\t\t\tTGA_ORIGIN_MASK = 0x30,\n\t\t\tTGA_ORIGIN_SHIFT = 0x04,\n\t\t\tTGA_ORIGIN_BL = 0x00,\n\t\t\tTGA_ORIGIN_BR = 0x01,\n\t\t\tTGA_ORIGIN_UL = 0x02,\n\t\t\tTGA_ORIGIN_UR = 0x03;\n\n\t\tif ( buffer.length < 19 ) console.error( 'THREE.TGALoader: Not enough data to contain header.' );\n\n\t\tlet offset = 0;\n\n\t\tconst content = new Uint8Array( buffer ),\n\t\t\theader = {\n\t\t\t\tid_length: content[ offset ++ ],\n\t\t\t\tcolormap_type: content[ offset ++ ],\n\t\t\t\timage_type: content[ offset ++ ],\n\t\t\t\tcolormap_index: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tcolormap_length: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tcolormap_size: content[ offset ++ ],\n\t\t\t\torigin: [\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8\n\t\t\t\t],\n\t\t\t\twidth: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\theight: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tpixel_size: content[ offset ++ ],\n\t\t\t\tflags: content[ offset ++ ]\n\t\t\t};\n\n\t\t// check tga if it is valid format\n\n\t\ttgaCheckHeader( header );\n\n\t\tif ( header.id_length + offset > buffer.length ) {\n\n\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\n\n\t\t}\n\n\t\t// skip the needn't data\n\n\t\toffset += header.id_length;\n\n\t\t// get targa information about RLE compression and palette\n\n\t\tlet use_rle = false,\n\t\t\tuse_pal = false,\n\t\t\tuse_grey = false;\n\n\t\tswitch ( header.image_type ) {\n\n\t\t\tcase TGA_TYPE_RLE_INDEXED:\n\t\t\t\tuse_rle = true;\n\t\t\t\tuse_pal = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_INDEXED:\n\t\t\t\tuse_pal = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RLE_RGB:\n\t\t\t\tuse_rle = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RGB:\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RLE_GREY:\n\t\t\t\tuse_rle = true;\n\t\t\t\tuse_grey = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_GREY:\n\t\t\t\tuse_grey = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t//\n\n\t\tconst imageData = new Uint8Array( header.width * header.height * 4 );\n\t\tconst result = tgaParse( use_rle, use_pal, header, offset, content );\n\t\tgetTgaRGBA( imageData, header.width, header.height, result.pixel_data, result.palettes );\n\n\t\treturn {\n\n\t\t\tdata: imageData,\n\t\t\twidth: header.width,\n\t\t\theight: header.height,\n\t\t\tflipY: true,\n\t\t\tgenerateMipmaps: true,\n\t\t\tminFilter: LinearMipmapLinearFilter,\n\n\t\t};\n\n\t}\n\n}\n\nexport { TGALoader };\n","import {\n\tAddOperation,\n\tAnimationClip,\n\tBone,\n\tBufferGeometry,\n\tColor,\n\tCustomBlending,\n\tTangentSpaceNormalMap,\n\tDoubleSide,\n\tDstAlphaFactor,\n\tEuler,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tFrontSide,\n\tInterpolant,\n\tLoader,\n\tLoaderUtils,\n\tUniformsUtils,\n\tShaderMaterial,\n\tMultiplyOperation,\n\tNearestFilter,\n\tNumberKeyframeTrack,\n\tOneMinusSrcAlphaFactor,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSrcAlphaFactor,\n\tTextureLoader,\n\tUint16BufferAttribute,\n\tVector3,\n\tVectorKeyframeTrack,\n\tRGB_S3TC_DXT1_Format,\n\tRGB_PVRTC_4BPPV1_Format,\n\tRGB_PVRTC_2BPPV1_Format,\n\tRGB_ETC1_Format,\n\tRGB_ETC2_Format\n} from 'three';\nimport { MMDToonShader } from '../shaders/MMDToonShader.js';\nimport { TGALoader } from '../loaders/TGALoader.js';\nimport { MMDParser } from '../libs/mmdparser.module.js';\n\n/**\n * Dependencies\n *  - mmd-parser https://github.com/takahirox/mmd-parser\n *  - TGALoader\n *  - OutlineEffect\n *\n * MMDLoader creates Three.js Objects from MMD resources as\n * PMD, PMX, VMD, and VPD files.\n *\n * PMD/PMX is a model data format, VMD is a motion data format\n * VPD is a posing data format used in MMD(Miku Miku Dance).\n *\n * MMD official site\n *  - https://sites.google.com/view/evpvp/\n *\n * PMD, VMD format (in Japanese)\n *  - http://blog.goo.ne.jp/torisu_tetosuki/e/209ad341d3ece2b1b4df24abf619d6e4\n *\n * PMX format\n *  - https://gist.github.com/felixjones/f8a06bd48f9da9a4539f\n *\n * TODO\n *  - light motion in vmd support.\n *  - SDEF support.\n *  - uv/material/bone morphing support.\n *  - more precise grant skinning support.\n *  - shadow support.\n */\n\n/**\n * @param {THREE.LoadingManager} manager\n */\nclass MMDLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.loader = new FileLoader( this.manager );\n\n\t\tthis.parser = null; // lazy generation\n\t\tthis.meshBuilder = new MeshBuilder( this.manager );\n\t\tthis.animationBuilder = new AnimationBuilder();\n\n\t}\n\n\t/**\n\t * @param {string} animationPath\n\t * @return {MMDLoader}\n\t */\n\tsetAnimationPath( animationPath ) {\n\n\t\tthis.animationPath = animationPath;\n\t\treturn this;\n\n\t}\n\n\t// Load MMD assets as Three.js Object\n\n\t/**\n\t * Loads Model file (.pmd or .pmx) as a SkinnedMesh.\n\t *\n\t * @param {string} url - url to Model(.pmd or .pmx) file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst builder = this.meshBuilder.setCrossOrigin( this.crossOrigin );\n\n\t\t// resource path\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\tresourcePath = this.path;\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\tconst modelExtension = this._extractExtension( url ).toLowerCase();\n\n\t\t// Should I detect by seeing header?\n\t\tif ( modelExtension !== 'pmd' && modelExtension !== 'pmx' ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.MMDLoader: Unknown model file extension .' + modelExtension + '.' ) );\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tthis[ modelExtension === 'pmd' ? 'loadPMD' : 'loadPMX' ]( url, function ( data ) {\n\n\t\t\tonLoad(\tbuilder.build( data, resourcePath, onProgress, onError )\t);\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads Motion file(s) (.vmd) as a AnimationClip.\n\t * If two or more files are specified, they'll be merged.\n\t *\n\t * @param {string|Array<string>} url - url(s) to animation(.vmd) file(s)\n\t * @param {SkinnedMesh|THREE.Camera} object - tracks will be fitting to this object\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadAnimation( url, object, onLoad, onProgress, onError ) {\n\n\t\tconst builder = this.animationBuilder;\n\n\t\tthis.loadVMD( url, function ( vmd ) {\n\n\t\t\tonLoad( object.isCamera\n\t\t\t\t? builder.buildCameraAnimation( vmd )\n\t\t\t\t: builder.build( vmd, object ) );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads mode file and motion file(s) as an object containing\n\t * a SkinnedMesh and a AnimationClip.\n\t * Tracks of AnimationClip are fitting to the model.\n\t *\n\t * @param {string} modelUrl - url to Model(.pmd or .pmx) file\n\t * @param {string|Array{string}} vmdUrl - url(s) to animation(.vmd) file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadWithAnimation( modelUrl, vmdUrl, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tthis.load( modelUrl, function ( mesh ) {\n\n\t\t\tscope.loadAnimation( vmdUrl, mesh, function ( animation ) {\n\n\t\t\t\tonLoad( {\n\t\t\t\t\tmesh: mesh,\n\t\t\t\t\tanimation: animation\n\t\t\t\t} );\n\n\t\t\t}, onProgress, onError );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t// Load MMD assets as Object data parsed by MMDParser\n\n\t/**\n\t * Loads .pmd file as an Object.\n\t *\n\t * @param {string} url - url to .pmd file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadPMD( url, onLoad, onProgress, onError ) {\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( undefined )\n\t\t\t.setPath( this.path )\n\t\t\t.setResponseType( 'arraybuffer' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials )\n\t\t\t.load( url, function ( buffer ) {\n\n\t\t\t\tonLoad( parser.parsePmd( buffer, true ) );\n\n\t\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads .pmx file as an Object.\n\t *\n\t * @param {string} url - url to .pmx file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadPMX( url, onLoad, onProgress, onError ) {\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( undefined )\n\t\t\t.setPath( this.path )\n\t\t\t.setResponseType( 'arraybuffer' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials )\n\t\t\t.load( url, function ( buffer ) {\n\n\t\t\t\tonLoad( parser.parsePmx( buffer, true ) );\n\n\t\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads .vmd file as an Object. If two or more files are specified\n\t * they'll be merged.\n\t *\n\t * @param {string|Array<string>} url - url(s) to .vmd file(s)\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadVMD( url, onLoad, onProgress, onError ) {\n\n\t\tconst urls = Array.isArray( url ) ? url : [ url ];\n\n\t\tconst vmds = [];\n\t\tconst vmdNum = urls.length;\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( undefined )\n\t\t\t.setPath( this.animationPath )\n\t\t\t.setResponseType( 'arraybuffer' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials );\n\n\t\tfor ( let i = 0, il = urls.length; i < il; i ++ ) {\n\n\t\t\tthis.loader.load( urls[ i ], function ( buffer ) {\n\n\t\t\t\tvmds.push( parser.parseVmd( buffer, true ) );\n\n\t\t\t\tif ( vmds.length === vmdNum ) onLoad( parser.mergeVmds( vmds ) );\n\n\t\t\t}, onProgress, onError );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Loads .vpd file as an Object.\n\t *\n\t * @param {string} url - url to .vpd file\n\t * @param {boolean} isUnicode\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadVPD( url, isUnicode, onLoad, onProgress, onError ) {\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( isUnicode ? undefined : 'text/plain; charset=shift_jis' )\n\t\t\t.setPath( this.animationPath )\n\t\t\t.setResponseType( 'text' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials )\n\t\t\t.load( url, function ( text ) {\n\n\t\t\t\tonLoad( parser.parseVpd( text, true ) );\n\n\t\t\t}, onProgress, onError );\n\n\t}\n\n\t// private methods\n\n\t_extractExtension( url ) {\n\n\t\tconst index = url.lastIndexOf( '.' );\n\t\treturn index < 0 ? '' : url.slice( index + 1 );\n\n\t}\n\n\t_getParser() {\n\n\t\tif ( this.parser === null ) {\n\n\t\t\tif ( typeof MMDParser === 'undefined' ) {\n\n\t\t\t\tthrow new Error( 'THREE.MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser' );\n\n\t\t\t}\n\n\t\t\tthis.parser = new MMDParser.Parser(); // eslint-disable-line no-undef\n\n\t\t}\n\n\t\treturn this.parser;\n\n\t}\n\n}\n\n// Utilities\n\n/*\n\t * base64 encoded defalut toon textures toon00.bmp - toon10.bmp.\n\t * We don't need to request external toon image files.\n\t * This idea is from http://www20.atpages.jp/katwat/three.js_r58/examples/mytest37/mmd.three.js\n\t */\nconst DEFAULT_TOON_TEXTURES = [\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII='\n];\n\nconst NON_ALPHA_CHANNEL_FORMATS = [\n\tRGB_S3TC_DXT1_Format,\n\tRGB_PVRTC_4BPPV1_Format,\n\tRGB_PVRTC_2BPPV1_Format,\n\tRGB_ETC1_Format,\n\tRGB_ETC2_Format\n];\n\n// Builders. They build Three.js object from Object data parsed by MMDParser.\n\n/**\n * @param {THREE.LoadingManager} manager\n */\nclass MeshBuilder {\n\n\tconstructor( manager ) {\n\n\t\tthis.crossOrigin = 'anonymous';\n\t\tthis.geometryBuilder = new GeometryBuilder();\n\t\tthis.materialBuilder = new MaterialBuilder( manager );\n\n\t}\n\n\t/**\n\t * @param {string} crossOrigin\n\t * @return {MeshBuilder}\n\t */\n\tsetCrossOrigin( crossOrigin ) {\n\n\t\tthis.crossOrigin = crossOrigin;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * @param {Object} data - parsed PMD/PMX data\n\t * @param {string} resourcePath\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t * @return {SkinnedMesh}\n\t */\n\tbuild( data, resourcePath, onProgress, onError ) {\n\n\t\tconst geometry = this.geometryBuilder.build( data );\n\t\tconst material = this.materialBuilder\n\t\t\t.setCrossOrigin( this.crossOrigin )\n\t\t\t.setResourcePath( resourcePath )\n\t\t\t.build( data, geometry, onProgress, onError );\n\n\t\tconst mesh = new SkinnedMesh( geometry, material );\n\n\t\tconst skeleton = new Skeleton( initBones( mesh ) );\n\t\tmesh.bind( skeleton );\n\n\t\t// console.log( mesh ); // for console debug\n\n\t\treturn mesh;\n\n\t}\n\n}\n\n// TODO: Try to remove this function\n\nfunction initBones( mesh ) {\n\n\tconst geometry = mesh.geometry;\n\n\tconst bones = [];\n\n\tif ( geometry && geometry.bones !== undefined ) {\n\n\t\t// first, create array of 'Bone' objects from geometry data\n\n\t\tfor ( let i = 0, il = geometry.bones.length; i < il; i ++ ) {\n\n\t\t\tconst gbone = geometry.bones[ i ];\n\n\t\t\t// create new 'Bone' object\n\n\t\t\tconst bone = new Bone();\n\t\t\tbones.push( bone );\n\n\t\t\t// apply values\n\n\t\t\tbone.name = gbone.name;\n\t\t\tbone.position.fromArray( gbone.pos );\n\t\t\tbone.quaternion.fromArray( gbone.rotq );\n\t\t\tif ( gbone.scl !== undefined ) bone.scale.fromArray( gbone.scl );\n\n\t\t}\n\n\t\t// second, create bone hierarchy\n\n\t\tfor ( let i = 0, il = geometry.bones.length; i < il; i ++ ) {\n\n\t\t\tconst gbone = geometry.bones[ i ];\n\n\t\t\tif ( ( gbone.parent !== - 1 ) && ( gbone.parent !== null ) && ( bones[ gbone.parent ] !== undefined ) ) {\n\n\t\t\t\t// subsequent bones in the hierarchy\n\n\t\t\t\tbones[ gbone.parent ].add( bones[ i ] );\n\n\t\t\t} else {\n\n\t\t\t\t// topmost bone, immediate child of the skinned mesh\n\n\t\t\t\tmesh.add( bones[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// now the bones are part of the scene graph and children of the skinned mesh.\n\t// let's update the corresponding matrices\n\n\tmesh.updateMatrixWorld( true );\n\n\treturn bones;\n\n}\n\n//\n\nclass GeometryBuilder {\n\n\t/**\n\t * @param {Object} data - parsed PMD/PMX data\n\t * @return {BufferGeometry}\n\t */\n\tbuild( data ) {\n\n\t\t// for geometry\n\t\tconst positions = [];\n\t\tconst uvs = [];\n\t\tconst normals = [];\n\n\t\tconst indices = [];\n\n\t\tconst groups = [];\n\n\t\tconst bones = [];\n\t\tconst skinIndices = [];\n\t\tconst skinWeights = [];\n\n\t\tconst morphTargets = [];\n\t\tconst morphPositions = [];\n\n\t\tconst iks = [];\n\t\tconst grants = [];\n\n\t\tconst rigidBodies = [];\n\t\tconst constraints = [];\n\n\t\t// for work\n\t\tlet offset = 0;\n\t\tconst boneTypeTable = {};\n\n\t\t// positions, normals, uvs, skinIndices, skinWeights\n\n\t\tfor ( let i = 0; i < data.metadata.vertexCount; i ++ ) {\n\n\t\t\tconst v = data.vertices[ i ];\n\n\t\t\tfor ( let j = 0, jl = v.position.length; j < jl; j ++ ) {\n\n\t\t\t\tpositions.push( v.position[ j ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = v.normal.length; j < jl; j ++ ) {\n\n\t\t\t\tnormals.push( v.normal[ j ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = v.uv.length; j < jl; j ++ ) {\n\n\t\t\t\tuvs.push( v.uv[ j ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\n\n\t\t\t\tskinIndices.push( v.skinIndices.length - 1 >= j ? v.skinIndices[ j ] : 0.0 );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\n\n\t\t\t\tskinWeights.push( v.skinWeights.length - 1 >= j ? v.skinWeights[ j ] : 0.0 );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// indices\n\n\t\tfor ( let i = 0; i < data.metadata.faceCount; i ++ ) {\n\n\t\t\tconst face = data.faces[ i ];\n\n\t\t\tfor ( let j = 0, jl = face.indices.length; j < jl; j ++ ) {\n\n\t\t\t\tindices.push( face.indices[ j ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// groups\n\n\t\tfor ( let i = 0; i < data.metadata.materialCount; i ++ ) {\n\n\t\t\tconst material = data.materials[ i ];\n\n\t\t\tgroups.push( {\n\t\t\t\toffset: offset * 3,\n\t\t\t\tcount: material.faceCount * 3\n\t\t\t} );\n\n\t\t\toffset += material.faceCount;\n\n\t\t}\n\n\t\t// bones\n\n\t\tfor ( let i = 0; i < data.metadata.rigidBodyCount; i ++ ) {\n\n\t\t\tconst body = data.rigidBodies[ i ];\n\t\t\tlet value = boneTypeTable[ body.boneIndex ];\n\n\t\t\t// keeps greater number if already value is set without any special reasons\n\t\t\tvalue = value === undefined ? body.type : Math.max( body.type, value );\n\n\t\t\tboneTypeTable[ body.boneIndex ] = value;\n\n\t\t}\n\n\t\tfor ( let i = 0; i < data.metadata.boneCount; i ++ ) {\n\n\t\t\tconst boneData = data.bones[ i ];\n\n\t\t\tconst bone = {\n\t\t\t\tindex: i,\n\t\t\t\ttransformationClass: boneData.transformationClass,\n\t\t\t\tparent: boneData.parentIndex,\n\t\t\t\tname: boneData.name,\n\t\t\t\tpos: boneData.position.slice( 0, 3 ),\n\t\t\t\trotq: [ 0, 0, 0, 1 ],\n\t\t\t\tscl: [ 1, 1, 1 ],\n\t\t\t\trigidBodyType: boneTypeTable[ i ] !== undefined ? boneTypeTable[ i ] : - 1\n\t\t\t};\n\n\t\t\tif ( bone.parent !== - 1 ) {\n\n\t\t\t\tbone.pos[ 0 ] -= data.bones[ bone.parent ].position[ 0 ];\n\t\t\t\tbone.pos[ 1 ] -= data.bones[ bone.parent ].position[ 1 ];\n\t\t\t\tbone.pos[ 2 ] -= data.bones[ bone.parent ].position[ 2 ];\n\n\t\t\t}\n\n\t\t\tbones.push( bone );\n\n\t\t}\n\n\t\t// iks\n\n\t\t// TODO: remove duplicated codes between PMD and PMX\n\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\tfor ( let i = 0; i < data.metadata.ikCount; i ++ ) {\n\n\t\t\t\tconst ik = data.iks[ i ];\n\n\t\t\t\tconst param = {\n\t\t\t\t\ttarget: ik.target,\n\t\t\t\t\teffector: ik.effector,\n\t\t\t\t\titeration: ik.iteration,\n\t\t\t\t\tmaxAngle: ik.maxAngle * 4,\n\t\t\t\t\tlinks: []\n\t\t\t\t};\n\n\t\t\t\tfor ( let j = 0, jl = ik.links.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst link = {};\n\t\t\t\t\tlink.index = ik.links[ j ].index;\n\t\t\t\t\tlink.enabled = true;\n\n\t\t\t\t\tif ( data.bones[ link.index ].name.indexOf( 'ひざ' ) >= 0 ) {\n\n\t\t\t\t\t\tlink.limitation = new Vector3( 1.0, 0.0, 0.0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tparam.links.push( link );\n\n\t\t\t\t}\n\n\t\t\t\tiks.push( param );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tfor ( let i = 0; i < data.metadata.boneCount; i ++ ) {\n\n\t\t\t\tconst ik = data.bones[ i ].ik;\n\n\t\t\t\tif ( ik === undefined ) continue;\n\n\t\t\t\tconst param = {\n\t\t\t\t\ttarget: i,\n\t\t\t\t\teffector: ik.effector,\n\t\t\t\t\titeration: ik.iteration,\n\t\t\t\t\tmaxAngle: ik.maxAngle,\n\t\t\t\t\tlinks: []\n\t\t\t\t};\n\n\t\t\t\tfor ( let j = 0, jl = ik.links.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst link = {};\n\t\t\t\t\tlink.index = ik.links[ j ].index;\n\t\t\t\t\tlink.enabled = true;\n\n\t\t\t\t\tif ( ik.links[ j ].angleLimitation === 1 ) {\n\n\t\t\t\t\t\t// Revert if rotationMin/Max doesn't work well\n\t\t\t\t\t\t// link.limitation = new Vector3( 1.0, 0.0, 0.0 );\n\n\t\t\t\t\t\tconst rotationMin = ik.links[ j ].lowerLimitationAngle;\n\t\t\t\t\t\tconst rotationMax = ik.links[ j ].upperLimitationAngle;\n\n\t\t\t\t\t\t// Convert Left to Right coordinate by myself because\n\t\t\t\t\t\t// MMDParser doesn't convert. It's a MMDParser's bug\n\n\t\t\t\t\t\tconst tmp1 = - rotationMax[ 0 ];\n\t\t\t\t\t\tconst tmp2 = - rotationMax[ 1 ];\n\t\t\t\t\t\trotationMax[ 0 ] = - rotationMin[ 0 ];\n\t\t\t\t\t\trotationMax[ 1 ] = - rotationMin[ 1 ];\n\t\t\t\t\t\trotationMin[ 0 ] = tmp1;\n\t\t\t\t\t\trotationMin[ 1 ] = tmp2;\n\n\t\t\t\t\t\tlink.rotationMin = new Vector3().fromArray( rotationMin );\n\t\t\t\t\t\tlink.rotationMax = new Vector3().fromArray( rotationMax );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tparam.links.push( link );\n\n\t\t\t\t}\n\n\t\t\t\tiks.push( param );\n\n\t\t\t\t// Save the reference even from bone data for efficiently\n\t\t\t\t// simulating PMX animation system\n\t\t\t\tbones[ i ].ik = param;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// grants\n\n\t\tif ( data.metadata.format === 'pmx' ) {\n\n\t\t\t// bone index -> grant entry map\n\t\t\tconst grantEntryMap = {};\n\n\t\t\tfor ( let i = 0; i < data.metadata.boneCount; i ++ ) {\n\n\t\t\t\tconst boneData = data.bones[ i ];\n\t\t\t\tconst grant = boneData.grant;\n\n\t\t\t\tif ( grant === undefined ) continue;\n\n\t\t\t\tconst param = {\n\t\t\t\t\tindex: i,\n\t\t\t\t\tparentIndex: grant.parentIndex,\n\t\t\t\t\tratio: grant.ratio,\n\t\t\t\t\tisLocal: grant.isLocal,\n\t\t\t\t\taffectRotation: grant.affectRotation,\n\t\t\t\t\taffectPosition: grant.affectPosition,\n\t\t\t\t\ttransformationClass: boneData.transformationClass\n\t\t\t\t};\n\n\t\t\t\tgrantEntryMap[ i ] = { parent: null, children: [], param: param, visited: false };\n\n\t\t\t}\n\n\t\t\tconst rootEntry = { parent: null, children: [], param: null, visited: false };\n\n\t\t\t// Build a tree representing grant hierarchy\n\n\t\t\tfor ( const boneIndex in grantEntryMap ) {\n\n\t\t\t\tconst grantEntry = grantEntryMap[ boneIndex ];\n\t\t\t\tconst parentGrantEntry = grantEntryMap[ grantEntry.parentIndex ] || rootEntry;\n\n\t\t\t\tgrantEntry.parent = parentGrantEntry;\n\t\t\t\tparentGrantEntry.children.push( grantEntry );\n\n\t\t\t}\n\n\t\t\t// Sort grant parameters from parents to children because\n\t\t\t// grant uses parent's transform that parent's grant is already applied\n\t\t\t// so grant should be applied in order from parents to children\n\n\t\t\tfunction traverse( entry ) {\n\n\t\t\t\tif ( entry.param ) {\n\n\t\t\t\t\tgrants.push( entry.param );\n\n\t\t\t\t\t// Save the reference even from bone data for efficiently\n\t\t\t\t\t// simulating PMX animation system\n\t\t\t\t\tbones[ entry.param.index ].grant = entry.param;\n\n\t\t\t\t}\n\n\t\t\t\tentry.visited = true;\n\n\t\t\t\tfor ( let i = 0, il = entry.children.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst child = entry.children[ i ];\n\n\t\t\t\t\t// Cut off a loop if exists. (Is a grant loop invalid?)\n\t\t\t\t\tif ( ! child.visited ) traverse( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttraverse( rootEntry );\n\n\t\t}\n\n\t\t// morph\n\n\t\tfunction updateAttributes( attribute, morph, ratio ) {\n\n\t\t\tfor ( let i = 0; i < morph.elementCount; i ++ ) {\n\n\t\t\t\tconst element = morph.elements[ i ];\n\n\t\t\t\tlet index;\n\n\t\t\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\t\t\tindex = data.morphs[ 0 ].elements[ element.index ].index;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tindex = element.index;\n\n\t\t\t\t}\n\n\t\t\t\tattribute.array[ index * 3 + 0 ] += element.position[ 0 ] * ratio;\n\t\t\t\tattribute.array[ index * 3 + 1 ] += element.position[ 1 ] * ratio;\n\t\t\t\tattribute.array[ index * 3 + 2 ] += element.position[ 2 ] * ratio;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( let i = 0; i < data.metadata.morphCount; i ++ ) {\n\n\t\t\tconst morph = data.morphs[ i ];\n\t\t\tconst params = { name: morph.name };\n\n\t\t\tconst attribute = new Float32BufferAttribute( data.metadata.vertexCount * 3, 3 );\n\t\t\tattribute.name = morph.name;\n\n\t\t\tfor ( let j = 0; j < data.metadata.vertexCount * 3; j ++ ) {\n\n\t\t\t\tattribute.array[ j ] = positions[ j ];\n\n\t\t\t}\n\n\t\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\t\tif ( i !== 0 ) {\n\n\t\t\t\t\tupdateAttributes( attribute, morph, 1.0 );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif ( morph.type === 0 ) { // group\n\n\t\t\t\t\tfor ( let j = 0; j < morph.elementCount; j ++ ) {\n\n\t\t\t\t\t\tconst morph2 = data.morphs[ morph.elements[ j ].index ];\n\t\t\t\t\t\tconst ratio = morph.elements[ j ].ratio;\n\n\t\t\t\t\t\tif ( morph2.type === 1 ) {\n\n\t\t\t\t\t\t\tupdateAttributes( attribute, morph2, ratio );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// TODO: implement\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( morph.type === 1 ) { // vertex\n\n\t\t\t\t\tupdateAttributes( attribute, morph, 1.0 );\n\n\t\t\t\t} else if ( morph.type === 2 ) { // bone\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 3 ) { // uv\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 4 ) { // additional uv1\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 5 ) { // additional uv2\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 6 ) { // additional uv3\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 7 ) { // additional uv4\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 8 ) { // material\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmorphTargets.push( params );\n\t\t\tmorphPositions.push( attribute );\n\n\t\t}\n\n\t\t// rigid bodies from rigidBodies field.\n\n\t\tfor ( let i = 0; i < data.metadata.rigidBodyCount; i ++ ) {\n\n\t\t\tconst rigidBody = data.rigidBodies[ i ];\n\t\t\tconst params = {};\n\n\t\t\tfor ( const key in rigidBody ) {\n\n\t\t\t\tparams[ key ] = rigidBody[ key ];\n\n\t\t\t}\n\n\t\t\t/*\n\t\t\t\t * RigidBody position parameter in PMX seems global position\n\t\t\t\t * while the one in PMD seems offset from corresponding bone.\n\t\t\t\t * So unify being offset.\n\t\t\t\t */\n\t\t\tif ( data.metadata.format === 'pmx' ) {\n\n\t\t\t\tif ( params.boneIndex !== - 1 ) {\n\n\t\t\t\t\tconst bone = data.bones[ params.boneIndex ];\n\t\t\t\t\tparams.position[ 0 ] -= bone.position[ 0 ];\n\t\t\t\t\tparams.position[ 1 ] -= bone.position[ 1 ];\n\t\t\t\t\tparams.position[ 2 ] -= bone.position[ 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\trigidBodies.push( params );\n\n\t\t}\n\n\t\t// constraints from constraints field.\n\n\t\tfor ( let i = 0; i < data.metadata.constraintCount; i ++ ) {\n\n\t\t\tconst constraint = data.constraints[ i ];\n\t\t\tconst params = {};\n\n\t\t\tfor ( const key in constraint ) {\n\n\t\t\t\tparams[ key ] = constraint[ key ];\n\n\t\t\t}\n\n\t\t\tconst bodyA = rigidBodies[ params.rigidBodyIndex1 ];\n\t\t\tconst bodyB = rigidBodies[ params.rigidBodyIndex2 ];\n\n\t\t\t// Refer to http://www20.atpages.jp/katwat/wp/?p=4135\n\t\t\tif ( bodyA.type !== 0 && bodyB.type === 2 ) {\n\n\t\t\t\tif ( bodyA.boneIndex !== - 1 && bodyB.boneIndex !== - 1 &&\n\t\t\t\t\t     data.bones[ bodyB.boneIndex ].parentIndex === bodyA.boneIndex ) {\n\n\t\t\t\t\tbodyB.type = 1;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconstraints.push( params );\n\n\t\t}\n\n\t\t// build BufferGeometry.\n\n\t\tconst geometry = new BufferGeometry();\n\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( positions, 3 ) );\n\t\tgeometry.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\t\tgeometry.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\t\tgeometry.setAttribute( 'skinIndex', new Uint16BufferAttribute( skinIndices, 4 ) );\n\t\tgeometry.setAttribute( 'skinWeight', new Float32BufferAttribute( skinWeights, 4 ) );\n\t\tgeometry.setIndex( indices );\n\n\t\tfor ( let i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\tgeometry.addGroup( groups[ i ].offset, groups[ i ].count, i );\n\n\t\t}\n\n\t\tgeometry.bones = bones;\n\n\t\tgeometry.morphTargets = morphTargets;\n\t\tgeometry.morphAttributes.position = morphPositions;\n\t\tgeometry.morphTargetsRelative = false;\n\n\t\tgeometry.userData.MMD = {\n\t\t\tbones: bones,\n\t\t\tiks: iks,\n\t\t\tgrants: grants,\n\t\t\trigidBodies: rigidBodies,\n\t\t\tconstraints: constraints,\n\t\t\tformat: data.metadata.format\n\t\t};\n\n\t\tgeometry.computeBoundingSphere();\n\n\t\treturn geometry;\n\n\t}\n\n}\n\n//\n\n/**\n * @param {THREE.LoadingManager} manager\n */\nclass MaterialBuilder {\n\n\tconstructor( manager ) {\n\n\t\tthis.manager = manager;\n\n\t\tthis.textureLoader = new TextureLoader( this.manager );\n\t\tthis.tgaLoader = null; // lazy generation\n\n\t\tthis.crossOrigin = 'anonymous';\n\t\tthis.resourcePath = undefined;\n\n\t}\n\n\t/**\n\t * @param {string} crossOrigin\n\t * @return {MaterialBuilder}\n\t */\n\tsetCrossOrigin( crossOrigin ) {\n\n\t\tthis.crossOrigin = crossOrigin;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * @param {string} resourcePath\n\t * @return {MaterialBuilder}\n\t */\n\tsetResourcePath( resourcePath ) {\n\n\t\tthis.resourcePath = resourcePath;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * @param {Object} data - parsed PMD/PMX data\n\t * @param {BufferGeometry} geometry - some properties are dependend on geometry\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t * @return {Array<MMDToonMaterial>}\n\t */\n\tbuild( data, geometry /*, onProgress, onError */ ) {\n\n\t\tconst materials = [];\n\n\t\tconst textures = {};\n\n\t\tthis.textureLoader.setCrossOrigin( this.crossOrigin );\n\n\t\t// materials\n\n\t\tfor ( let i = 0; i < data.metadata.materialCount; i ++ ) {\n\n\t\t\tconst material = data.materials[ i ];\n\n\t\t\tconst params = { userData: { MMD: {} } };\n\n\t\t\tif ( material.name !== undefined ) params.name = material.name;\n\n\t\t\t/*\n\t\t\t\t * Color\n\t\t\t\t *\n\t\t\t\t * MMD         MMDToonMaterial\n\t\t\t\t * ambient  -  emissive * a\n\t\t\t\t *               (a = 1.0 without map texture or 0.2 with map texture)\n\t\t\t\t *\n\t\t\t\t * MMDToonMaterial doesn't have ambient. Set it to emissive instead.\n\t\t\t\t * It'll be too bright if material has map texture so using coef 0.2.\n\t\t\t\t */\n\t\t\tparams.diffuse = new Color().fromArray( material.diffuse );\n\t\t\tparams.opacity = material.diffuse[ 3 ];\n\t\t\tparams.specular = new Color().fromArray( material.specular );\n\t\t\tparams.shininess = material.shininess;\n\t\t\tparams.emissive = new Color().fromArray( material.ambient );\n\t\t\tparams.transparent = params.opacity !== 1.0;\n\n\t\t\t//\n\n\t\t\tparams.fog = true;\n\n\t\t\t// blend\n\n\t\t\tparams.blending = CustomBlending;\n\t\t\tparams.blendSrc = SrcAlphaFactor;\n\t\t\tparams.blendDst = OneMinusSrcAlphaFactor;\n\t\t\tparams.blendSrcAlpha = SrcAlphaFactor;\n\t\t\tparams.blendDstAlpha = DstAlphaFactor;\n\n\t\t\t// side\n\n\t\t\tif ( data.metadata.format === 'pmx' && ( material.flag & 0x1 ) === 1 ) {\n\n\t\t\t\tparams.side = DoubleSide;\n\n\t\t\t} else {\n\n\t\t\t\tparams.side = params.opacity === 1.0 ? FrontSide : DoubleSide;\n\n\t\t\t}\n\n\t\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\t\t// map, envMap\n\n\t\t\t\tif ( material.fileName ) {\n\n\t\t\t\t\tconst fileName = material.fileName;\n\t\t\t\t\tconst fileNames = fileName.split( '*' );\n\n\t\t\t\t\t// fileNames[ 0 ]: mapFileName\n\t\t\t\t\t// fileNames[ 1 ]: envMapFileName( optional )\n\n\t\t\t\t\tparams.map = this._loadTexture( fileNames[ 0 ], textures );\n\n\t\t\t\t\tif ( fileNames.length > 1 ) {\n\n\t\t\t\t\t\tconst extension = fileNames[ 1 ].slice( - 4 ).toLowerCase();\n\n\t\t\t\t\t\tparams.envMap = this._loadTexture(\n\t\t\t\t\t\t\tfileNames[ 1 ],\n\t\t\t\t\t\t\ttextures\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tparams.combine = extension === '.sph'\n\t\t\t\t\t\t\t? MultiplyOperation\n\t\t\t\t\t\t\t: AddOperation;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// gradientMap\n\n\t\t\t\tconst toonFileName = ( material.toonIndex === - 1 )\n\t\t\t\t\t? 'toon00.bmp'\n\t\t\t\t\t: data.toonTextures[ material.toonIndex ].fileName;\n\n\t\t\t\tparams.gradientMap = this._loadTexture(\n\t\t\t\t\ttoonFileName,\n\t\t\t\t\ttextures,\n\t\t\t\t\t{\n\t\t\t\t\t\tisToonTexture: true,\n\t\t\t\t\t\tisDefaultToonTexture: this._isDefaultToonTexture( toonFileName )\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\t// parameters for OutlineEffect\n\n\t\t\t\tparams.userData.outlineParameters = {\n\t\t\t\t\tthickness: material.edgeFlag === 1 ? 0.003 : 0.0,\n\t\t\t\t\tcolor: [ 0, 0, 0 ],\n\t\t\t\t\talpha: 1.0,\n\t\t\t\t\tvisible: material.edgeFlag === 1\n\t\t\t\t};\n\n\t\t\t} else {\n\n\t\t\t\t// map\n\n\t\t\t\tif ( material.textureIndex !== - 1 ) {\n\n\t\t\t\t\tparams.map = this._loadTexture( data.textures[ material.textureIndex ], textures );\n\n\t\t\t\t\t// Since PMX spec don't have standard to list map files except color map and env map,\n\t\t\t\t\t// we need to save file name for further mapping, like matching normal map file names after model loaded.\n\t\t\t\t\t// ref: https://gist.github.com/felixjones/f8a06bd48f9da9a4539f#texture\n\t\t\t\t\tparams.userData.MMD.mapFileName = data.textures[ material.textureIndex ];\n\n\t\t\t\t}\n\n\t\t\t\t// envMap TODO: support m.envFlag === 3\n\n\t\t\t\tif ( material.envTextureIndex !== - 1 && ( material.envFlag === 1 || material.envFlag == 2 ) ) {\n\n\t\t\t\t\tparams.matcap = this._loadTexture(\n\t\t\t\t\t\tdata.textures[ material.envTextureIndex ],\n\t\t\t\t\t\ttextures\n\t\t\t\t\t);\n\n\t\t\t\t\t// Same as color map above, keep file name in userData for further usage.\n\t\t\t\t\tparams.userData.MMD.matcapFileName = data.textures[ material.envTextureIndex ];\n\n\t\t\t\t\tparams.matcapCombine = material.envFlag === 1\n\t\t\t\t\t\t? MultiplyOperation\n\t\t\t\t\t\t: AddOperation;\n\n\t\t\t\t}\n\n\t\t\t\t// gradientMap\n\n\t\t\t\tlet toonFileName, isDefaultToon;\n\n\t\t\t\tif ( material.toonIndex === - 1 || material.toonFlag !== 0 ) {\n\n\t\t\t\t\ttoonFileName = 'toon' + ( '0' + ( material.toonIndex + 1 ) ).slice( - 2 ) + '.bmp';\n\t\t\t\t\tisDefaultToon = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttoonFileName = data.textures[ material.toonIndex ];\n\t\t\t\t\tisDefaultToon = false;\n\n\t\t\t\t}\n\n\t\t\t\tparams.gradientMap = this._loadTexture(\n\t\t\t\t\ttoonFileName,\n\t\t\t\t\ttextures,\n\t\t\t\t\t{\n\t\t\t\t\t\tisToonTexture: true,\n\t\t\t\t\t\tisDefaultToonTexture: isDefaultToon\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\t// parameters for OutlineEffect\n\t\t\t\tparams.userData.outlineParameters = {\n\t\t\t\t\tthickness: material.edgeSize / 300, // TODO: better calculation?\n\t\t\t\t\tcolor: material.edgeColor.slice( 0, 3 ),\n\t\t\t\t\talpha: material.edgeColor[ 3 ],\n\t\t\t\t\tvisible: ( material.flag & 0x10 ) !== 0 && material.edgeSize > 0.0\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tif ( params.map !== undefined ) {\n\n\t\t\t\tif ( ! params.transparent ) {\n\n\t\t\t\t\tthis._checkImageTransparency( params.map, geometry, i );\n\n\t\t\t\t}\n\n\t\t\t\tparams.emissive.multiplyScalar( 0.2 );\n\n\t\t\t}\n\n\t\t\tmaterials.push( new MMDToonMaterial( params ) );\n\n\t\t}\n\n\t\tif ( data.metadata.format === 'pmx' ) {\n\n\t\t\t// set transparent true if alpha morph is defined.\n\n\t\t\tfunction checkAlphaMorph( elements, materials ) {\n\n\t\t\t\tfor ( let i = 0, il = elements.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst element = elements[ i ];\n\n\t\t\t\t\tif ( element.index === - 1 ) continue;\n\n\t\t\t\t\tconst material = materials[ element.index ];\n\n\t\t\t\t\tif ( material.opacity !== element.diffuse[ 3 ] ) {\n\n\t\t\t\t\t\tmaterial.transparent = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = data.morphs.length; i < il; i ++ ) {\n\n\t\t\t\tconst morph = data.morphs[ i ];\n\t\t\t\tconst elements = morph.elements;\n\n\t\t\t\tif ( morph.type === 0 ) {\n\n\t\t\t\t\tfor ( let j = 0, jl = elements.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tconst morph2 = data.morphs[ elements[ j ].index ];\n\n\t\t\t\t\t\tif ( morph2.type !== 8 ) continue;\n\n\t\t\t\t\t\tcheckAlphaMorph( morph2.elements, materials );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( morph.type === 8 ) {\n\n\t\t\t\t\tcheckAlphaMorph( elements, materials );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn materials;\n\n\t}\n\n\t// private methods\n\n\t_getTGALoader() {\n\n\t\tif ( this.tgaLoader === null ) {\n\n\t\t\tif ( TGALoader === undefined ) {\n\n\t\t\t\tthrow new Error( 'THREE.MMDLoader: Import TGALoader' );\n\n\t\t\t}\n\n\t\t\tthis.tgaLoader = new TGALoader( this.manager );\n\n\t\t}\n\n\t\treturn this.tgaLoader;\n\n\t}\n\n\t_isDefaultToonTexture( name ) {\n\n\t\tif ( name.length !== 10 ) return false;\n\n\t\treturn /toon(10|0[0-9])\\.bmp/.test( name );\n\n\t}\n\n\t_loadTexture( filePath, textures, params, onProgress, onError ) {\n\n\t\tparams = params || {};\n\n\t\tconst scope = this;\n\n\t\tlet fullPath;\n\n\t\tif ( params.isDefaultToonTexture === true ) {\n\n\t\t\tlet index;\n\n\t\t\ttry {\n\n\t\t\t\tindex = parseInt( filePath.match( /toon([0-9]{2})\\.bmp$/ )[ 1 ] );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tconsole.warn( 'THREE.MMDLoader: ' + filePath + ' seems like a '\n\t\t\t\t\t\t+ 'not right default texture path. Using toon00.bmp instead.' );\n\n\t\t\t\tindex = 0;\n\n\t\t\t}\n\n\t\t\tfullPath = DEFAULT_TOON_TEXTURES[ index ];\n\n\t\t} else {\n\n\t\t\tfullPath = this.resourcePath + filePath;\n\n\t\t}\n\n\t\tif ( textures[ fullPath ] !== undefined ) return textures[ fullPath ];\n\n\t\tlet loader = this.manager.getHandler( fullPath );\n\n\t\tif ( loader === null ) {\n\n\t\t\tloader = ( filePath.slice( - 4 ).toLowerCase() === '.tga' )\n\t\t\t\t? this._getTGALoader()\n\t\t\t\t: this.textureLoader;\n\n\t\t}\n\n\t\tconst texture = loader.load( fullPath, function ( t ) {\n\n\t\t\t// MMD toon texture is Axis-Y oriented\n\t\t\t// but Three.js gradient map is Axis-X oriented.\n\t\t\t// So here replaces the toon texture image with the rotated one.\n\t\t\tif ( params.isToonTexture === true ) {\n\n\t\t\t\tt.image = scope._getRotatedImage( t.image );\n\n\t\t\t\tt.magFilter = NearestFilter;\n\t\t\t\tt.minFilter = NearestFilter;\n\n\t\t\t}\n\n\t\t\tt.flipY = false;\n\t\t\tt.wrapS = RepeatWrapping;\n\t\t\tt.wrapT = RepeatWrapping;\n\n\t\t\tfor ( let i = 0; i < texture.readyCallbacks.length; i ++ ) {\n\n\t\t\t\ttexture.readyCallbacks[ i ]( texture );\n\n\t\t\t}\n\n\t\t\tdelete texture.readyCallbacks;\n\n\t\t}, onProgress, onError );\n\n\t\ttexture.readyCallbacks = [];\n\n\t\ttextures[ fullPath ] = texture;\n\n\t\treturn texture;\n\n\t}\n\n\t_getRotatedImage( image ) {\n\n\t\tconst canvas = document.createElement( 'canvas' );\n\t\tconst context = canvas.getContext( '2d' );\n\n\t\tconst width = image.width;\n\t\tconst height = image.height;\n\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\n\t\tcontext.clearRect( 0, 0, width, height );\n\t\tcontext.translate( width / 2.0, height / 2.0 );\n\t\tcontext.rotate( 0.5 * Math.PI ); // 90.0 * Math.PI / 180.0\n\t\tcontext.translate( - width / 2.0, - height / 2.0 );\n\t\tcontext.drawImage( image, 0, 0 );\n\n\t\treturn context.getImageData( 0, 0, width, height );\n\n\t}\n\n\t// Check if the partial image area used by the texture is transparent.\n\t_checkImageTransparency( map, geometry, groupIndex ) {\n\n\t\tmap.readyCallbacks.push( function ( texture ) {\n\n\t\t\t// Is there any efficient ways?\n\t\t\tfunction createImageData( image ) {\n\n\t\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\t\tcanvas.width = image.width;\n\t\t\t\tcanvas.height = image.height;\n\n\t\t\t\tconst context = canvas.getContext( '2d' );\n\t\t\t\tcontext.drawImage( image, 0, 0 );\n\n\t\t\t\treturn context.getImageData( 0, 0, canvas.width, canvas.height );\n\n\t\t\t}\n\n\t\t\tfunction detectImageTransparency( image, uvs, indices ) {\n\n\t\t\t\tconst width = image.width;\n\t\t\t\tconst height = image.height;\n\t\t\t\tconst data = image.data;\n\t\t\t\tconst threshold = 253;\n\n\t\t\t\tif ( data.length / ( width * height ) !== 4 ) return false;\n\n\t\t\t\tfor ( let i = 0; i < indices.length; i += 3 ) {\n\n\t\t\t\t\tconst centerUV = { x: 0.0, y: 0.0 };\n\n\t\t\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\t\t\tconst index = indices[ i * 3 + j ];\n\t\t\t\t\t\tconst uv = { x: uvs[ index * 2 + 0 ], y: uvs[ index * 2 + 1 ] };\n\n\t\t\t\t\t\tif ( getAlphaByUv( image, uv ) < threshold ) return true;\n\n\t\t\t\t\t\tcenterUV.x += uv.x;\n\t\t\t\t\t\tcenterUV.y += uv.y;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tcenterUV.x /= 3;\n\t\t\t\t\tcenterUV.y /= 3;\n\n\t\t\t\t\tif ( getAlphaByUv( image, centerUV ) < threshold ) return true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t\t/*\n\t\t\t\t * This method expects\n\t\t\t\t *   texture.flipY = false\n\t\t\t\t *   texture.wrapS = RepeatWrapping\n\t\t\t\t *   texture.wrapT = RepeatWrapping\n\t\t\t\t * TODO: more precise\n\t\t\t\t */\n\t\t\tfunction getAlphaByUv( image, uv ) {\n\n\t\t\t\tconst width = image.width;\n\t\t\t\tconst height = image.height;\n\n\t\t\t\tlet x = Math.round( uv.x * width ) % width;\n\t\t\t\tlet y = Math.round( uv.y * height ) % height;\n\n\t\t\t\tif ( x < 0 ) x += width;\n\t\t\t\tif ( y < 0 ) y += height;\n\n\t\t\t\tconst index = y * width + x;\n\n\t\t\t\treturn image.data[ index * 4 + 3 ];\n\n\t\t\t}\n\n\t\t\tif ( texture.isCompressedTexture === true ) {\n\n\t\t\t\tif ( NON_ALPHA_CHANNEL_FORMATS.includes( texture.format ) ) {\n\n\t\t\t\t\tmap.transparent = false;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// any other way to check transparency of CompressedTexture?\n\t\t\t\t\tmap.transparent = true;\n\n\t\t\t\t}\n\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tconst imageData = texture.image.data !== undefined\n\t\t\t\t? texture.image\n\t\t\t\t: createImageData( texture.image );\n\n\t\t\tconst group = geometry.groups[ groupIndex ];\n\n\t\t\tif ( detectImageTransparency(\n\t\t\t\timageData,\n\t\t\t\tgeometry.attributes.uv.array,\n\t\t\t\tgeometry.index.array.slice( group.start, group.start + group.count ) ) ) {\n\n\t\t\t\tmap.transparent = true;\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n}\n\n//\n\nclass AnimationBuilder {\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n\t * @return {AnimationClip}\n\t */\n\tbuild( vmd, mesh ) {\n\n\t\t// combine skeletal and morph animations\n\n\t\tconst tracks = this.buildSkeletalAnimation( vmd, mesh ).tracks;\n\t\tconst tracks2 = this.buildMorphAnimation( vmd, mesh ).tracks;\n\n\t\tfor ( let i = 0, il = tracks2.length; i < il; i ++ ) {\n\n\t\t\ttracks.push( tracks2[ i ] );\n\n\t\t}\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n\t * @return {AnimationClip}\n\t */\n\tbuildSkeletalAnimation( vmd, mesh ) {\n\n\t\tfunction pushInterpolation( array, interpolation, index ) {\n\n\t\t\tarray.push( interpolation[ index + 0 ] / 127 ); // x1\n\t\t\tarray.push( interpolation[ index + 8 ] / 127 ); // x2\n\t\t\tarray.push( interpolation[ index + 4 ] / 127 ); // y1\n\t\t\tarray.push( interpolation[ index + 12 ] / 127 ); // y2\n\n\t\t}\n\n\t\tconst tracks = [];\n\n\t\tconst motions = {};\n\t\tconst bones = mesh.skeleton.bones;\n\t\tconst boneNameDictionary = {};\n\n\t\tfor ( let i = 0, il = bones.length; i < il; i ++ ) {\n\n\t\t\tboneNameDictionary[ bones[ i ].name ] = true;\n\n\t\t}\n\n\t\tfor ( let i = 0; i < vmd.metadata.motionCount; i ++ ) {\n\n\t\t\tconst motion = vmd.motions[ i ];\n\t\t\tconst boneName = motion.boneName;\n\n\t\t\tif ( boneNameDictionary[ boneName ] === undefined ) continue;\n\n\t\t\tmotions[ boneName ] = motions[ boneName ] || [];\n\t\t\tmotions[ boneName ].push( motion );\n\n\t\t}\n\n\t\tfor ( const key in motions ) {\n\n\t\t\tconst array = motions[ key ];\n\n\t\t\tarray.sort( function ( a, b ) {\n\n\t\t\t\treturn a.frameNum - b.frameNum;\n\n\t\t\t} );\n\n\t\t\tconst times = [];\n\t\t\tconst positions = [];\n\t\t\tconst rotations = [];\n\t\t\tconst pInterpolations = [];\n\t\t\tconst rInterpolations = [];\n\n\t\t\tconst basePosition = mesh.skeleton.getBoneByName( key ).position.toArray();\n\n\t\t\tfor ( let i = 0, il = array.length; i < il; i ++ ) {\n\n\t\t\t\tconst time = array[ i ].frameNum / 30;\n\t\t\t\tconst position = array[ i ].position;\n\t\t\t\tconst rotation = array[ i ].rotation;\n\t\t\t\tconst interpolation = array[ i ].interpolation;\n\n\t\t\t\ttimes.push( time );\n\n\t\t\t\tfor ( let j = 0; j < 3; j ++ ) positions.push( basePosition[ j ] + position[ j ] );\n\t\t\t\tfor ( let j = 0; j < 4; j ++ ) rotations.push( rotation[ j ] );\n\t\t\t\tfor ( let j = 0; j < 3; j ++ ) pushInterpolation( pInterpolations, interpolation, j );\n\n\t\t\t\tpushInterpolation( rInterpolations, interpolation, 3 );\n\n\t\t\t}\n\n\t\t\tconst targetName = '.bones[' + key + ']';\n\n\t\t\ttracks.push( this._createTrack( targetName + '.position', VectorKeyframeTrack, times, positions, pInterpolations ) );\n\t\t\ttracks.push( this._createTrack( targetName + '.quaternion', QuaternionKeyframeTrack, times, rotations, rInterpolations ) );\n\n\t\t}\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n\t * @return {AnimationClip}\n\t */\n\tbuildMorphAnimation( vmd, mesh ) {\n\n\t\tconst tracks = [];\n\n\t\tconst morphs = {};\n\t\tconst morphTargetDictionary = mesh.morphTargetDictionary;\n\n\t\tfor ( let i = 0; i < vmd.metadata.morphCount; i ++ ) {\n\n\t\t\tconst morph = vmd.morphs[ i ];\n\t\t\tconst morphName = morph.morphName;\n\n\t\t\tif ( morphTargetDictionary[ morphName ] === undefined ) continue;\n\n\t\t\tmorphs[ morphName ] = morphs[ morphName ] || [];\n\t\t\tmorphs[ morphName ].push( morph );\n\n\t\t}\n\n\t\tfor ( const key in morphs ) {\n\n\t\t\tconst array = morphs[ key ];\n\n\t\t\tarray.sort( function ( a, b ) {\n\n\t\t\t\treturn a.frameNum - b.frameNum;\n\n\t\t\t} );\n\n\t\t\tconst times = [];\n\t\t\tconst values = [];\n\n\t\t\tfor ( let i = 0, il = array.length; i < il; i ++ ) {\n\n\t\t\t\ttimes.push( array[ i ].frameNum / 30 );\n\t\t\t\tvalues.push( array[ i ].weight );\n\n\t\t\t}\n\n\t\t\ttracks.push( new NumberKeyframeTrack( '.morphTargetInfluences[' + morphTargetDictionary[ key ] + ']', times, values ) );\n\n\t\t}\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @return {AnimationClip}\n\t */\n\tbuildCameraAnimation( vmd ) {\n\n\t\tfunction pushVector3( array, vec ) {\n\n\t\t\tarray.push( vec.x );\n\t\t\tarray.push( vec.y );\n\t\t\tarray.push( vec.z );\n\n\t\t}\n\n\t\tfunction pushQuaternion( array, q ) {\n\n\t\t\tarray.push( q.x );\n\t\t\tarray.push( q.y );\n\t\t\tarray.push( q.z );\n\t\t\tarray.push( q.w );\n\n\t\t}\n\n\t\tfunction pushInterpolation( array, interpolation, index ) {\n\n\t\t\tarray.push( interpolation[ index * 4 + 0 ] / 127 ); // x1\n\t\t\tarray.push( interpolation[ index * 4 + 1 ] / 127 ); // x2\n\t\t\tarray.push( interpolation[ index * 4 + 2 ] / 127 ); // y1\n\t\t\tarray.push( interpolation[ index * 4 + 3 ] / 127 ); // y2\n\n\t\t}\n\n\t\tconst cameras = vmd.cameras === undefined ? [] : vmd.cameras.slice();\n\n\t\tcameras.sort( function ( a, b ) {\n\n\t\t\treturn a.frameNum - b.frameNum;\n\n\t\t} );\n\n\t\tconst times = [];\n\t\tconst centers = [];\n\t\tconst quaternions = [];\n\t\tconst positions = [];\n\t\tconst fovs = [];\n\n\t\tconst cInterpolations = [];\n\t\tconst qInterpolations = [];\n\t\tconst pInterpolations = [];\n\t\tconst fInterpolations = [];\n\n\t\tconst quaternion = new Quaternion();\n\t\tconst euler = new Euler();\n\t\tconst position = new Vector3();\n\t\tconst center = new Vector3();\n\n\t\tfor ( let i = 0, il = cameras.length; i < il; i ++ ) {\n\n\t\t\tconst motion = cameras[ i ];\n\n\t\t\tconst time = motion.frameNum / 30;\n\t\t\tconst pos = motion.position;\n\t\t\tconst rot = motion.rotation;\n\t\t\tconst distance = motion.distance;\n\t\t\tconst fov = motion.fov;\n\t\t\tconst interpolation = motion.interpolation;\n\n\t\t\ttimes.push( time );\n\n\t\t\tposition.set( 0, 0, - distance );\n\t\t\tcenter.set( pos[ 0 ], pos[ 1 ], pos[ 2 ] );\n\n\t\t\teuler.set( - rot[ 0 ], - rot[ 1 ], - rot[ 2 ] );\n\t\t\tquaternion.setFromEuler( euler );\n\n\t\t\tposition.add( center );\n\t\t\tposition.applyQuaternion( quaternion );\n\n\t\t\tpushVector3( centers, center );\n\t\t\tpushQuaternion( quaternions, quaternion );\n\t\t\tpushVector3( positions, position );\n\n\t\t\tfovs.push( fov );\n\n\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\tpushInterpolation( cInterpolations, interpolation, j );\n\n\t\t\t}\n\n\t\t\tpushInterpolation( qInterpolations, interpolation, 3 );\n\n\t\t\t// use the same parameter for x, y, z axis.\n\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\tpushInterpolation( pInterpolations, interpolation, 4 );\n\n\t\t\t}\n\n\t\t\tpushInterpolation( fInterpolations, interpolation, 5 );\n\n\t\t}\n\n\t\tconst tracks = [];\n\n\t\t// I expect an object whose name 'target' exists under THREE.Camera\n\t\ttracks.push( this._createTrack( 'target.position', VectorKeyframeTrack, times, centers, cInterpolations ) );\n\n\t\ttracks.push( this._createTrack( '.quaternion', QuaternionKeyframeTrack, times, quaternions, qInterpolations ) );\n\t\ttracks.push( this._createTrack( '.position', VectorKeyframeTrack, times, positions, pInterpolations ) );\n\t\ttracks.push( this._createTrack( '.fov', NumberKeyframeTrack, times, fovs, fInterpolations ) );\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t// private method\n\n\t_createTrack( node, typedKeyframeTrack, times, values, interpolations ) {\n\n\t\t/*\n\t\t\t * optimizes here not to let KeyframeTrackPrototype optimize\n\t\t\t * because KeyframeTrackPrototype optimizes times and values but\n\t\t\t * doesn't optimize interpolations.\n\t\t\t */\n\t\tif ( times.length > 2 ) {\n\n\t\t\ttimes = times.slice();\n\t\t\tvalues = values.slice();\n\t\t\tinterpolations = interpolations.slice();\n\n\t\t\tconst stride = values.length / times.length;\n\t\t\tconst interpolateStride = interpolations.length / times.length;\n\n\t\t\tlet index = 1;\n\n\t\t\tfor ( let aheadIndex = 2, endIndex = times.length; aheadIndex < endIndex; aheadIndex ++ ) {\n\n\t\t\t\tfor ( let i = 0; i < stride; i ++ ) {\n\n\t\t\t\t\tif ( values[ index * stride + i ] !== values[ ( index - 1 ) * stride + i ] ||\n\t\t\t\t\t\t\tvalues[ index * stride + i ] !== values[ aheadIndex * stride + i ] ) {\n\n\t\t\t\t\t\tindex ++;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( aheadIndex > index ) {\n\n\t\t\t\t\ttimes[ index ] = times[ aheadIndex ];\n\n\t\t\t\t\tfor ( let i = 0; i < stride; i ++ ) {\n\n\t\t\t\t\t\tvalues[ index * stride + i ] = values[ aheadIndex * stride + i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( let i = 0; i < interpolateStride; i ++ ) {\n\n\t\t\t\t\t\tinterpolations[ index * interpolateStride + i ] = interpolations[ aheadIndex * interpolateStride + i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttimes.length = index + 1;\n\t\t\tvalues.length = ( index + 1 ) * stride;\n\t\t\tinterpolations.length = ( index + 1 ) * interpolateStride;\n\n\t\t}\n\n\t\tconst track = new typedKeyframeTrack( node, times, values );\n\n\t\ttrack.createInterpolant = function InterpolantFactoryMethodCubicBezier( result ) {\n\n\t\t\treturn new CubicBezierInterpolation( this.times, this.values, this.getValueSize(), result, new Float32Array( interpolations ) );\n\n\t\t};\n\n\t\treturn track;\n\n\t}\n\n}\n\n// interpolation\n\nclass CubicBezierInterpolation extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer, params ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t\tthis.interpolationParams = params;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\t\tconst params = this.interpolationParams;\n\n\t\tconst offset1 = i1 * stride;\n\t\tconst offset0 = offset1 - stride;\n\n\t\t// No interpolation if next key frame is in one frame in 30fps.\n\t\t// This is from MMD animation spec.\n\t\t// '1.5' is for precision loss. times are Float32 in Three.js Animation system.\n\t\tconst weight1 = ( ( t1 - t0 ) < 1 / 30 * 1.5 ) ? 0.0 : ( t - t0 ) / ( t1 - t0 );\n\n\t\tif ( stride === 4 ) { // Quaternion\n\n\t\t\tconst x1 = params[ i1 * 4 + 0 ];\n\t\t\tconst x2 = params[ i1 * 4 + 1 ];\n\t\t\tconst y1 = params[ i1 * 4 + 2 ];\n\t\t\tconst y2 = params[ i1 * 4 + 3 ];\n\n\t\t\tconst ratio = this._calculate( x1, x2, y1, y2, weight1 );\n\n\t\t\tQuaternion.slerpFlat( result, 0, values, offset0, values, offset1, ratio );\n\n\t\t} else if ( stride === 3 ) { // Vector3\n\n\t\t\tfor ( let i = 0; i !== stride; ++ i ) {\n\n\t\t\t\tconst x1 = params[ i1 * 12 + i * 4 + 0 ];\n\t\t\t\tconst x2 = params[ i1 * 12 + i * 4 + 1 ];\n\t\t\t\tconst y1 = params[ i1 * 12 + i * 4 + 2 ];\n\t\t\t\tconst y2 = params[ i1 * 12 + i * 4 + 3 ];\n\n\t\t\t\tconst ratio = this._calculate( x1, x2, y1, y2, weight1 );\n\n\t\t\t\tresult[ i ] = values[ offset0 + i ] * ( 1 - ratio ) + values[ offset1 + i ] * ratio;\n\n\t\t\t}\n\n\t\t} else { // Number\n\n\t\t\tconst x1 = params[ i1 * 4 + 0 ];\n\t\t\tconst x2 = params[ i1 * 4 + 1 ];\n\t\t\tconst y1 = params[ i1 * 4 + 2 ];\n\t\t\tconst y2 = params[ i1 * 4 + 3 ];\n\n\t\t\tconst ratio = this._calculate( x1, x2, y1, y2, weight1 );\n\n\t\t\tresult[ 0 ] = values[ offset0 ] * ( 1 - ratio ) + values[ offset1 ] * ratio;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\t_calculate( x1, x2, y1, y2, x ) {\n\n\t\t/*\n\t\t\t * Cubic Bezier curves\n\t\t\t *   https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B.C3.A9zier_curves\n\t\t\t *\n\t\t\t * B(t) = ( 1 - t ) ^ 3 * P0\n\t\t\t *      + 3 * ( 1 - t ) ^ 2 * t * P1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * P2\n\t\t\t *      + t ^ 3 * P3\n\t\t\t *      ( 0 <= t <= 1 )\n\t\t\t *\n\t\t\t * MMD uses Cubic Bezier curves for bone and camera animation interpolation.\n\t\t\t *   http://d.hatena.ne.jp/edvakf/20111016/1318716097\n\t\t\t *\n\t\t\t *    x = ( 1 - t ) ^ 3 * x0\n\t\t\t *      + 3 * ( 1 - t ) ^ 2 * t * x1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * x2\n\t\t\t *      + t ^ 3 * x3\n\t\t\t *    y = ( 1 - t ) ^ 3 * y0\n\t\t\t *      + 3 * ( 1 - t ) ^ 2 * t * y1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * y2\n\t\t\t *      + t ^ 3 * y3\n\t\t\t *      ( x0 = 0, y0 = 0 )\n\t\t\t *      ( x3 = 1, y3 = 1 )\n\t\t\t *      ( 0 <= t, x1, x2, y1, y2 <= 1 )\n\t\t\t *\n\t\t\t * Here solves this equation with Bisection method,\n\t\t\t *   https://en.wikipedia.org/wiki/Bisection_method\n\t\t\t * gets t, and then calculate y.\n\t\t\t *\n\t\t\t * f(t) = 3 * ( 1 - t ) ^ 2 * t * x1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * x2\n\t\t\t *      + t ^ 3 - x = 0\n\t\t\t *\n\t\t\t * (Another option: Newton's method\n\t\t\t *    https://en.wikipedia.org/wiki/Newton%27s_method)\n\t\t\t */\n\n\t\tlet c = 0.5;\n\t\tlet t = c;\n\t\tlet s = 1.0 - t;\n\t\tconst loop = 15;\n\t\tconst eps = 1e-5;\n\t\tconst math = Math;\n\n\t\tlet sst3, stt3, ttt;\n\n\t\tfor ( let i = 0; i < loop; i ++ ) {\n\n\t\t\tsst3 = 3.0 * s * s * t;\n\t\t\tstt3 = 3.0 * s * t * t;\n\t\t\tttt = t * t * t;\n\n\t\t\tconst ft = ( sst3 * x1 ) + ( stt3 * x2 ) + ( ttt ) - x;\n\n\t\t\tif ( math.abs( ft ) < eps ) break;\n\n\t\t\tc /= 2.0;\n\n\t\t\tt += ( ft < 0 ) ? c : - c;\n\t\t\ts = 1.0 - t;\n\n\t\t}\n\n\t\treturn ( sst3 * y1 ) + ( stt3 * y2 ) + ttt;\n\n\t}\n\n}\n\nclass MMDToonMaterial extends ShaderMaterial {\n\n\tconstructor( parameters ) {\n\n\t\tsuper();\n\n\t\tthis._matcapCombine = AddOperation;\n\t\tthis.emissiveIntensity = 1.0;\n\t\tthis.normalMapType = TangentSpaceNormalMap;\n\n\t\tthis.combine = MultiplyOperation;\n\n\t\tthis.wireframeLinecap = 'round';\n\t\tthis.wireframeLinejoin = 'round';\n\n\t\tthis.flatShading = false;\n\n\t\tthis.lights = true;\n\n\t\tthis.vertexShader = MMDToonShader.vertexShader;\n\t\tthis.fragmentShader = MMDToonShader.fragmentShader;\n\n\t\tthis.defines = Object.assign( {}, MMDToonShader.defines );\n\t\tObject.defineProperty( this, 'matcapCombine', {\n\n\t\t\tget: function () {\n\n\t\t\t\treturn this._matcapCombine;\n\n\t\t\t},\n\n\t\t\tset: function ( value ) {\n\n\t\t\t\tthis._matcapCombine = value;\n\n\t\t\t\tswitch ( value ) {\n\n\t\t\t\t\tcase MultiplyOperation:\n\t\t\t\t\t\tthis.defines.MATCAP_BLENDING_MULTIPLY = true;\n\t\t\t\t\t\tdelete this.defines.MATCAP_BLENDING_ADD;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\tcase AddOperation:\n\t\t\t\t\t\tthis.defines.MATCAP_BLENDING_ADD = true;\n\t\t\t\t\t\tdelete this.defines.MATCAP_BLENDING_MULTIPLY;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t} );\n\n\t\tthis.uniforms = UniformsUtils.clone( MMDToonShader.uniforms );\n\n\t\t// merged from MeshToon/Phong/MatcapMaterial\n\t\tconst exposePropertyNames = [\n\t\t\t'specular',\n\t\t\t'shininess',\n\t\t\t'opacity',\n\t\t\t'diffuse',\n\n\t\t\t'map',\n\t\t\t'matcap',\n\t\t\t'gradientMap',\n\n\t\t\t'lightMap',\n\t\t\t'lightMapIntensity',\n\n\t\t\t'aoMap',\n\t\t\t'aoMapIntensity',\n\n\t\t\t'emissive',\n\t\t\t'emissiveMap',\n\n\t\t\t'bumpMap',\n\t\t\t'bumpScale',\n\n\t\t\t'normalMap',\n\t\t\t'normalScale',\n\n\t\t\t'displacemantBias',\n\t\t\t'displacemantMap',\n\t\t\t'displacemantScale',\n\n\t\t\t'specularMap',\n\n\t\t\t'alphaMap',\n\n\t\t\t'envMap',\n\t\t\t'reflectivity',\n\t\t\t'refractionRatio',\n\t\t];\n\t\tfor ( const propertyName of exposePropertyNames ) {\n\n\t\t\tObject.defineProperty( this, propertyName, {\n\n\t\t\t\tget: function () {\n\n\t\t\t\t\treturn this.uniforms[ propertyName ].value;\n\n\t\t\t\t},\n\n\t\t\t\tset: function ( value ) {\n\n\t\t\t\t\tthis.uniforms[ propertyName ].value = value;\n\n\t\t\t\t},\n\n\t\t\t} );\n\n\t\t}\n\n\t\tObject.defineProperty(\n\t\t\tthis,\n\t\t\t'color',\n\t\t\tObject.getOwnPropertyDescriptor( this, 'diffuse' )\n\t\t);\n\n\t\tthis.setValues( parameters );\n\n\t}\n\n\tcopy( source ) {\n\n\t\tsuper.copy( source );\n\n\t\tthis.matcapCombine = source.matcapCombine;\n\t\tthis.emissiveIntensity = source.emissiveIntensity;\n\t\tthis.normalMapType = source.normalMapType;\n\n\t\tthis.combine = source.combine;\n\n\t\tthis.wireframeLinecap = source.wireframeLinecap;\n\t\tthis.wireframeLinejoin = source.wireframeLinejoin;\n\n\t\tthis.flatShading = source.flatShading;\n\n\t\treturn this;\n\n\t}\n\n}\n\nMMDToonMaterial.prototype.isMMDToonMaterial = true;\n\nexport { MMDLoader };\n","import {\n\tCompressedTextureLoader,\n\tRGBAFormat,\n\tRGBA_S3TC_DXT3_Format,\n\tRGBA_S3TC_DXT5_Format,\n\tRGB_ETC1_Format,\n\tRGB_S3TC_DXT1_Format\n} from 'three';\n\nclass DDSLoader extends CompressedTextureLoader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tparse( buffer, loadMipmaps ) {\n\n\t\tconst dds = { mipmaps: [], width: 0, height: 0, format: null, mipmapCount: 1 };\n\n\t\t// Adapted from @toji's DDS utils\n\t\t// https://github.com/toji/webgl-texture-utils/blob/master/texture-util/dds.js\n\n\t\t// All values and structures referenced from:\n\t\t// http://msdn.microsoft.com/en-us/library/bb943991.aspx/\n\n\t\tconst DDS_MAGIC = 0x20534444;\n\n\t\t// let DDSD_CAPS = 0x1;\n\t\t// let DDSD_HEIGHT = 0x2;\n\t\t// let DDSD_WIDTH = 0x4;\n\t\t// let DDSD_PITCH = 0x8;\n\t\t// let DDSD_PIXELFORMAT = 0x1000;\n\t\tconst DDSD_MIPMAPCOUNT = 0x20000;\n\t\t// let DDSD_LINEARSIZE = 0x80000;\n\t\t// let DDSD_DEPTH = 0x800000;\n\n\t\t// let DDSCAPS_COMPLEX = 0x8;\n\t\t// let DDSCAPS_MIPMAP = 0x400000;\n\t\t// let DDSCAPS_TEXTURE = 0x1000;\n\n\t\tconst DDSCAPS2_CUBEMAP = 0x200;\n\t\tconst DDSCAPS2_CUBEMAP_POSITIVEX = 0x400;\n\t\tconst DDSCAPS2_CUBEMAP_NEGATIVEX = 0x800;\n\t\tconst DDSCAPS2_CUBEMAP_POSITIVEY = 0x1000;\n\t\tconst DDSCAPS2_CUBEMAP_NEGATIVEY = 0x2000;\n\t\tconst DDSCAPS2_CUBEMAP_POSITIVEZ = 0x4000;\n\t\tconst DDSCAPS2_CUBEMAP_NEGATIVEZ = 0x8000;\n\t\t// let DDSCAPS2_VOLUME = 0x200000;\n\n\t\t// let DDPF_ALPHAPIXELS = 0x1;\n\t\t// let DDPF_ALPHA = 0x2;\n\t\tconst DDPF_FOURCC = 0x4;\n\t\t// let DDPF_RGB = 0x40;\n\t\t// let DDPF_YUV = 0x200;\n\t\t// let DDPF_LUMINANCE = 0x20000;\n\n\t\tfunction fourCCToInt32( value ) {\n\n\t\t\treturn value.charCodeAt( 0 ) +\n\t\t\t\t( value.charCodeAt( 1 ) << 8 ) +\n\t\t\t\t( value.charCodeAt( 2 ) << 16 ) +\n\t\t\t\t( value.charCodeAt( 3 ) << 24 );\n\n\t\t}\n\n\t\tfunction int32ToFourCC( value ) {\n\n\t\t\treturn String.fromCharCode(\n\t\t\t\tvalue & 0xff,\n\t\t\t\t( value >> 8 ) & 0xff,\n\t\t\t\t( value >> 16 ) & 0xff,\n\t\t\t\t( value >> 24 ) & 0xff\n\t\t\t);\n\n\t\t}\n\n\t\tfunction loadARGBMip( buffer, dataOffset, width, height ) {\n\n\t\t\tconst dataLength = width * height * 4;\n\t\t\tconst srcBuffer = new Uint8Array( buffer, dataOffset, dataLength );\n\t\t\tconst byteArray = new Uint8Array( dataLength );\n\t\t\tlet dst = 0;\n\t\t\tlet src = 0;\n\t\t\tfor ( let y = 0; y < height; y ++ ) {\n\n\t\t\t\tfor ( let x = 0; x < width; x ++ ) {\n\n\t\t\t\t\tconst b = srcBuffer[ src ]; src ++;\n\t\t\t\t\tconst g = srcBuffer[ src ]; src ++;\n\t\t\t\t\tconst r = srcBuffer[ src ]; src ++;\n\t\t\t\t\tconst a = srcBuffer[ src ]; src ++;\n\t\t\t\t\tbyteArray[ dst ] = r; dst ++;\t//r\n\t\t\t\t\tbyteArray[ dst ] = g; dst ++;\t//g\n\t\t\t\t\tbyteArray[ dst ] = b; dst ++;\t//b\n\t\t\t\t\tbyteArray[ dst ] = a; dst ++;\t//a\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn byteArray;\n\n\t\t}\n\n\t\tconst FOURCC_DXT1 = fourCCToInt32( 'DXT1' );\n\t\tconst FOURCC_DXT3 = fourCCToInt32( 'DXT3' );\n\t\tconst FOURCC_DXT5 = fourCCToInt32( 'DXT5' );\n\t\tconst FOURCC_ETC1 = fourCCToInt32( 'ETC1' );\n\n\t\tconst headerLengthInt = 31; // The header length in 32 bit ints\n\n\t\t// Offsets into the header array\n\n\t\tconst off_magic = 0;\n\n\t\tconst off_size = 1;\n\t\tconst off_flags = 2;\n\t\tconst off_height = 3;\n\t\tconst off_width = 4;\n\n\t\tconst off_mipmapCount = 7;\n\n\t\tconst off_pfFlags = 20;\n\t\tconst off_pfFourCC = 21;\n\t\tconst off_RGBBitCount = 22;\n\t\tconst off_RBitMask = 23;\n\t\tconst off_GBitMask = 24;\n\t\tconst off_BBitMask = 25;\n\t\tconst off_ABitMask = 26;\n\n\t\t// let off_caps = 27;\n\t\tconst off_caps2 = 28;\n\t\t// let off_caps3 = 29;\n\t\t// let off_caps4 = 30;\n\n\t\t// Parse header\n\n\t\tconst header = new Int32Array( buffer, 0, headerLengthInt );\n\n\t\tif ( header[ off_magic ] !== DDS_MAGIC ) {\n\n\t\t\tconsole.error( 'THREE.DDSLoader.parse: Invalid magic number in DDS header.' );\n\t\t\treturn dds;\n\n\t\t}\n\n\t\tif ( ! header[ off_pfFlags ] & DDPF_FOURCC ) {\n\n\t\t\tconsole.error( 'THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code.' );\n\t\t\treturn dds;\n\n\t\t}\n\n\t\tlet blockBytes;\n\n\t\tconst fourCC = header[ off_pfFourCC ];\n\n\t\tlet isRGBAUncompressed = false;\n\n\t\tswitch ( fourCC ) {\n\n\t\t\tcase FOURCC_DXT1:\n\n\t\t\t\tblockBytes = 8;\n\t\t\t\tdds.format = RGB_S3TC_DXT1_Format;\n\t\t\t\tbreak;\n\n\t\t\tcase FOURCC_DXT3:\n\n\t\t\t\tblockBytes = 16;\n\t\t\t\tdds.format = RGBA_S3TC_DXT3_Format;\n\t\t\t\tbreak;\n\n\t\t\tcase FOURCC_DXT5:\n\n\t\t\t\tblockBytes = 16;\n\t\t\t\tdds.format = RGBA_S3TC_DXT5_Format;\n\t\t\t\tbreak;\n\n\t\t\tcase FOURCC_ETC1:\n\n\t\t\t\tblockBytes = 8;\n\t\t\t\tdds.format = RGB_ETC1_Format;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif ( header[ off_RGBBitCount ] === 32\n\t\t\t\t\t&& header[ off_RBitMask ] & 0xff0000\n\t\t\t\t\t&& header[ off_GBitMask ] & 0xff00\n\t\t\t\t\t&& header[ off_BBitMask ] & 0xff\n\t\t\t\t\t&& header[ off_ABitMask ] & 0xff000000 ) {\n\n\t\t\t\t\tisRGBAUncompressed = true;\n\t\t\t\t\tblockBytes = 64;\n\t\t\t\t\tdds.format = RGBAFormat;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'THREE.DDSLoader.parse: Unsupported FourCC code ', int32ToFourCC( fourCC ) );\n\t\t\t\t\treturn dds;\n\n\t\t\t\t}\n\n\t\t}\n\n\t\tdds.mipmapCount = 1;\n\n\t\tif ( header[ off_flags ] & DDSD_MIPMAPCOUNT && loadMipmaps !== false ) {\n\n\t\t\tdds.mipmapCount = Math.max( 1, header[ off_mipmapCount ] );\n\n\t\t}\n\n\t\tconst caps2 = header[ off_caps2 ];\n\t\tdds.isCubemap = caps2 & DDSCAPS2_CUBEMAP ? true : false;\n\t\tif ( dds.isCubemap && (\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_POSITIVEX ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_NEGATIVEX ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_POSITIVEY ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_NEGATIVEY ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_POSITIVEZ ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_NEGATIVEZ )\n\t\t) ) {\n\n\t\t\tconsole.error( 'THREE.DDSLoader.parse: Incomplete cubemap faces' );\n\t\t\treturn dds;\n\n\t\t}\n\n\t\tdds.width = header[ off_width ];\n\t\tdds.height = header[ off_height ];\n\n\t\tlet dataOffset = header[ off_size ] + 4;\n\n\t\t// Extract mipmaps buffers\n\n\t\tconst faces = dds.isCubemap ? 6 : 1;\n\n\t\tfor ( let face = 0; face < faces; face ++ ) {\n\n\t\t\tlet width = dds.width;\n\t\t\tlet height = dds.height;\n\n\t\t\tfor ( let i = 0; i < dds.mipmapCount; i ++ ) {\n\n\t\t\t\tlet byteArray, dataLength;\n\n\t\t\t\tif ( isRGBAUncompressed ) {\n\n\t\t\t\t\tbyteArray = loadARGBMip( buffer, dataOffset, width, height );\n\t\t\t\t\tdataLength = byteArray.length;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdataLength = Math.max( 4, width ) / 4 * Math.max( 4, height ) / 4 * blockBytes;\n\t\t\t\t\tbyteArray = new Uint8Array( buffer, dataOffset, dataLength );\n\n\t\t\t\t}\n\n\t\t\t\tconst mipmap = { 'data': byteArray, 'width': width, 'height': height };\n\t\t\t\tdds.mipmaps.push( mipmap );\n\n\t\t\t\tdataOffset += dataLength;\n\n\t\t\t\twidth = Math.max( width >> 1, 1 );\n\t\t\t\theight = Math.max( height >> 1, 1 );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn dds;\n\n\t}\n\n}\n\nexport { DDSLoader };\n","// isWebAssemblySupported.js\n// https://stackoverflow.com/a/47880734/2605764\n\nconst isWebAssemblySupported = (() => {\n  try {\n    if (\n      typeof WebAssembly === 'object' &&\n      typeof WebAssembly.instantiate === 'function'\n    ) {\n      const module = new WebAssembly.Module(\n        Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00)\n      );\n      if (module instanceof WebAssembly.Module)\n        return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n    }\n    // eslint-disable-next-line no-empty\n  } catch (e) {}\n  return false;\n})();\n\nexport default isWebAssemblySupported;\n","// loadScriptTag.js\n'use strict';\n\nconst nullFunction = () => null;\n\n/**\n * Load <script> tag. Same id tag will only load once.\n * @param {object} arguments - props will copy to script tag.\n * @param {string} {id} - unique script tag id.\n * @param {function} {onError} - onError function.\n * @param {function} {onLoad} - onLoad function.\n * @returns {Promise} resolved after script loaded.\n */\nconst loadScriptTag = ({\n  id,\n  async,\n  type = 'text/javascript',\n  onError = nullFunction,\n  onLoad = nullFunction,\n  ...rest\n}) =>\n  new Promise((resolve, reject) => {\n    let scriptElement = document.getElementById(id);\n\n    const isScriptMounted = !!scriptElement;\n\n    if (!scriptElement) {\n      scriptElement = document.createElement('script');\n      Object.keys(rest).forEach(key => (scriptElement[key] = rest[key]));\n      scriptElement.id = id;\n      scriptElement.async = true;\n      scriptElement.type = type;\n    }\n\n    const isScriptLoaded = scriptElement.isLoaded;\n    if (isScriptLoaded) {\n      if (scriptElement.isErrored) {\n        const error = new Error('<script>.isErrored is true.');\n        onError({ error });\n        return reject({ error });\n      }\n      onLoad({ event, element: scriptElement });\n      return resolve({ event, element: scriptElement });\n    }\n\n    scriptElement.addEventListener('error', error => {\n      scriptElement.isLoaded = true;\n      scriptElement.isErrored = true;\n      onError({ error });\n      return reject({ error });\n    });\n\n    if (rest.src) {\n      scriptElement.addEventListener('load', event => {\n        scriptElement.isLoaded = true;\n        onLoad({ event, element: scriptElement });\n        return resolve({ event, element: scriptElement });\n      });\n    }\n\n    if (!isScriptMounted) {\n      document.getElementsByTagName('head')[0].appendChild(scriptElement);\n    }\n\n    if (!rest.src) {\n      scriptElement.isLoaded = true;\n      onLoad({ element: scriptElement });\n      return resolve({ element: scriptElement });\n    }\n  });\n\nexport default loadScriptTag;\n","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/Horkeukamui-160.a7373f24.pmx\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/Horkeukamui-185.240b9f31.pmx\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body2_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body2.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth23_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth2.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth3.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth4.dds\";","// horkeukamuiVariables.js\n\nimport Horkeukamui160 from '../../model/Horkeukamui/Horkeukamui-160.pmx';\nimport Horkeukamui185 from '../../model/Horkeukamui/Horkeukamui-185.pmx';\nimport BodyNormal from '../../model/Horkeukamui/tex/body_N.png';\nimport '../../model/Horkeukamui/tex/body.dds';\nimport Body2Normal from '../../model/Horkeukamui/tex/body2_N.png';\nimport '../../model/Horkeukamui/tex/body2.dds';\nimport ClothNormal from '../../model/Horkeukamui/tex/cloth_N.png';\nimport '../../model/Horkeukamui/tex/cloth.dds';\nimport '../../model/Horkeukamui/tex/cloth2.dds';\nimport '../../model/Horkeukamui/tex/cloth3.dds';\nimport '../../model/Horkeukamui/tex/cloth4.dds';\nimport Cloth23Normal from '../../model/Horkeukamui/tex/cloth23_N.png';\nimport '../../model/Horkeukamui/tex/head.dds';\nimport '../../model/Horkeukamui/tex/nose.dds';\nimport '../../model/Horkeukamui/tex/Penis.dds';\nimport '../../model/Horkeukamui/tex/toon.dds';\n\nexport {\n  Horkeukamui160,\n  Horkeukamui185,\n  BodyNormal,\n  Body2Normal,\n  ClothNormal,\n  Cloth23Normal,\n};\n\nexport const englishMap = {\n  pubicHair: '丁毛',\n  fundoshiBack: '屁股兜',\n  fundoshiFront: '肚兜',\n  bigFundoshiFront: '大丁丁肚兜',\n  penis: '小丁丁',\n  bigPenis: '大丁丁',\n};\n","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/head.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/nose.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/Penis.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/toon.dds\";","export default __webpack_public_path__ + \"src/client/motion/wavefile_v2.745b642f.vmd\";","// Main.jsx\nimport React from 'react';\nimport styled from 'styled-components';\nimport throttle from 'lodash/throttle';\nimport * as dat from 'dat.gui';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { MMDLoader } from 'three/examples/jsm/loaders/MMDLoader.js';\nimport { DDSLoader } from 'three/examples/jsm/loaders/DDSLoader.js';\nimport { MMDAnimationHelper } from 'three/examples/jsm/animation/MMDAnimationHelper.js';\nimport {\n  Scene,\n  WebGLRenderer,\n  PerspectiveCamera,\n  AxesHelper,\n  DirectionalLight,\n  DirectionalLightHelper,\n  LoadingManager,\n  TextureLoader,\n  Clock,\n  // ACESFilmicToneMapping,\n  PCFSoftShadowMap,\n  CameraHelper,\n  RepeatWrapping,\n  //MirroredRepeatWrapping,\n  //NearestFilter,\n} from 'three';\n\nimport isWebAssemblySupported from '../resource/isWebAssemblySupported.js';\nimport loadScriptTag from '../resource/loadScriptTag.js';\n\nimport {\n  Horkeukamui160 as Horkeukamui,\n  BodyNormal,\n  Body2Normal,\n  ClothNormal,\n  Cloth23Normal,\n  englishMap,\n} from '../resource/horkeukamuiVariables.js';\nimport WaveMotion from '../../motion/wavefile_v2.vmd';\n\nconst loadingManager = new LoadingManager();\nloadingManager.addHandler(/\\.dds$/i, new DDSLoader());\nconst textureLoader = new TextureLoader(loadingManager);\nconst mmdLoader = new MMDLoader(loadingManager);\nconst initControlKeys = [\n  'fundoshiBack',\n  'fundoshiFront',\n  'penis',\n  'bigFundoshiFront',\n  'bigPenis',\n];\nconst lightControlsConfigs = {\n  intensity: { min: 0, max: 5, step: 0.001 },\n  shadowIntensity: { min: 0, max: 1, step: 0.001 },\n  shadowBoundry: { min: 0, max: 10, step: 0.01 },\n  needShadowHelper: {},\n  positionX: { min: -5, max: 5, step: 0.01 },\n  positionY: { min: -5, max: 5, step: 0.01 },\n  positionZ: { min: -5, max: 5, step: 0.01 },\n};\nconst normalMapParing = {\n  'tex\\\\body.dds': BodyNormal,\n  'tex\\\\body2.dds': Body2Normal,\n  'tex\\\\cloth.dds': ClothNormal,\n  'tex\\\\cloth2.dds': Cloth23Normal,\n  'tex\\\\cloth3.dds': Cloth23Normal,\n};\n\nexport class Main extends React.PureComponent {\n  canvas = React.createRef();\n  gui = null;\n  camera = null;\n  cameraControls = null;\n  scene = null;\n  light = null;\n  lightWithShadow = null;\n  renderer = null;\n  rendererControlFolder = null;\n  clock = null;\n  loadingTimeout = null;\n  animationFrame = null;\n  animationControls = {\n    shouldAnimate: false,\n    fps: 60, // todo\n  };\n  animationToogleUI = null;\n  horkeukamui = null;\n  mmdPhysics = null;\n  mmdAnimationHelper = new MMDAnimationHelper({ afterglow: 2.0 });\n  controlObject = {\n    light: {\n      intensity: 3.5,\n      shadowIntensity: 0.5,\n      shadowBoundry: 4,\n      needShadowHelper: false,\n      positionX: -3,\n      positionY: 4,\n      positionZ: 2,\n    },\n    horkeukamui: {\n      fundoshiBack: true,\n      fundoshiFront: true,\n      penis: true,\n      bigFundoshiFront: false,\n      bigPenis: false,\n      erection: 0,\n    },\n  };\n  controlUIObject = {\n    Light: null,\n    light: {},\n    Horkeukamui: null,\n    HorkeukamuiMorphs: null,\n    horkeukamui: {\n      morphs: {},\n    },\n  };\n\n  updateLights = () => {\n    const {\n      intensity,\n      shadowIntensity,\n      shadowBoundry,\n      needShadowHelper,\n      positionX,\n      positionY,\n      positionZ,\n    } = this.controlObject.light;\n    this.light.intensity = intensity * (1 - shadowIntensity);\n    this.light.position.set(positionX, positionY, positionZ);\n    this.lightHelper.update();\n\n    this.lightWithShadow.intensity = intensity * shadowIntensity;\n    this.lightWithShadow.position.set(positionX, positionY, positionZ);\n    this.lightWithShadow.castShadow = !!shadowIntensity;\n    this.shadowHelper.visible = needShadowHelper && !!shadowIntensity;\n\n    const camera = this.lightWithShadow.shadow.camera;\n    camera.left = -shadowBoundry;\n    camera.right = shadowBoundry;\n    camera.top = shadowBoundry;\n    camera.bottom = -shadowBoundry;\n    camera.updateProjectionMatrix();\n    this.shadowHelper.update();\n    window.requestAnimationFrame(this.renderNextFrame);\n  };\n\n  initScene = () => {\n    this.scene = new Scene();\n    this.scene.add(new AxesHelper(1));\n\n    const light = new DirectionalLight('#ffffff', 2);\n    light.castShadow = false;\n    this.light = light;\n\n    // need to set position before setup light helper.\n    // otherwise the light plane position will off.\n    const { positionX, positionY, positionZ } = this.controlObject.light;\n    this.light.position.set(positionX, positionY, positionZ);\n    this.lightHelper = new DirectionalLightHelper(light, 1);\n\n    const lightWithShadow = light.clone();\n    lightWithShadow.shadow.camera.far = 7;\n    lightWithShadow.shadow.mapSize.set(1024, 1024);\n    lightWithShadow.shadow.normalBias = 0.05;\n    this.lightWithShadow = lightWithShadow;\n    this.shadowHelper = new CameraHelper(lightWithShadow.shadow.camera);\n\n    this.scene.add(light);\n    this.scene.add(this.lightHelper);\n    this.scene.add(lightWithShadow);\n    this.scene.add(this.shadowHelper);\n\n    this.controlUIObject.Light = this.gui.addFolder('Light');\n    const lightControl = this.controlObject.light;\n    const lightControlUI = this.controlUIObject.Light;\n    Object.keys(lightControlsConfigs).forEach(configKey => {\n      const config = lightControlsConfigs[configKey];\n      this.controlUIObject.light[configKey] = lightControlUI.add(\n        lightControl,\n        configKey\n      );\n      if (config.step) {\n        this.controlUIObject.light[configKey] = this.controlUIObject.light[\n          configKey\n        ]\n          .min(config.min)\n          .max(config.max)\n          .step(config.step);\n      }\n      this.controlUIObject.light[configKey] = this.controlUIObject.light[\n        configKey\n      ].onChange(this.updateLights);\n    });\n  };\n\n  initRenderer = () => {\n    const renderer = new WebGLRenderer({\n      canvas: this.canvas.current,\n      antialias: true,\n    });\n    this.renderer = renderer;\n    renderer.physicallyCorrectLights = true;\n    //renderer.toneMapping = ACESFilmicToneMapping;\n    renderer.toneMappingExposure = 1;\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = PCFSoftShadowMap;\n    renderer.setClearColor(0x222f3e);\n    this.rendererControlFolder = this.gui.addFolder('Renderer');\n    this.rendererControlFolder.add(this.renderer, 'physicallyCorrectLights');\n    this.rendererControlFolder\n      .add(this.renderer, 'toneMappingExposure')\n      .min(0)\n      .max(5)\n      .step(0.01);\n    this.rendererControlFolder\n      .add(this.renderer.shadowMap, 'enabled')\n      .name('shadowMapEnabled');\n    this.initCamera();\n    this.handleWindowResize();\n  };\n\n  renderNextFrame = () => {\n    this.renderer.render(this.scene, this.camera);\n  };\n\n  updateMorphControlValues = throttle(() => {\n    const morphControls = this.controlUIObject.horkeukamui.morphs;\n    Object.keys(morphControls).forEach(morphKey => {\n      morphControls[morphKey].updateDisplay();\n    });\n  }, 100);\n\n  tick = () => {\n    this.cameraControls.update();\n    this.mmdAnimationHelper.update(this.clock.getDelta());\n    this.renderNextFrame();\n    this.updateMorphControlValues();\n    if (this.animationControls.shouldAnimate) {\n      this.animationFrame = window.requestAnimationFrame(this.tick);\n    }\n  };\n\n  initCamera = () => {\n    const canvas = this.canvas.current;\n    const width = canvas.clientWidth;\n    const height = canvas.clientHeight;\n\n    this.camera = new PerspectiveCamera(75, width / height, 0.1, 100);\n    this.camera.position.set(1, 2, 3);\n\n    this.cameraControls = new OrbitControls(this.camera, canvas);\n    this.cameraControls.target.set(0, 2, 0);\n    this.cameraControls.update();\n    this.cameraControls.addEventListener('change', () => {\n      if (!this.animationControls.shouldAnimate) {\n        this.renderNextFrame();\n      }\n    });\n  };\n\n  handleWindowResize = throttle(() => {\n    if (!this.canvas.current) {\n      return;\n    }\n    const canvas = this.canvas.current;\n    const renderer = this.renderer;\n    const width = canvas.clientWidth;\n    const height = canvas.clientHeight;\n    renderer.setSize(width, height);\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n    if (!this.animationControls.shouldAnimate) {\n      this.renderNextFrame();\n    }\n  }, 100);\n\n  getMaterial = ({ name }) => {\n    return this.horkeukamui.material.find(m => name === m.name);\n  };\n\n  addKamuiControlllers = () => {\n    this.controlUIObject.Horkeukamui = this.gui.addFolder('Horkeukamui');\n    const kamuiControl = this.controlUIObject.Horkeukamui;\n    this.controlUIObject.horkeukamui.fundoshiBack = kamuiControl\n      .add(this.controlObject.horkeukamui, 'fundoshiBack')\n      .onChange(() => {\n        const material = this.getMaterial({ name: englishMap.fundoshiBack });\n        const visible = this.controlObject.horkeukamui.fundoshiBack;\n        material.visible = visible;\n        material.opacity = +visible;\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.horkeukamui.fundoshiFront = kamuiControl\n      .add(this.controlObject.horkeukamui, 'fundoshiFront')\n      .onChange(() => {\n        const material = this.getMaterial({ name: englishMap.fundoshiFront });\n        const visible = this.controlObject.horkeukamui.fundoshiFront;\n        material.visible = visible;\n        material.opacity = +visible;\n        this.horkeukamui.morphTargetInfluences[77] = 0.2 * +visible;\n        if (visible && this.controlObject.horkeukamui.bigFundoshiFront) {\n          this.controlUIObject.horkeukamui.bigFundoshiFront.setValue(false);\n        }\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.horkeukamui.bigFundoshiFront = kamuiControl\n      .add(this.controlObject.horkeukamui, 'bigFundoshiFront')\n      .onChange(() => {\n        const material = this.getMaterial({\n          name: englishMap.bigFundoshiFront,\n        });\n        const visible = this.controlObject.horkeukamui.bigFundoshiFront;\n        material.visible = visible;\n        material.opacity = +visible;\n        if (visible && this.controlObject.horkeukamui.fundoshiFront) {\n          this.controlUIObject.horkeukamui.fundoshiFront.setValue(false);\n        }\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.horkeukamui.bigPenis = kamuiControl\n      .add(this.controlObject.horkeukamui, 'bigPenis')\n      .onChange(() => {\n        const penisMaterial = this.getMaterial({ name: englishMap.penis });\n        const bigPenisMaterial = this.getMaterial({\n          name: englishMap.bigPenis,\n        });\n        const isBigOne = this.controlObject.horkeukamui.bigPenis;\n        penisMaterial.visible = !isBigOne;\n        penisMaterial.opacity = +!isBigOne;\n        bigPenisMaterial.visible = isBigOne;\n        bigPenisMaterial.opacity = +isBigOne;\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.HorkeukamuiMorphs =\n      this.controlUIObject.Horkeukamui.addFolder('Morphs');\n    Object.keys(this.horkeukamui.morphTargetDictionary).forEach(targetKey => {\n      this.controlUIObject.horkeukamui.morphs[targetKey] =\n        this.controlUIObject.HorkeukamuiMorphs.add(\n          this.horkeukamui.morphTargetInfluences,\n          this.horkeukamui.morphTargetDictionary[targetKey]\n        )\n          .min(0)\n          .max(1)\n          .step(0.01)\n          .name(targetKey)\n          .onChange(() => window.requestAnimationFrame(this.renderNextFrame));\n    });\n  };\n\n  loadModels = () => {\n    mmdLoader.loadWithAnimation(\n      Horkeukamui,\n      [WaveMotion],\n      ({ mesh, animation }) => {\n        mesh.scale.set(0.2, 0.2, 0.2);\n        mesh.position.set(0, 0, 0);\n        mesh.receiveShadow = true;\n        mesh.castShadow = true;\n        this.scene.add(mesh);\n        window.Horkeukamui = mesh;\n        this.horkeukamui = mesh;\n\n        const anisotropy = Math.min(\n          4,\n          this.renderer.capabilities.getMaxAnisotropy()\n        );\n        mesh.material.forEach(m => {\n          m.map.anisotropy = anisotropy;\n          const normalMapFilename =\n            normalMapParing[m.userData.MMD?.mapFileName];\n          if (normalMapFilename) {\n            m.normalMap = textureLoader.load(normalMapFilename);\n            m.normalMap.flipY = false;\n            m.normalMap.wrapS = RepeatWrapping;\n            m.normalMap.wrapT = RepeatWrapping;\n            m.normalMap.anisotropy = anisotropy;\n          }\n        });\n\n        // prevent penis penetrate fundoshiFront.\n        mesh.morphTargetInfluences[77] = 0.2;\n\n        const penisHair = this.getMaterial({ name: englishMap.pubicHair });\n        penisHair.visible = true;\n        penisHair.opacity = 1;\n\n        initControlKeys.forEach(controlKey => {\n          const needDisplay = this.controlObject.horkeukamui[controlKey];\n          const material = this.getMaterial({ name: englishMap[controlKey] });\n          material.visible = needDisplay;\n          material.opacity = +needDisplay;\n        });\n\n        this.mmdAnimationHelper.add(mesh, { animation, physics: true });\n        this.mmdAnimationHelper.enable('animation', false);\n\n        // need to be after animation since animation might change morph influences.\n        this.addKamuiControlllers();\n\n        this.loadingTimeout = window.setTimeout(this.renderNextFrame, 500);\n      }\n    );\n  };\n\n  async componentDidMount() {\n    const loadAmmoPromise = loadScriptTag({\n      id: 'ammo-js',\n      src: isWebAssemblySupported\n        ? 'library/ammo/ammo.99d0ec0.wasm.js'\n        : 'library/ammo/ammo.99d0ec0.js',\n    });\n    this.gui = new dat.GUI({ hideable: true, closed: false, closeOnTop: true });\n    this.clock = new Clock();\n    this.initScene();\n    this.initRenderer();\n    this.updateLights();\n    this.animationToogleUI = this.gui\n      .add(this.animationControls, 'shouldAnimate')\n      .onChange(() => {\n        if (this.animationControls.shouldAnimate) {\n          this.mmdAnimationHelper.enable('animation', true);\n          this.clock.start();\n          this.tick();\n        } else {\n          this.clock.stop();\n          this.mmdAnimationHelper.enable('animation', false);\n        }\n      });\n    window.addEventListener('resize', this.handleWindowResize);\n    await loadAmmoPromise;\n    // Need to init ammo.js async.\n    // https://github.com/mrdoob/three.js/pull/16100\n    const AmmoLib = await window.Ammo();\n    window.Ammo = AmmoLib;\n    this.loadModels();\n  }\n\n  componentWillUnmount() {\n    if (this.gui) {\n      this.gui.destory();\n    }\n    window.cancelAnimationFrame(this.animationFrame);\n    window.removeEventListener('resize', this.handleWindowResize);\n    window.clearTimeout(this.loadingTimeout);\n  }\n\n  render() {\n    return (\n      <StyledMain>\n        <Canvas ref={this.canvas} />\n      </StyledMain>\n    );\n  }\n}\n\nconst StyledMain = styled.div`\n  flex: auto;\n`;\n\nconst Canvas = styled.canvas`\n  width: 100%;\n  height: 100%;\n  background-color: #222f3e;\n`;\n\nexport default Main;\n","export default __webpack_public_path__ + \"img/github-icon.e1201fcc.svg\";","// Footer.jsx\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nimport EmailIcon from '../../img/email-icon.svg';\nimport GithubIcon from '../../img/github-icon.svg';\n\nconst githubBaseUrl = 'https://github.com/bill42362/portfolio';\n\nexport class Footer extends React.PureComponent {\n  render() {\n    const { email, branchName } = this.props;\n    const githubUrl = branchName\n      ? `${githubBaseUrl}/tree/${branchName}`\n      : githubBaseUrl;\n    return (\n      <StyledFooter>\n        <Link href={githubUrl} target=\"_blank\">\n          <img src={GithubIcon} alt=\"github\" />\n        </Link>\n        <Link href={`mailto:${email}`} target=\"_blank\">\n          <img src={EmailIcon} alt=\"email\" />\n        </Link>\n      </StyledFooter>\n    );\n  }\n}\n\nFooter.propTypes = {\n  email: PropTypes.string,\n  branchName: PropTypes.string,\n};\n\nFooter.defaultProps = {\n  email: 'bill42362@gmail.com',\n  branchName: '',\n};\n\nconst StyledFooter = styled.div`\n  flex: none;\n  display: flex;\n  justify-content: center;\n  align-items: flex-end;\n  padding: 20px;\n`;\n\nconst Link = styled.a`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  background-color: #576574;\n\n  & + & {\n    margin-left: 8px;\n  }\n  img {\n    width: 60%;\n    height: auto;\n  }\n`;\n\nexport default Footer;\n","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDY3LDYxSDQ1QzIwLjIxOCw2MSwwLDgxLjE5NiwwLDEwNnYzMDBjMCwyNC43MiwyMC4xMjgsNDUsNDUsNDVoNDIyYzI0LjcyLDAsNDUtMjAuMTI4LDQ1LTQ1VjEwNiBDNTEyLDgxLjI4LDQ5MS44NzIsNjEsNDY3LDYxeiBNNDYwLjc4Niw5MUwyNTYuOTU0LDI5NC44MzNMNTEuMzU5LDkxSDQ2MC43ODZ6IE0zMCwzOTkuNzg4VjExMi4wNjlsMTQ0LjQ3OSwxNDMuMjRMMzAsMzk5Ljc4OHogTTUxLjIxMyw0MjFsMTQ0LjU3LTE0NC41N2w1MC42NTcsNTAuMjIyYzUuODY0LDUuODE0LDE1LjMyNyw1Ljc5NSwyMS4xNjctMC4wNDZMMzE3LDI3Ny4yMTNMNDYwLjc4Nyw0MjFINTEuMjEzeiBNNDgyLDM5OS43ODcgTDMzOC4yMTMsMjU2TDQ4MiwxMTIuMjEyVjM5OS43ODd6Ii8+PC9zdmc+\"","// index.js\n'use strict';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './component/App.jsx';\n\nReactDOM.render(<App />, document.getElementById('app-root'));\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n"],"sourceRoot":""}