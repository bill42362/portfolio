{"version":3,"sources":["webpack:///./src/client/js/component/App.jsx","webpack:///./src/client/img/x-men-school.svg","webpack:///./node_modules/three/examples/jsm/loaders/TGALoader.js","webpack:///./node_modules/three/examples/jsm/loaders/MMDLoader.js","webpack:///./node_modules/three/examples/jsm/loaders/DDSLoader.js","webpack:///./src/client/js/resource/isWebAssemblySupported.js","webpack:///./src/client/js/resource/loadScriptTag.js","webpack:///./src/client/model/Horkeukamui/Horkeukamui-160.pmx","webpack:///./src/client/js/resource/horkeukamuiVariables.js","webpack:///./src/client/model/Horkeukamui/Horkeukamui-185.pmx","webpack:///./src/client/model/Horkeukamui/tex/body_N.png","webpack:///./src/client/model/Horkeukamui/tex/body.dds","webpack:///./src/client/model/Horkeukamui/tex/body2_N.png","webpack:///./src/client/model/Horkeukamui/tex/body2.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth_N.png","webpack:///./src/client/model/Horkeukamui/tex/cloth.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth2.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth3.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth4.dds","webpack:///./src/client/model/Horkeukamui/tex/cloth23_N.png","webpack:///./src/client/model/Horkeukamui/tex/head.dds","webpack:///./src/client/model/Horkeukamui/tex/nose.dds","webpack:///./src/client/model/Horkeukamui/tex/Penis.dds","webpack:///./src/client/model/Horkeukamui/tex/toon.dds","webpack:///./src/client/motion/wavefile_v2.vmd","webpack:///./src/client/js/component/Main.jsx","webpack:///./src/client/img/github-icon.svg","webpack:///./src/client/js/component/Footer.jsx","webpack:///./src/client/img/email-icon.svg","webpack:///./src/client/js/index.js","webpack:///(webpack)/buildin/global.js"],"names":["GlobalStyle","createGlobalStyle","styledNormalize","isServer","window","title","description","branchName","process","env","BRANCH_NAME","__SSR_ENVIRONMENT__","App","request","console","log","defaultTitle","titleTemplate","charSet","name","content","property","StyledApp","src","XMenLogoSource","propTypes","PropTypes","object","defaultProps","styled","div","Body","sheet","props","instance","manager","super","buffer","TGA_TYPE_NO_DATA","TGA_TYPE_INDEXED","TGA_TYPE_RGB","TGA_TYPE_GREY","TGA_TYPE_RLE_INDEXED","TGA_TYPE_RLE_RGB","TGA_TYPE_RLE_GREY","TGA_ORIGIN_MASK","TGA_ORIGIN_SHIFT","TGA_ORIGIN_BL","TGA_ORIGIN_BR","TGA_ORIGIN_UL","TGA_ORIGIN_UR","length","error","offset","Uint8Array","header","id_length","colormap_type","image_type","colormap_index","colormap_length","colormap_size","origin","width","height","pixel_size","flags","tgaCheckHeader","use_rle","use_pal","use_grey","imageData","result","data","pixel_data","palettes","pixel_total","subarray","c","count","i","shift","pixels","set","tgaParse","image","palette","x_start","y_start","x_step","y_step","x_end","y_end","color","x","y","tgaGetImageDataGrey8bits","tgaGetImageDataGrey16bits","colormap","tgaGetImageData8bits","tgaGetImageData16bits","tgaGetImageData24bits","tgaGetImageData32bits","getTgaRGBA","flipY","generateMipmaps","minFilter","this","loader","parser","meshBuilder","animationBuilder","animationPath","url","onLoad","onProgress","onError","builder","setCrossOrigin","crossOrigin","resourcePath","path","extractUrlBase","modelExtension","_extractExtension","toLowerCase","build","Error","loadVMD","vmd","isCamera","buildCameraAnimation","modelUrl","vmdUrl","scope","load","mesh","loadAnimation","animation","_getParser","setMimeType","undefined","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","parsePmd","parsePmx","urls","Array","isArray","vmds","vmdNum","il","push","parseVmd","mergeVmds","isUnicode","text","parseVpd","index","lastIndexOf","slice","Parser","DEFAULT_TOON_TEXTURES","geometryBuilder","materialBuilder","geometry","material","setResourcePath","skeleton","bones","gbone","bone","position","fromArray","pos","quaternion","rotq","scl","scale","parent","add","updateMatrixWorld","initBones","bind","positions","uvs","normals","indices","groups","skinIndices","skinWeights","morphTargets","morphPositions","iks","grants","rigidBodies","constraints","boneTypeTable","metadata","vertexCount","v","vertices","j","jl","normal","uv","faceCount","face","faces","materialCount","materials","rigidBodyCount","body","value","boneIndex","type","Math","max","boneCount","boneData","transformationClass","parentIndex","rigidBodyType","format","ikCount","ik","param","target","effector","iteration","maxAngle","links","link","enabled","indexOf","limitation","angleLimitation","rotationMin","lowerLimitationAngle","rotationMax","upperLimitationAngle","tmp1","tmp2","grantEntryMap","grant","ratio","isLocal","affectRotation","affectPosition","children","visited","rootEntry","grantEntry","parentGrantEntry","traverse","entry","child","updateAttributes","attribute","morph","elementCount","element","elements","morphs","array","morphCount","params","morph2","rigidBody","key","constraintCount","constraint","bodyA","rigidBodyIndex1","bodyB","rigidBodyIndex2","setAttribute","setIndex","addGroup","morphAttributes","morphTargetsRelative","userData","MMD","computeBoundingSphere","textureLoader","tgaLoader","textures","diffuse","opacity","emissive","ambient","transparent","skinning","fog","blending","blendSrc","blendDst","blendSrcAlpha","blendDstAlpha","flag","side","fileName","fileNames","split","map","_loadTexture","extension","envMap","combine","toonFileName","toonIndex","toonTextures","gradientMap","isToonTexture","isDefaultToonTexture","_isDefaultToonTexture","outlineParameters","thickness","edgeFlag","alpha","visible","isDefaultToon","textureIndex","envTextureIndex","envFlag","toonFlag","edgeSize","edgeColor","_checkImageTransparency","multiplyScalar","checkAlphaMorph","test","filePath","fullPath","parseInt","match","e","warn","getHandler","_getTGALoader","texture","t","_getRotatedImage","magFilter","wrapS","wrapT","readyCallbacks","canvas","document","createElement","context","getContext","clearRect","translate","rotate","PI","drawImage","getImageData","groupIndex","getAlphaByUv","round","createImageData","group","centerUV","detectImageTransparency","attributes","start","tracks","buildSkeletalAnimation","tracks2","buildMorphAnimation","pushInterpolation","interpolation","motions","boneNameDictionary","motionCount","motion","boneName","sort","a","b","frameNum","times","rotations","pInterpolations","rInterpolations","basePosition","getBoneByName","toArray","time","rotation","targetName","_createTrack","morphTargetDictionary","morphName","values","weight","pushVector3","vec","z","cameras","centers","quaternions","fovs","cInterpolations","qInterpolations","fInterpolations","euler","center","rot","distance","fov","setFromEuler","applyQuaternion","q","w","node","typedKeyframeTrack","interpolations","stride","interpolateStride","aheadIndex","endIndex","track","createInterpolant","getValueSize","Float32Array","parameterPositions","sampleValues","sampleSize","resultBuffer","interpolationParams","i1","t0","t1","valueSize","offset1","offset0","weight1","x1","x2","y1","y2","_calculate","slerpFlat","s","math","sst3","stt3","ttt","ft","abs","loadMipmaps","dds","mipmaps","mipmapCount","fourCCToInt32","charCodeAt","loadARGBMip","dataOffset","dataLength","srcBuffer","byteArray","dst","g","r","FOURCC_DXT1","FOURCC_DXT3","FOURCC_DXT5","FOURCC_ETC1","Int32Array","blockBytes","fourCC","isRGBAUncompressed","String","fromCharCode","caps2","isCubemap","mipmap","isWebAssemblySupported","WebAssembly","instantiate","module","Module","of","Instance","nullFunction","loadScriptTag","id","async","rest","Promise","resolve","reject","scriptElement","getElementById","isScriptMounted","Object","keys","forEach","isLoaded","isErrored","event","addEventListener","getElementsByTagName","appendChild","Horkeukamui160","Horkeukamui160Model","englishMap","pubicHair","fundoshiBack","fundoshiFront","bigFundoshiFront","penis","bigPenis","loadingManager","LoadingManager","addHandler","DDSLoader","mmdLoader","MMDLoader","initControlKeys","lightControlsConfigs","intensity","min","step","shadowIntensity","shadowBoundry","needShadowHelper","positionX","positionY","positionZ","Main","React","createRef","gui","camera","cameraControls","scene","light","lightWithShadow","renderer","rendererControlFolder","clock","loadingTimeout","animationFrame","animationControls","shouldAnimate","fps","animationToogleUI","horkeukamui","mmdPhysics","mmdAnimationHelper","MMDAnimationHelper","afterglow","controlObject","erection","controlUIObject","Light","Horkeukamui","HorkeukamuiMorphs","updateLights","lightHelper","update","castShadow","shadowHelper","shadow","left","right","top","bottom","updateProjectionMatrix","requestAnimationFrame","renderNextFrame","initScene","Scene","AxesHelper","DirectionalLight","DirectionalLightHelper","clone","far","mapSize","normalBias","CameraHelper","addFolder","lightControl","lightControlUI","configKey","config","onChange","initRenderer","WebGLRenderer","current","antialias","physicallyCorrectLights","toneMappingExposure","shadowMap","PCFSoftShadowMap","setClearColor","initCamera","handleWindowResize","render","tick","getDelta","clientWidth","clientHeight","PerspectiveCamera","OrbitControls","throttle","setSize","setPixelRatio","devicePixelRatio","aspect","getMaterial","find","m","addKamuiControlllers","kamuiControl","morphTargetInfluences","setValue","penisMaterial","bigPenisMaterial","isBigOne","targetKey","loadModels","loadWithAnimation","WaveMotion","receiveShadow","penisHair","controlKey","needDisplay","physics","enable","setTimeout","loadAmmoPromise","dat","hideable","closed","closeOnTop","Clock","stop","Ammo","AmmoLib","destory","cancelAnimationFrame","removeEventListener","clearTimeout","StyledMain","Canvas","ref","PureComponent","githubBaseUrl","Footer","email","githubUrl","StyledFooter","Link","href","GithubIcon","alt","string","ReactDOM","Function","exports"],"mappings":"62CAeA,I,IAAMA,EAAcC,4BAAH,I,EAAA,izB,kBAAA,E,0EACbC,KA6BEC,EAA6B,oBAAXC,OAClBC,EAAQ,YACRC,EAAc,mBACdC,EAAaJ,EACfK,EAAQC,IAAIC,YACZN,OAAOO,oBAAoBJ,WAEzBK,EAAM,SAAC,GAAgB,IAAdC,EAAc,EAAdA,QAGb,OADAC,QAAQC,IAAI,iBAAkBF,GAE5B,oCACE,kBAAC,IAAD,CAAQG,aAAa,YAAYC,cAAc,kBAC7C,0BAAMC,QAAQ,UACd,0BAAMC,KAAK,WAAWC,QAAQ,wCAE9B,0BAAMD,KAAK,SAASC,QAAQ,SAC5B,0BAAMD,KAAK,cAAcC,QAASd,IAElC,0BACEe,SAAS,SACTD,QAAQ,2CAEV,0BAAMC,SAAS,UAAUD,QAAQ,YACjC,0BAAMC,SAAS,WAAWD,QAASf,IACnC,0BAAMgB,SAAS,iBAAiBD,QAASd,IACzC,0BAAMe,SAAS,eAAeD,QAASf,IACvC,0BAAMgB,SAAS,eAAeD,QAAQ,YACtC,0BAAMC,SAAS,eAAeD,QAAQ,qBAGxC,kBAACpB,EAAD,MACA,kBAACsB,EAAD,MACIlB,QAAU,yBAAKmB,IAAKC,IAAgBnB,MAAM,kBAC5C,kBAAC,IAAD,MACA,kBAAC,IAAD,CAAQE,WAAYA,OAM5BK,EAAIa,UAAY,CACdZ,QAASa,IAAUC,QAGrBf,EAAIgB,aAAe,CACjBf,QAAS,MAGX,IAAMS,EAAYO,UAAOC,IAAV,qEAAGD,CAAH,sGAQTE,EAAO,SAAC,GAAwB,IAAtBC,EAAsB,EAAtBA,MAAUC,EAAY,eACpC,OAAID,EAAME,SAEN,kBAAC,oBAAD,CAAmBF,MAAOA,EAAME,UAC9B,kBAACtB,EAAQqB,IAIN,kBAACrB,EAAQqB,IAIpBF,EAAKN,UAAL,OACKb,EAAIa,WADT,IAEEO,MAAON,IAAUC,SAGnBI,EAAKH,aAAL,OACKhB,EAAIgB,cADT,IAEEI,MAAO,KAGUD,Q,mDC5HJ,QAA0B,iC,4MCKzC,MAAM,UAAkB,IAEvB,YAAaI,GAEZC,MAAOD,GAIR,MAAOE,GA4YN,MAAMC,EAAmB,EACxBC,EAAmB,EACnBC,EAAe,EACfC,EAAgB,EAChBC,EAAuB,EACvBC,EAAmB,GACnBC,EAAoB,GAEpBC,EAAkB,GAClBC,EAAmB,EACnBC,EAAgB,EAChBC,EAAgB,EAChBC,EAAgB,EAChBC,EAAgB,EAEZb,EAAOc,OAAS,IAAKrC,QAAQsC,MAAO,uDAEzC,IAAIC,EAAS,EAEb,MAAMjC,EAAU,IAAIkC,WAAYjB,GAC/BkB,EAAS,CACRC,UAAWpC,EAASiC,KACpBI,cAAerC,EAASiC,KACxBK,WAAYtC,EAASiC,KACrBM,eAAgBvC,EAASiC,KAAcjC,EAASiC,MAAe,EAC/DO,gBAAiBxC,EAASiC,KAAcjC,EAASiC,MAAe,EAChEQ,cAAezC,EAASiC,KACxBS,OAAQ,CACP1C,EAASiC,KAAcjC,EAASiC,MAAe,EAC/CjC,EAASiC,KAAcjC,EAASiC,MAAe,GAEhDU,MAAO3C,EAASiC,KAAcjC,EAASiC,MAAe,EACtDW,OAAQ5C,EAASiC,KAAcjC,EAASiC,MAAe,EACvDY,WAAY7C,EAASiC,KACrBa,MAAO9C,EAASiC,OA1alB,SAAyBE,GAExB,OAASA,EAAOG,YAIf,KAAKnB,EACL,KAAKG,GACCa,EAAOK,gBAAkB,KAAgC,KAAzBL,EAAOM,eAAiD,IAAzBN,EAAOE,gBAE1E3C,QAAQsC,MAAO,iEAIhB,MAID,KAAKZ,EACL,KAAKC,EACL,KAAKE,EACL,KAAKC,EACCW,EAAOE,eAEX3C,QAAQsC,MAAO,kEAIhB,MAID,KAAKd,EACJxB,QAAQsC,MAAO,6BAIhB,QACCtC,QAAQsC,MAAO,sCAAuCG,EAAOG,aAM1DH,EAAOQ,OAAS,GAAKR,EAAOS,QAAU,IAE1ClD,QAAQsC,MAAO,wCAMW,IAAtBG,EAAOU,YAA0C,KAAtBV,EAAOU,YAChB,KAAtBV,EAAOU,YAA2C,KAAtBV,EAAOU,YAEnCnD,QAAQsC,MAAO,4CAA6CG,EAAOU,YAwXrEE,CAAgBZ,GAEXA,EAAOC,UAAYH,EAAShB,EAAOc,QAEvCrC,QAAQsC,MAAO,6BAMhBC,GAAUE,EAAOC,UAIjB,IAAIY,GAAU,EACbC,GAAU,EACVC,GAAW,EAEZ,OAASf,EAAOG,YAEf,KAAKhB,EACJ0B,GAAU,EACVC,GAAU,EACV,MAED,KAAK9B,EACJ8B,GAAU,EACV,MAED,KAAK1B,EACJyB,GAAU,EACV,MAED,KAAK5B,EACJ,MAED,KAAKI,EACJwB,GAAU,EACVE,GAAW,EACX,MAED,KAAK7B,EACJ6B,GAAW,EAOb,MAAMC,EAAY,IAAIjB,WAAYC,EAAOQ,MAAQR,EAAOS,OAAS,GAC3DQ,EAlaN,SAAmBJ,EAASC,EAASd,EAAQF,EAAQoB,GAEpD,IAAIC,EACHC,EAED,MAAMV,EAAaV,EAAOU,YAAc,EAClCW,EAAcrB,EAAOQ,MAAQR,EAAOS,OAASC,EAYlD,GARKI,IAEJM,EAAWF,EAAKI,SAAUxB,EAAQA,GAAUE,EAAOK,iBAAoBL,EAAOM,eAAiB,KAM3FO,EAAU,CAIf,IAAIU,EAAGC,EAAOC,EAFbN,EAAa,IAAIpB,WAAYsB,GAG9B,IAAIK,EAAQ,EACZ,MAAMC,EAAS,IAAI5B,WAAYW,GAE/B,KAAQgB,EAAQL,GAOf,GALAE,EAAIL,EAAMpB,KACV0B,EAAuB,GAAT,IAAJD,GAID,IAAJA,EAAW,CAIf,IAAME,EAAI,EAAGA,EAAIf,IAAee,EAE/BE,EAAQF,GAAMP,EAAMpB,KAMrB,IAAM2B,EAAI,EAAGA,EAAID,IAAUC,EAE1BN,EAAWS,IAAKD,EAAQD,EAAQD,EAAIf,GAIrCgB,GAAShB,EAAac,MAEhB,CAMN,IAFAA,GAASd,EAEHe,EAAI,EAAGA,EAAID,IAAUC,EAE1BN,EAAYO,EAAQD,GAAMP,EAAMpB,KAIjC4B,GAASF,QAUXL,EAAaD,EAAKI,SAChBxB,EAAQA,GAAYgB,EAAUd,EAAOQ,MAAQR,EAAOS,OAASY,GAK/D,MAAO,CACPF,WAAYA,EACZC,SAAUA,GA+UGS,CAAUhB,EAASC,EAASd,EAAQF,EAAQjC,GAG3D,OArMA,SAAqBqD,EAAMV,EAAOC,EAAQqB,EAAOC,GAEhD,IAAIC,EACHC,EACAC,EACAC,EACAC,EACAC,EAED,QAAWrC,EAAOW,MAAQrB,IAAqBC,GAE9C,QACA,KAAKG,EACJsC,EAAU,EACVE,EAAS,EACTE,EAAQ5B,EACRyB,EAAU,EACVE,EAAS,EACTE,EAAQ5B,EACR,MAED,KAAKjB,EACJwC,EAAU,EACVE,EAAS,EACTE,EAAQ5B,EACRyB,EAAUxB,EAAS,EACnB0B,GAAW,EACXE,GAAU,EACV,MAED,KAAK1C,EACJqC,EAAUxB,EAAQ,EAClB0B,GAAW,EACXE,GAAU,EACVH,EAAU,EACVE,EAAS,EACTE,EAAQ5B,EACR,MAED,KAAKhB,EACJuC,EAAUxB,EAAQ,EAClB0B,GAAW,EACXE,GAAU,EACVH,EAAUxB,EAAS,EACnB0B,GAAW,EACXE,GAAU,EAKZ,GAAKtB,EAEJ,OAASf,EAAOU,YAEf,KAAK,GAnGR,SAAmCM,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAE7F,IAAIQ,EAAcC,EAAGC,EAAVf,EAAI,EACf,MAAMjB,EAAQR,EAAOQ,MAErB,IAAMgC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAEpC,IAAMI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQT,IAE5Ca,EAAQR,EAAOL,GACfT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMF,EACzCtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMF,EACzCtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMF,EACzCtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAM,IAuFxCC,CAA0BvB,EAAMe,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAChF,MAED,KAAK,IAhFR,SAAoCd,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAE9F,IAAWS,EAAGC,EAAVf,EAAI,EACR,MAAMjB,EAAQR,EAAOQ,MAErB,IAAMgC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAEpC,IAAMI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQT,GAAK,EAEjDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GAqEnDiB,CAA2BxB,EAAMe,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GACjF,MAED,QACCvE,QAAQsC,MAAO,+CAOjB,OAASG,EAAOU,YAEf,KAAK,GAhNR,SAA+BM,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,EAAOV,GAEhG,MAAMuB,EAAWvB,EACjB,IAAIkB,EAAcC,EAAGC,EAAVf,EAAI,EACf,MAAMjB,EAAQR,EAAOQ,MAErB,IAAMgC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAEpC,IAAMI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQT,IAE5Ca,EAAQR,EAAOL,GACfT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAM,IACzCxB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMG,EAAoB,EAARL,EAAc,GACnEtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMG,EAAoB,EAARL,EAAc,GACnEtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMG,EAAoB,EAARL,EAAc,GAmMlEM,CAAsB1B,EAAMe,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,EAAOC,GACnF,MAED,KAAK,IA5LR,SAAgCf,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAE1F,IAAIQ,EAAcC,EAAGC,EAAVf,EAAI,EACf,MAAMjB,EAAQR,EAAOQ,MAErB,IAAMgC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAEpC,IAAMI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQT,GAAK,EAEjDa,EAAQR,EAAOL,EAAI,IAAQK,EAAOL,EAAI,IAAO,GAC7CT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,IAAgB,MAARF,IAAoB,EAC/DtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,IAAgB,IAARF,IAAoB,EAC/DtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,IAAgB,GAARF,IAAoB,EAC/DtB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAgB,MAARF,EAAmB,EAAI,IAgLjEO,CAAuB3B,EAAMe,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAC7E,MAED,KAAK,IAzKR,SAAgCd,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAE1F,IAAWS,EAAGC,EAAVf,EAAI,EACR,MAAMjB,EAAQR,EAAOQ,MAErB,IAAMgC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAEpC,IAAMI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQT,GAAK,EAEjDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAM,IACzCxB,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GA8JnDqB,CAAuB5B,EAAMe,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAC7E,MAED,KAAK,IAvJR,SAAgCd,EAAWiB,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAE1F,IAAWS,EAAGC,EAAVf,EAAI,EACR,MAAMjB,EAAQR,EAAOQ,MAErB,IAAMgC,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAEpC,IAAMI,EAAIP,EAASO,IAAMH,EAAOG,GAAKL,EAAQT,GAAK,EAEjDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GACpDT,EAA+B,GAAlBuB,EAAI/B,EAAQgC,GAAU,GAAMV,EAAOL,EAAI,GA4InDsB,CAAuB7B,EAAMe,EAASE,EAAQE,EAAOL,EAASE,EAAQE,EAAON,GAC7E,MAED,QACCvE,QAAQsC,MAAO,2CA0GnBmD,CAAYhC,EAAWhB,EAAOQ,MAAOR,EAAOS,OAAQQ,EAAOE,WAAYF,EAAOG,UAEvE,CAENF,KAAMF,EACNR,MAAOR,EAAOQ,MACdC,OAAQT,EAAOS,OACfwC,OAAO,EACPC,iBAAiB,EACjBC,UAAW,M,YCzbd,MAAM,UAAkB,IAEvB,YAAavE,GAEZC,MAAOD,GAEPwE,KAAKC,OAAS,IAAI,IAAYD,KAAKxE,SAEnCwE,KAAKE,OAAS,KACdF,KAAKG,YAAc,IAAI,EAAaH,KAAKxE,SACzCwE,KAAKI,iBAAmB,IAAI,EAQ7B,iBAAkBC,GAGjB,OADAL,KAAKK,cAAgBA,EACdL,KAcR,KAAMM,EAAKC,EAAQC,EAAYC,GAE9B,MAAMC,EAAUV,KAAKG,YAAYQ,eAAgBX,KAAKY,aAItD,IAAIC,EAIHA,EAF0B,KAAtBb,KAAKa,aAEMb,KAAKa,aAEK,KAAdb,KAAKc,KAEDd,KAAKc,KAIL,IAAYC,eAAgBT,GAI5C,MAAMU,EAAiBhB,KAAKiB,kBAAmBX,GAAMY,cAG7B,QAAnBF,GAA+C,QAAnBA,EAQjChB,KAAyB,QAAnBgB,EAA2B,UAAY,WAAaV,GAAK,SAAWxC,GAEzEyC,EAAQG,EAAQS,MAAOrD,EAAM+C,EAAcL,EAAYC,MAErDD,EAAYC,GAVTA,GAAUA,EAAS,IAAIW,MAAO,kDAAoDJ,EAAiB,MAwB1G,cAAeV,EAAKtF,EAAQuF,EAAQC,EAAYC,GAE/C,MAAMC,EAAUV,KAAKI,iBAErBJ,KAAKqB,QAASf,GAAK,SAAWgB,GAE7Bf,EAAQvF,EAAOuG,SACZb,EAAQc,qBAAsBF,GAC9BZ,EAAQS,MAAOG,EAAKtG,MAErBwF,EAAYC,GAehB,kBAAmBgB,EAAUC,EAAQnB,EAAQC,EAAYC,GAExD,MAAMkB,EAAQ3B,KAEdA,KAAK4B,KAAMH,GAAU,SAAWI,GAE/BF,EAAMG,cAAeJ,EAAQG,GAAM,SAAWE,GAE7CxB,EAAQ,CACPsB,KAAMA,EACNE,UAAWA,MAGVvB,EAAYC,KAEbD,EAAYC,GAchB,QAASH,EAAKC,EAAQC,EAAYC,GAEjC,MAAMP,EAASF,KAAKgC,aAEpBhC,KAAKC,OACHgC,iBAAaC,GACbC,QAASnC,KAAKc,MACdsB,gBAAiB,eACjBC,iBAAkBrC,KAAKsC,eACvBC,mBAAoBvC,KAAKwC,iBACzBZ,KAAMtB,GAAK,SAAW5E,GAEtB6E,EAAQL,EAAOuC,SAAU/G,GAAQ,MAE/B8E,EAAYC,GAYjB,QAASH,EAAKC,EAAQC,EAAYC,GAEjC,MAAMP,EAASF,KAAKgC,aAEpBhC,KAAKC,OACHgC,iBAAaC,GACbC,QAASnC,KAAKc,MACdsB,gBAAiB,eACjBC,iBAAkBrC,KAAKsC,eACvBC,mBAAoBvC,KAAKwC,iBACzBZ,KAAMtB,GAAK,SAAW5E,GAEtB6E,EAAQL,EAAOwC,SAAUhH,GAAQ,MAE/B8E,EAAYC,GAajB,QAASH,EAAKC,EAAQC,EAAYC,GAEjC,MAAMkC,EAAOC,MAAMC,QAASvC,GAAQA,EAAM,CAAEA,GAEtCwC,EAAO,GACPC,EAASJ,EAAKnG,OAEd0D,EAASF,KAAKgC,aAEpBhC,KAAKC,OACHgC,iBAAaC,GACbC,QAASnC,KAAKK,eACd+B,gBAAiB,eACjBC,iBAAkBrC,KAAKsC,eACvBC,mBAAoBvC,KAAKwC,iBAE3B,IAAM,IAAInE,EAAI,EAAG2E,EAAKL,EAAKnG,OAAQ6B,EAAI2E,EAAI3E,IAE1C2B,KAAKC,OAAO2B,KAAMe,EAAMtE,IAAK,SAAW3C,GAEvCoH,EAAKG,KAAM/C,EAAOgD,SAAUxH,GAAQ,IAE/BoH,EAAKtG,SAAWuG,GAASxC,EAAQL,EAAOiD,UAAWL,MAEtDtC,EAAYC,GAejB,QAASH,EAAK8C,EAAW7C,EAAQC,EAAYC,GAE5C,MAAMP,EAASF,KAAKgC,aAEpBhC,KAAKC,OACHgC,YAAamB,OAAYlB,EAAY,iCACrCC,QAASnC,KAAKK,eACd+B,gBAAiB,QACjBC,iBAAkBrC,KAAKsC,eACvBC,mBAAoBvC,KAAKwC,iBACzBZ,KAAMtB,GAAK,SAAW+C,GAEtB9C,EAAQL,EAAOoD,SAAUD,GAAM,MAE7B7C,EAAYC,GAMjB,kBAAmBH,GAElB,MAAMiD,EAAQjD,EAAIkD,YAAa,KAC/B,OAAOD,EAAQ,EAAI,GAAKjD,EAAImD,MAAOF,EAAQ,GAI5C,aAEC,GAAqB,OAAhBvD,KAAKE,OAAkB,CAE3B,QAA0B,IAAd,IAEX,MAAM,IAAIkB,MAAO,6EAIlBpB,KAAKE,OAAS,IAAI,IAAUwD,OAI7B,OAAO1D,KAAKE,QAad,MAAMyD,EAAwB,CAC7B,qKACA,iLACA,iLACA,iLACA,qLACA,6gBACA,i1BACA,qKACA,qKACA,qKACA,sKAQD,MAAM,EAEL,YAAanI,GAEZwE,KAAKY,YAAc,YACnBZ,KAAK4D,gBAAkB,IAAI,EAC3B5D,KAAK6D,gBAAkB,IAAI,EAAiBrI,GAQ7C,eAAgBoF,GAGf,OADAZ,KAAKY,YAAcA,EACZZ,KAWR,MAAOlC,EAAM+C,EAAcL,EAAYC,GAEtC,MAAMqD,EAAW9D,KAAK4D,gBAAgBzC,MAAOrD,GACvCiG,EAAW/D,KAAK6D,gBACpBlD,eAAgBX,KAAKY,aACrBoD,gBAAiBnD,GACjBM,MAAOrD,EAAMgG,EAAUtD,EAAYC,GAE/BoB,EAAO,IAAI,KAAaiC,EAAUC,GAElCE,EAAW,IAAI,KAavB,SAAoBpC,GAEnB,MAAMiC,EAAWjC,EAAKiC,SAEhBI,EAAQ,GAEd,GAAKJ,QAA+B5B,IAAnB4B,EAASI,MAAsB,CAI/C,IAAM,IAAI7F,EAAI,EAAG2E,EAAKc,EAASI,MAAM1H,OAAQ6B,EAAI2E,EAAI3E,IAAO,CAE3D,MAAM8F,EAAQL,EAASI,MAAO7F,GAIxB+F,EAAO,IAAI,IACjBF,EAAMjB,KAAMmB,GAIZA,EAAK5J,KAAO2J,EAAM3J,KAClB4J,EAAKC,SAASC,UAAWH,EAAMI,KAC/BH,EAAKI,WAAWF,UAAWH,EAAMM,WACdvC,IAAdiC,EAAMO,KAAoBN,EAAKO,MAAML,UAAWH,EAAMO,KAM5D,IAAM,IAAIrG,EAAI,EAAG2E,EAAKc,EAASI,MAAM1H,OAAQ6B,EAAI2E,EAAI3E,IAAO,CAE3D,MAAM8F,EAAQL,EAASI,MAAO7F,IAEJ,IAAnB8F,EAAMS,QAAuC,OAAjBT,EAAMS,aAAiD1C,IAA1BgC,EAAOC,EAAMS,QAI5EV,EAAOC,EAAMS,QAASC,IAAKX,EAAO7F,IAMlCwD,EAAKgD,IAAKX,EAAO7F,KAapB,OAFAwD,EAAKiD,mBAAmB,GAEjBZ,EAtEyBa,CAAWlD,IAK1C,OAJAA,EAAKmD,KAAMf,GAIJpC,GAuET,MAAM,EAML,MAAO/D,GAGN,MAAMmH,EAAY,GACZC,EAAM,GACNC,EAAU,GAEVC,EAAU,GAEVC,EAAS,GAETnB,EAAQ,GACRoB,EAAc,GACdC,EAAc,GAEdC,EAAe,GACfC,EAAiB,GAEjBC,EAAM,GACNC,EAAS,GAETC,EAAc,GACdC,EAAc,GAGpB,IAAInJ,EAAS,EACb,MAAMoJ,EAAgB,GAItB,IAAM,IAAIzH,EAAI,EAAGA,EAAIP,EAAKiI,SAASC,YAAa3H,IAAO,CAEtD,MAAM4H,EAAInI,EAAKoI,SAAU7H,GAEzB,IAAM,IAAI8H,EAAI,EAAGC,EAAKH,EAAE5B,SAAS7H,OAAQ2J,EAAIC,EAAID,IAEhDlB,EAAUhC,KAAMgD,EAAE5B,SAAU8B,IAI7B,IAAM,IAAIA,EAAI,EAAGC,EAAKH,EAAEI,OAAO7J,OAAQ2J,EAAIC,EAAID,IAE9ChB,EAAQlC,KAAMgD,EAAEI,OAAQF,IAIzB,IAAM,IAAIA,EAAI,EAAGC,EAAKH,EAAEK,GAAG9J,OAAQ2J,EAAIC,EAAID,IAE1CjB,EAAIjC,KAAMgD,EAAEK,GAAIH,IAIjB,IAAM,IAAIA,EAAI,EAAGA,EAAI,EAAGA,IAEvBb,EAAYrC,KAAMgD,EAAEX,YAAY9I,OAAS,GAAK2J,EAAIF,EAAEX,YAAaa,GAAM,GAIxE,IAAM,IAAIA,EAAI,EAAGA,EAAI,EAAGA,IAEvBZ,EAAYtC,KAAMgD,EAAEV,YAAY/I,OAAS,GAAK2J,EAAIF,EAAEV,YAAaY,GAAM,GAQzE,IAAM,IAAI9H,EAAI,EAAGA,EAAIP,EAAKiI,SAASQ,UAAWlI,IAAO,CAEpD,MAAMmI,EAAO1I,EAAK2I,MAAOpI,GAEzB,IAAM,IAAI8H,EAAI,EAAGC,EAAKI,EAAKpB,QAAQ5I,OAAQ2J,EAAIC,EAAID,IAElDf,EAAQnC,KAAMuD,EAAKpB,QAASe,IAQ9B,IAAM,IAAI9H,EAAI,EAAGA,EAAIP,EAAKiI,SAASW,cAAerI,IAAO,CAExD,MAAM0F,EAAWjG,EAAK6I,UAAWtI,GAEjCgH,EAAOpC,KAAM,CACZvG,OAAiB,EAATA,EACR0B,MAA4B,EAArB2F,EAASwC,YAGjB7J,GAAUqH,EAASwC,UAMpB,IAAM,IAAIlI,EAAI,EAAGA,EAAIP,EAAKiI,SAASa,eAAgBvI,IAAO,CAEzD,MAAMwI,EAAO/I,EAAK8H,YAAavH,GAC/B,IAAIyI,EAAQhB,EAAee,EAAKE,WAGhCD,OAAkB5E,IAAV4E,EAAsBD,EAAKG,KAAOC,KAAKC,IAAKL,EAAKG,KAAMF,GAE/DhB,EAAee,EAAKE,WAAcD,EAInC,IAAM,IAAIzI,EAAI,EAAGA,EAAIP,EAAKiI,SAASoB,UAAW9I,IAAO,CAEpD,MAAM+I,EAAWtJ,EAAKoG,MAAO7F,GAEvB+F,EAAO,CACZb,MAAOlF,EACPgJ,oBAAqBD,EAASC,oBAC9BzC,OAAQwC,EAASE,YACjB9M,KAAM4M,EAAS5M,KACf+J,IAAK6C,EAAS/C,SAASZ,MAAO,EAAG,GACjCgB,KAAM,CAAE,EAAG,EAAG,EAAG,GACjBC,IAAK,CAAE,EAAG,EAAG,GACb6C,mBAAsCrF,IAAvB4D,EAAezH,GAAoByH,EAAezH,IAAQ,IAGnD,IAAlB+F,EAAKQ,SAETR,EAAKG,IAAK,IAAOzG,EAAKoG,MAAOE,EAAKQ,QAASP,SAAU,GACrDD,EAAKG,IAAK,IAAOzG,EAAKoG,MAAOE,EAAKQ,QAASP,SAAU,GACrDD,EAAKG,IAAK,IAAOzG,EAAKoG,MAAOE,EAAKQ,QAASP,SAAU,IAItDH,EAAMjB,KAAMmB,GAOb,GAA8B,QAAzBtG,EAAKiI,SAASyB,OAElB,IAAM,IAAInJ,EAAI,EAAGA,EAAIP,EAAKiI,SAAS0B,QAASpJ,IAAO,CAElD,MAAMqJ,EAAK5J,EAAK4H,IAAKrH,GAEfsJ,EAAQ,CACbC,OAAQF,EAAGE,OACXC,SAAUH,EAAGG,SACbC,UAAWJ,EAAGI,UACdC,SAAwB,EAAdL,EAAGK,SACbC,MAAO,IAGR,IAAM,IAAI7B,EAAI,EAAGC,EAAKsB,EAAGM,MAAMxL,OAAQ2J,EAAIC,EAAID,IAAO,CAErD,MAAM8B,EAAO,GACbA,EAAK1E,MAAQmE,EAAGM,MAAO7B,GAAI5C,MAC3B0E,EAAKC,SAAU,EAEVpK,EAAKoG,MAAO+D,EAAK1E,OAAQ/I,KAAK2N,QAAS,OAAU,IAErDF,EAAKG,WAAa,IAAI,KAAS,EAAK,EAAK,IAI1CT,EAAMK,MAAM/E,KAAMgF,GAInBvC,EAAIzC,KAAM0E,QAMX,IAAM,IAAItJ,EAAI,EAAGA,EAAIP,EAAKiI,SAASoB,UAAW9I,IAAO,CAEpD,MAAMqJ,EAAK5J,EAAKoG,MAAO7F,GAAIqJ,GAE3B,QAAYxF,IAAPwF,EAAmB,SAExB,MAAMC,EAAQ,CACbC,OAAQvJ,EACRwJ,SAAUH,EAAGG,SACbC,UAAWJ,EAAGI,UACdC,SAAUL,EAAGK,SACbC,MAAO,IAGR,IAAM,IAAI7B,EAAI,EAAGC,EAAKsB,EAAGM,MAAMxL,OAAQ2J,EAAIC,EAAID,IAAO,CAErD,MAAM8B,EAAO,GAIb,GAHAA,EAAK1E,MAAQmE,EAAGM,MAAO7B,GAAI5C,MAC3B0E,EAAKC,SAAU,EAEwB,IAAlCR,EAAGM,MAAO7B,GAAIkC,gBAAwB,CAK1C,MAAMC,EAAcZ,EAAGM,MAAO7B,GAAIoC,qBAC5BC,EAAcd,EAAGM,MAAO7B,GAAIsC,qBAK5BC,GAASF,EAAa,GACtBG,GAASH,EAAa,GAC5BA,EAAa,IAAQF,EAAa,GAClCE,EAAa,IAAQF,EAAa,GAClCA,EAAa,GAAMI,EACnBJ,EAAa,GAAMK,EAEnBV,EAAKK,aAAc,IAAI,MAAUhE,UAAWgE,GAC5CL,EAAKO,aAAc,IAAI,MAAUlE,UAAWkE,GAI7Cb,EAAMK,MAAM/E,KAAMgF,GAInBvC,EAAIzC,KAAM0E,GAIVzD,EAAO7F,GAAIqJ,GAAKC,EAQlB,GAA8B,QAAzB7J,EAAKiI,SAASyB,OAAmB,CAGrC,MAAMoB,EAAgB,GAEtB,IAAM,IAAIvK,EAAI,EAAGA,EAAIP,EAAKiI,SAASoB,UAAW9I,IAAO,CAEpD,MAAM+I,EAAWtJ,EAAKoG,MAAO7F,GACvBwK,EAAQzB,EAASyB,MAEvB,QAAe3G,IAAV2G,EAAsB,SAE3B,MAAMlB,EAAQ,CACbpE,MAAOlF,EACPiJ,YAAauB,EAAMvB,YACnBwB,MAAOD,EAAMC,MACbC,QAASF,EAAME,QACfC,eAAgBH,EAAMG,eACtBC,eAAgBJ,EAAMI,eACtB5B,oBAAqBD,EAASC,qBAG/BuB,EAAevK,GAAM,CAAEuG,OAAQ,KAAMsE,SAAU,GAAIvB,MAAOA,EAAOwB,SAAS,GAI3E,MAAMC,EAAY,CAAExE,OAAQ,KAAMsE,SAAU,GAAIvB,MAAO,KAAMwB,SAAS,GAItE,IAAM,MAAMpC,KAAa6B,EAAgB,CAExC,MAAMS,EAAaT,EAAe7B,GAC5BuC,EAAmBV,EAAeS,EAAW/B,cAAiB8B,EAEpEC,EAAWzE,OAAS0E,EACpBA,EAAiBJ,SAASjG,KAAMoG,IAQjC,SAASE,EAAUC,GAEbA,EAAM7B,QAEVhC,EAAO1C,KAAMuG,EAAM7B,OAInBzD,EAAOsF,EAAM7B,MAAMpE,OAAQsF,MAAQW,EAAM7B,OAI1C6B,EAAML,SAAU,EAEhB,IAAM,IAAI9K,EAAI,EAAG2E,EAAKwG,EAAMN,SAAS1M,OAAQ6B,EAAI2E,EAAI3E,IAAO,CAE3D,MAAMoL,EAAQD,EAAMN,SAAU7K,GAGvBoL,EAAMN,SAAUI,EAAUE,IAMnCF,CAAUH,GAMX,SAASM,EAAkBC,EAAWC,EAAOd,GAE5C,IAAM,IAAIzK,EAAI,EAAGA,EAAIuL,EAAMC,aAAcxL,IAAO,CAE/C,MAAMyL,EAAUF,EAAMG,SAAU1L,GAEhC,IAAIkF,EAIHA,EAF6B,QAAzBzF,EAAKiI,SAASyB,OAEV1J,EAAKkM,OAAQ,GAAID,SAAUD,EAAQvG,OAAQA,MAI3CuG,EAAQvG,MAIjBoG,EAAUM,MAAe,EAAR1G,EAAY,IAAOuG,EAAQzF,SAAU,GAAMyE,EAC5Da,EAAUM,MAAe,EAAR1G,EAAY,IAAOuG,EAAQzF,SAAU,GAAMyE,EAC5Da,EAAUM,MAAe,EAAR1G,EAAY,IAAOuG,EAAQzF,SAAU,GAAMyE,GAM9D,IAAM,IAAIzK,EAAI,EAAGA,EAAIP,EAAKiI,SAASmE,WAAY7L,IAAO,CAErD,MAAMuL,EAAQ9L,EAAKkM,OAAQ3L,GACrB8L,EAAS,CAAE3P,KAAMoP,EAAMpP,MAEvBmP,EAAY,IAAI,IAAoD,EAA5B7L,EAAKiI,SAASC,YAAiB,GAC7E2D,EAAUnP,KAAOoP,EAAMpP,KAEvB,IAAM,IAAI2L,EAAI,EAAGA,EAAgC,EAA5BrI,EAAKiI,SAASC,YAAiBG,IAEnDwD,EAAUM,MAAO9D,GAAMlB,EAAWkB,GAInC,GAA8B,QAAzBrI,EAAKiI,SAASyB,OAEP,IAANnJ,GAEJqL,EAAkBC,EAAWC,EAAO,QAMrC,GAAoB,IAAfA,EAAM5C,KAEV,IAAM,IAAIb,EAAI,EAAGA,EAAIyD,EAAMC,aAAc1D,IAAO,CAE/C,MAAMiE,EAAStM,EAAKkM,OAAQJ,EAAMG,SAAU5D,GAAI5C,OAC1CuF,EAAQc,EAAMG,SAAU5D,GAAI2C,MAEb,IAAhBsB,EAAOpD,MAEX0C,EAAkBC,EAAWS,EAAQtB,QAUb,IAAfc,EAAM5C,KAEjB0C,EAAkBC,EAAWC,EAAO,GAEV,IAAfA,EAAM5C,MAIS,IAAf4C,EAAM5C,MAIS,IAAf4C,EAAM5C,MAIS,IAAf4C,EAAM5C,MAIS,IAAf4C,EAAM5C,MAIS,IAAf4C,EAAM5C,MAIN4C,EAAM5C,KAQnBxB,EAAavC,KAAMkH,GACnB1E,EAAexC,KAAM0G,GAMtB,IAAM,IAAItL,EAAI,EAAGA,EAAIP,EAAKiI,SAASa,eAAgBvI,IAAO,CAEzD,MAAMgM,EAAYvM,EAAK8H,YAAavH,GAC9B8L,EAAS,GAEf,IAAM,MAAMG,KAAOD,EAElBF,EAAQG,GAAQD,EAAWC,GAS5B,GAA8B,QAAzBxM,EAAKiI,SAASyB,SAEU,IAAvB2C,EAAOpD,UAAoB,CAE/B,MAAM3C,EAAOtG,EAAKoG,MAAOiG,EAAOpD,WAChCoD,EAAO9F,SAAU,IAAOD,EAAKC,SAAU,GACvC8F,EAAO9F,SAAU,IAAOD,EAAKC,SAAU,GACvC8F,EAAO9F,SAAU,IAAOD,EAAKC,SAAU,GAMzCuB,EAAY3C,KAAMkH,GAMnB,IAAM,IAAI9L,EAAI,EAAGA,EAAIP,EAAKiI,SAASwE,gBAAiBlM,IAAO,CAE1D,MAAMmM,EAAa1M,EAAK+H,YAAaxH,GAC/B8L,EAAS,GAEf,IAAM,MAAMG,KAAOE,EAElBL,EAAQG,GAAQE,EAAYF,GAI7B,MAAMG,EAAQ7E,EAAauE,EAAOO,iBAC5BC,EAAQ/E,EAAauE,EAAOS,iBAGd,IAAfH,EAAMzD,MAA6B,IAAf2D,EAAM3D,OAEH,IAAtByD,EAAM1D,YAA2C,IAAtB4D,EAAM5D,WAChCjJ,EAAKoG,MAAOyG,EAAM5D,WAAYO,cAAgBmD,EAAM1D,YAEzD4D,EAAM3D,KAAO,GAMfnB,EAAY5C,KAAMkH,GAMnB,MAAMrG,EAAW,IAAI,IAErBA,EAAS+G,aAAc,WAAY,IAAI,IAAwB5F,EAAW,IAC1EnB,EAAS+G,aAAc,SAAU,IAAI,IAAwB1F,EAAS,IACtErB,EAAS+G,aAAc,KAAM,IAAI,IAAwB3F,EAAK,IAC9DpB,EAAS+G,aAAc,YAAa,IAAI,KAAuBvF,EAAa,IAC5ExB,EAAS+G,aAAc,aAAc,IAAI,IAAwBtF,EAAa,IAC9EzB,EAASgH,SAAU1F,GAEnB,IAAM,IAAI/G,EAAI,EAAG2E,EAAKqC,EAAO7I,OAAQ6B,EAAI2E,EAAI3E,IAE5CyF,EAASiH,SAAU1F,EAAQhH,GAAI3B,OAAQ2I,EAAQhH,GAAID,MAAOC,GAqB3D,OAjBAyF,EAASI,MAAQA,EAEjBJ,EAAS0B,aAAeA,EACxB1B,EAASkH,gBAAgB3G,SAAWoB,EACpC3B,EAASmH,sBAAuB,EAEhCnH,EAASoH,SAASC,IAAM,CACvBjH,MAAOA,EACPwB,IAAKA,EACLC,OAAQA,EACRC,YAAaA,EACbC,YAAaA,EACb2B,OAAQ1J,EAAKiI,SAASyB,QAGvB1D,EAASsH,wBAEFtH,GAWT,MAAM,EAEL,YAAatI,GAEZwE,KAAKxE,QAAUA,EAEfwE,KAAKqL,cAAgB,IAAI,KAAerL,KAAKxE,SAC7CwE,KAAKsL,UAAY,KAEjBtL,KAAKY,YAAc,YACnBZ,KAAKa,kBAAeqB,EAQrB,eAAgBtB,GAGf,OADAZ,KAAKY,YAAcA,EACZZ,KAQR,gBAAiBa,GAGhB,OADAb,KAAKa,aAAeA,EACbb,KAWR,MAAOlC,EAAMgG,GAEZ,MAAM6C,EAAY,GAEZ4E,EAAW,GAEjBvL,KAAKqL,cAAc1K,eAAgBX,KAAKY,aAIxC,IAAM,IAAIvC,EAAI,EAAGA,EAAIP,EAAKiI,SAASW,cAAerI,IAAO,CAExD,MAAM0F,EAAWjG,EAAK6I,UAAWtI,GAE3B8L,EAAS,CAAEe,SAAU,IA8C3B,QA5CuBhJ,IAAlB6B,EAASvJ,OAAqB2P,EAAO3P,KAAOuJ,EAASvJ,MAa1D2P,EAAOjL,OAAQ,IAAI,KAAQoF,UAAWP,EAASyH,SAC/CrB,EAAOsB,QAAU1H,EAASyH,QAAS,GACnCrB,EAAOuB,UAAW,IAAI,KAAQpH,UAAWP,EAAS4H,SAClDxB,EAAOyB,YAAiC,IAAnBzB,EAAOsB,QAI5BtB,EAAO0B,SAAW/H,EAASI,MAAM1H,OAAS,EAC1C2N,EAAO3E,aAAe1B,EAAS0B,aAAahJ,OAAS,EACrD2N,EAAO2B,KAAM,EAIb3B,EAAO4B,SAAW,IAClB5B,EAAO6B,SAAW,KAClB7B,EAAO8B,SAAW,IAClB9B,EAAO+B,cAAgB,KACvB/B,EAAOgC,cAAgB,IAIO,QAAzBrO,EAAKiI,SAASyB,QAAgD,IAAV,EAAhBzD,EAASqI,MAEjDjC,EAAOkC,KAAO,IAIdlC,EAAOkC,KAA0B,IAAnBlC,EAAOsB,QAAkB,IAAY,IAItB,QAAzB3N,EAAKiI,SAASyB,OAAmB,CAIrC,GAAKzD,EAASuI,SAAW,CAExB,MACMC,EADWxI,EAASuI,SACCE,MAAO,KAOlC,GAFArC,EAAOsC,IAAMzM,KAAK0M,aAAcH,EAAW,GAAKhB,GAE3CgB,EAAU/P,OAAS,EAAI,CAE3B,MAAMmQ,EAAYJ,EAAW,GAAI9I,OAAS,GAAIvC,cAE9CiJ,EAAOyC,OAAS5M,KAAK0M,aACpBH,EAAW,GACXhB,GAGDpB,EAAO0C,QAAwB,SAAdF,EACd,IACA,KAQL,MAAMG,GAA0C,IAAzB/I,EAASgJ,UAC7B,aACAjP,EAAKkP,aAAcjJ,EAASgJ,WAAYT,SAE3CnC,EAAO8C,YAAcjN,KAAK0M,aACzBI,EACAvB,EACA,CACC2B,eAAe,EACfC,qBAAsBnN,KAAKoN,sBAAuBN,KAMpD3C,EAAOe,SAASmC,kBAAoB,CACnCC,UAAiC,IAAtBvJ,EAASwJ,SAAiB,KAAQ,EAC7CrO,MAAO,CAAE,EAAG,EAAG,GACfsO,MAAO,EACPC,QAA+B,IAAtB1J,EAASwJ,cAGb,CA2BN,IAAIT,EAAcY,GAvBe,IAA5B3J,EAAS4J,eAEbxD,EAAOsC,IAAMzM,KAAK0M,aAAc5O,EAAKyN,SAAUxH,EAAS4J,cAAgBpC,KAMrC,IAA/BxH,EAAS6J,iBAAkD,IAArB7J,EAAS8J,SAAqC,GAApB9J,EAAS8J,UAE7E1D,EAAOyC,OAAS5M,KAAK0M,aACpB5O,EAAKyN,SAAUxH,EAAS6J,iBACxBrC,GAGDpB,EAAO0C,QAA+B,IAArB9I,EAAS8J,QACvB,IACA,MAQ0B,IAAzB9J,EAASgJ,WAA2C,IAAtBhJ,EAAS+J,UAE3ChB,EAAe,QAAW,KAAQ/I,EAASgJ,UAAY,IAAMtJ,OAAS,GAAM,OAC5EiK,GAAgB,IAIhBZ,EAAehP,EAAKyN,SAAUxH,EAASgJ,WACvCW,GAAgB,GAIjBvD,EAAO8C,YAAcjN,KAAK0M,aACzBI,EACAvB,EACA,CACC2B,eAAe,EACfC,qBAAsBO,IAKxBvD,EAAOe,SAASmC,kBAAoB,CACnCC,UAAWvJ,EAASgK,SAAW,IAC/B7O,MAAO6E,EAASiK,UAAUvK,MAAO,EAAG,GACpC+J,MAAOzJ,EAASiK,UAAW,GAC3BP,QAAsC,IAAX,GAAhB1J,EAASqI,OAAuBrI,EAASgK,SAAW,QAK7C7L,IAAfiI,EAAOsC,MAEJtC,EAAOyB,aAEb5L,KAAKiO,wBAAyB9D,EAAOsC,IAAK3I,EAAUzF,GAIrD8L,EAAOuB,SAASwC,eAAgB,KAIjCvH,EAAU1D,KAAM,IAAI,IAAkBkH,IAIvC,GAA8B,QAAzBrM,EAAKiI,SAASyB,OAAmB,CAIrC,SAAS2G,EAAiBpE,EAAUpD,GAEnC,IAAM,IAAItI,EAAI,EAAG2E,EAAK+G,EAASvN,OAAQ6B,EAAI2E,EAAI3E,IAAO,CAErD,MAAMyL,EAAUC,EAAU1L,GAE1B,IAAyB,IAApByL,EAAQvG,MAAgB,SAE7B,MAAMQ,EAAW4C,EAAWmD,EAAQvG,OAE/BQ,EAAS0H,UAAY3B,EAAQ0B,QAAS,KAE1CzH,EAAS6H,aAAc,IAQ1B,IAAM,IAAIvN,EAAI,EAAG2E,EAAKlF,EAAKkM,OAAOxN,OAAQ6B,EAAI2E,EAAI3E,IAAO,CAExD,MAAMuL,EAAQ9L,EAAKkM,OAAQ3L,GACrB0L,EAAWH,EAAMG,SAEvB,GAAoB,IAAfH,EAAM5C,KAEV,IAAM,IAAIb,EAAI,EAAGC,EAAK2D,EAASvN,OAAQ2J,EAAIC,EAAID,IAAO,CAErD,MAAMiE,EAAStM,EAAKkM,OAAQD,EAAU5D,GAAI5C,OAErB,IAAhB6G,EAAOpD,MAEZmH,EAAiB/D,EAAOL,SAAUpD,QAIT,IAAfiD,EAAM5C,MAEjBmH,EAAiBpE,EAAUpD,IAQ9B,OAAOA,EAMR,gBAEC,GAAwB,OAAnB3G,KAAKsL,UAAqB,CAE9B,QAAmBpJ,IAAd,EAEJ,MAAM,IAAId,MAAO,qCAIlBpB,KAAKsL,UAAY,IAAI,EAAWtL,KAAKxE,SAItC,OAAOwE,KAAKsL,UAIb,sBAAuB9Q,GAEtB,OAAqB,KAAhBA,EAAKgC,QAEH,uBAAuB4R,KAAM5T,GAIrC,aAAc6T,EAAU9C,EAAUpB,EAAQ3J,EAAYC,GAIrD,MAAMkB,EAAQ3B,KAEd,IAAIsO,EAEJ,IAAqC,KANrCnE,EAASA,GAAU,IAMPgD,qBAAgC,CAE3C,IAAI5J,EAEJ,IAECA,EAAQgL,SAAUF,EAASG,MAAO,wBAA0B,IAE3D,MAAQC,GAETtU,QAAQuU,KAAM,oBAAsBL,EAAtB,2EAGd9K,EAAQ,EAIT+K,EAAW3K,EAAuBJ,QAIlC+K,EAAWtO,KAAKa,aAAewN,EAIhC,QAA8BnM,IAAzBqJ,EAAU+C,GAA2B,OAAO/C,EAAU+C,GAE3D,IAAIrO,EAASD,KAAKxE,QAAQmT,WAAYL,GAEtB,OAAXrO,IAEJA,EAAmD,SAAxCoO,EAAS5K,OAAS,GAAIvC,cAC9BlB,KAAK4O,gBACL5O,KAAKqL,eAIT,MAAMwD,EAAU5O,EAAO2B,KAAM0M,GAAU,SAAWQ,IAKnB,IAAzB3E,EAAO+C,gBAEX4B,EAAEpQ,MAAQiD,EAAMoN,iBAAkBD,EAAEpQ,OAEpCoQ,EAAEE,UAAY,IACdF,EAAE/O,UAAY,KAIf+O,EAAEjP,OAAQ,EACViP,EAAEG,MAAQ,IACVH,EAAEI,MAAQ,IAEV,IAAM,IAAI7Q,EAAI,EAAGA,EAAIwQ,EAAQM,eAAe3S,OAAQ6B,IAEnDwQ,EAAQM,eAAgB9Q,GAAKwQ,UAIvBA,EAAQM,iBAEb3O,EAAYC,GAMf,OAJAoO,EAAQM,eAAiB,GAEzB5D,EAAU+C,GAAaO,EAEhBA,EAIR,iBAAkBnQ,GAEjB,MAAM0Q,EAASC,SAASC,cAAe,UACjCC,EAAUH,EAAOI,WAAY,MAE7BpS,EAAQsB,EAAMtB,MACdC,EAASqB,EAAMrB,OAWrB,OATA+R,EAAOhS,MAAQA,EACfgS,EAAO/R,OAASA,EAEhBkS,EAAQE,UAAW,EAAG,EAAGrS,EAAOC,GAChCkS,EAAQG,UAAWtS,EAAQ,EAAKC,EAAS,GACzCkS,EAAQI,OAAQ,GAAM1I,KAAK2I,IAC3BL,EAAQG,WAAatS,EAAQ,GAAOC,EAAS,GAC7CkS,EAAQM,UAAWnR,EAAO,EAAG,GAEtB6Q,EAAQO,aAAc,EAAG,EAAG1S,EAAOC,GAK3C,wBAAyBoP,EAAK3I,EAAUiM,GAEvCtD,EAAI0C,eAAelM,MAAM,SAAW4L,GA2DnC,SAASmB,EAActR,EAAO4H,GAE7B,MAAMlJ,EAAQsB,EAAMtB,MACdC,EAASqB,EAAMrB,OAErB,IAAI8B,EAAI8H,KAAKgJ,MAAO3J,EAAGnH,EAAI/B,GAAUA,EACjCgC,EAAI6H,KAAKgJ,MAAO3J,EAAGlH,EAAI/B,GAAWA,EAEjC8B,EAAI,IAAIA,GAAK/B,GACbgC,EAAI,IAAIA,GAAK/B,GAElB,MAAMkG,EAAQnE,EAAIhC,EAAQ+B,EAE1B,OAAOT,EAAMZ,KAAc,EAARyF,EAAY,GAIhC,MAAM3F,OAAmCsE,IAAvB2M,EAAQnQ,MAAMZ,KAC7B+Q,EAAQnQ,MA1EX,SAA0BA,GAEzB,MAAM0Q,EAASC,SAASC,cAAe,UACvCF,EAAOhS,MAAQsB,EAAMtB,MACrBgS,EAAO/R,OAASqB,EAAMrB,OAEtB,MAAMkS,EAAUH,EAAOI,WAAY,MAGnC,OAFAD,EAAQM,UAAWnR,EAAO,EAAG,GAEtB6Q,EAAQO,aAAc,EAAG,EAAGV,EAAOhS,MAAOgS,EAAO/R,QAkEtD6S,CAAiBrB,EAAQnQ,OAEtByR,EAAQrM,EAASuB,OAAQ0K,IAhE/B,SAAkCrR,EAAOwG,EAAKE,GAE7C,MAAMhI,EAAQsB,EAAMtB,MACdC,EAASqB,EAAMrB,OAIrB,GAHaqB,EAAMZ,KAGTtB,QAAWY,EAAQC,IAAa,EAAI,OAAO,EAErD,IAAM,IAAIgB,EAAI,EAAGA,EAAI+G,EAAQ5I,OAAQ6B,GAAK,EAAI,CAE7C,MAAM+R,EAAW,CAAEjR,EAAG,EAAKC,EAAG,GAE9B,IAAM,IAAI+G,EAAI,EAAGA,EAAI,EAAGA,IAAO,CAE9B,MAAM5C,EAAQ6B,EAAa,EAAJ/G,EAAQ8H,GACzBG,EAAK,CAAEnH,EAAG+F,EAAa,EAAR3B,EAAY,GAAKnE,EAAG8F,EAAa,EAAR3B,EAAY,IAE1D,GAAKyM,EAActR,EAAO4H,GAbV,IAa6B,OAAO,EAEpD8J,EAASjR,GAAKmH,EAAGnH,EACjBiR,EAAShR,GAAKkH,EAAGlH,EAOlB,GAHAgR,EAASjR,GAAK,EACdiR,EAAShR,GAAK,EAET4Q,EAActR,EAAO0R,GAvBT,IAuBkC,OAAO,EAI3D,OAAO,GAkCHC,CACJzS,EACAkG,EAASwM,WAAWhK,GAAG2D,MACvBnG,EAASP,MAAM0G,MAAMxG,MAAO0M,EAAMI,MAAOJ,EAAMI,MAAQJ,EAAM/R,UAE7DqO,EAAIb,aAAc,OAYtB,MAAM,EAOL,MAAOtK,EAAKO,GAIX,MAAM2O,EAASxQ,KAAKyQ,uBAAwBnP,EAAKO,GAAO2O,OAClDE,EAAU1Q,KAAK2Q,oBAAqBrP,EAAKO,GAAO2O,OAEtD,IAAM,IAAInS,EAAI,EAAG2E,EAAK0N,EAAQlU,OAAQ6B,EAAI2E,EAAI3E,IAE7CmS,EAAOvN,KAAMyN,EAASrS,IAIvB,OAAO,IAAI,IAAe,IAAM,EAAGmS,GASpC,uBAAwBlP,EAAKO,GAE5B,SAAS+O,EAAmB3G,EAAO4G,EAAetN,GAEjD0G,EAAMhH,KAAM4N,EAAetN,EAAQ,GAAM,KACzC0G,EAAMhH,KAAM4N,EAAetN,EAAQ,GAAM,KACzC0G,EAAMhH,KAAM4N,EAAetN,EAAQ,GAAM,KACzC0G,EAAMhH,KAAM4N,EAAetN,EAAQ,IAAO,KAI3C,MAAMiN,EAAS,GAETM,EAAU,GACV5M,EAAQrC,EAAKoC,SAASC,MACtB6M,EAAqB,GAE3B,IAAM,IAAI1S,EAAI,EAAG2E,EAAKkB,EAAM1H,OAAQ6B,EAAI2E,EAAI3E,IAE3C0S,EAAoB7M,EAAO7F,GAAI7D,OAAS,EAIzC,IAAM,IAAI6D,EAAI,EAAGA,EAAIiD,EAAIyE,SAASiL,YAAa3S,IAAO,CAErD,MAAM4S,EAAS3P,EAAIwP,QAASzS,GACtB6S,EAAWD,EAAOC,cAEgBhP,IAAnC6O,EAAoBG,KAEzBJ,EAASI,GAAaJ,EAASI,IAAc,GAC7CJ,EAASI,GAAWjO,KAAMgO,IAI3B,IAAM,MAAM3G,KAAOwG,EAAU,CAE5B,MAAM7G,EAAQ6G,EAASxG,GAEvBL,EAAMkH,MAAM,SAAWC,EAAGC,GAEzB,OAAOD,EAAEE,SAAWD,EAAEC,YAIvB,MAAMC,EAAQ,GACRtM,EAAY,GACZuM,EAAY,GACZC,EAAkB,GAClBC,EAAkB,GAElBC,EAAe9P,EAAKoC,SAAS2N,cAAetH,GAAMjG,SAASwN,UAEjE,IAAM,IAAIxT,EAAI,EAAG2E,EAAKiH,EAAMzN,OAAQ6B,EAAI2E,EAAI3E,IAAO,CAElD,MAAMyT,EAAO7H,EAAO5L,GAAIiT,SAAW,GAC7BjN,EAAW4F,EAAO5L,GAAIgG,SACtB0N,EAAW9H,EAAO5L,GAAI0T,SACtBlB,EAAgB5G,EAAO5L,GAAIwS,cAEjCU,EAAMtO,KAAM6O,GAEZ,IAAM,IAAI3L,EAAI,EAAGA,EAAI,EAAGA,IAAOlB,EAAUhC,KAAM0O,EAAcxL,GAAM9B,EAAU8B,IAC7E,IAAM,IAAIA,EAAI,EAAGA,EAAI,EAAGA,IAAOqL,EAAUvO,KAAM8O,EAAU5L,IACzD,IAAM,IAAIA,EAAI,EAAGA,EAAI,EAAGA,IAAOyK,EAAmBa,EAAiBZ,EAAe1K,GAElFyK,EAAmBc,EAAiBb,EAAe,GAIpD,MAAMmB,EAAa,UAAY1H,EAAM,IAErCkG,EAAOvN,KAAMjD,KAAKiS,aAAcD,EAAa,YAAa,KAAqBT,EAAOtM,EAAWwM,IACjGjB,EAAOvN,KAAMjD,KAAKiS,aAAcD,EAAa,cAAe,IAAyBT,EAAOC,EAAWE,IAIxG,OAAO,IAAI,IAAe,IAAM,EAAGlB,GASpC,oBAAqBlP,EAAKO,GAEzB,MAAM2O,EAAS,GAETxG,EAAS,GACTkI,EAAwBrQ,EAAKqQ,sBAEnC,IAAM,IAAI7T,EAAI,EAAGA,EAAIiD,EAAIyE,SAASmE,WAAY7L,IAAO,CAEpD,MAAMuL,EAAQtI,EAAI0I,OAAQ3L,GACpB8T,EAAYvI,EAAMuI,eAEoBjQ,IAAvCgQ,EAAuBC,KAE5BnI,EAAQmI,GAAcnI,EAAQmI,IAAe,GAC7CnI,EAAQmI,GAAYlP,KAAM2G,IAI3B,IAAM,MAAMU,KAAON,EAAS,CAE3B,MAAMC,EAAQD,EAAQM,GAEtBL,EAAMkH,MAAM,SAAWC,EAAGC,GAEzB,OAAOD,EAAEE,SAAWD,EAAEC,YAIvB,MAAMC,EAAQ,GACRa,EAAS,GAEf,IAAM,IAAI/T,EAAI,EAAG2E,EAAKiH,EAAMzN,OAAQ6B,EAAI2E,EAAI3E,IAE3CkT,EAAMtO,KAAMgH,EAAO5L,GAAIiT,SAAW,IAClCc,EAAOnP,KAAMgH,EAAO5L,GAAIgU,QAIzB7B,EAAOvN,KAAM,IAAI,IAAqB,0BAA4BiP,EAAuB5H,GAAQ,IAAKiH,EAAOa,IAI9G,OAAO,IAAI,IAAe,IAAM,EAAG5B,GAQpC,qBAAsBlP,GAErB,SAASgR,EAAarI,EAAOsI,GAE5BtI,EAAMhH,KAAMsP,EAAIpT,GAChB8K,EAAMhH,KAAMsP,EAAInT,GAChB6K,EAAMhH,KAAMsP,EAAIC,GAajB,SAAS5B,EAAmB3G,EAAO4G,EAAetN,GAEjD0G,EAAMhH,KAAM4N,EAAuB,EAARtN,EAAY,GAAM,KAC7C0G,EAAMhH,KAAM4N,EAAuB,EAARtN,EAAY,GAAM,KAC7C0G,EAAMhH,KAAM4N,EAAuB,EAARtN,EAAY,GAAM,KAC7C0G,EAAMhH,KAAM4N,EAAuB,EAARtN,EAAY,GAAM,KAI9C,MAAMkP,OAA0BvQ,IAAhBZ,EAAImR,QAAwB,GAAKnR,EAAImR,QAAQhP,QAE7DgP,EAAQtB,MAAM,SAAWC,EAAGC,GAE3B,OAAOD,EAAEE,SAAWD,EAAEC,YAIvB,MAAMC,EAAQ,GACRmB,EAAU,GACVC,EAAc,GACd1N,EAAY,GACZ2N,EAAO,GAEPC,EAAkB,GAClBC,EAAkB,GAClBrB,EAAkB,GAClBsB,EAAkB,GAElBvO,EAAa,IAAI,IACjBwO,EAAQ,IAAI,IACZ3O,EAAW,IAAI,KACf4O,EAAS,IAAI,KAEnB,IAAM,IAAI5U,EAAI,EAAG2E,EAAKyP,EAAQjW,OAAQ6B,EAAI2E,EAAI3E,IAAO,CAEpD,MAAM4S,EAASwB,EAASpU,GAElByT,EAAOb,EAAOK,SAAW,GACzB/M,EAAM0M,EAAO5M,SACb6O,EAAMjC,EAAOc,SACboB,EAAWlC,EAAOkC,SAClBC,EAAMnC,EAAOmC,IACbvC,EAAgBI,EAAOJ,cAE7BU,EAAMtO,KAAM6O,GAEZzN,EAAS7F,IAAK,EAAG,GAAK2U,GACtBF,EAAOzU,IAAK+F,EAAK,GAAKA,EAAK,GAAKA,EAAK,IAErCyO,EAAMxU,KAAO0U,EAAK,IAAOA,EAAK,IAAOA,EAAK,IAC1C1O,EAAW6O,aAAcL,GAEzB3O,EAASQ,IAAKoO,GACd5O,EAASiP,gBAAiB9O,GAE1B8N,EAAaI,EAASO,IAhEEhJ,EAiER0I,GA/DV1P,MAFyBsQ,EAiEF/O,GA/DfrF,GACd8K,EAAMhH,KAAMsQ,EAAEnU,GACd6K,EAAMhH,KAAMsQ,EAAEf,GACdvI,EAAMhH,KAAMsQ,EAAEC,GA6DdlB,EAAarN,EAAWZ,GAExBuO,EAAK3P,KAAMmQ,GAEX,IAAM,IAAIjN,EAAI,EAAGA,EAAI,EAAGA,IAEvByK,EAAmBiC,EAAiBhC,EAAe1K,GAIpDyK,EAAmBkC,EAAiBjC,EAAe,GAGnD,IAAM,IAAI1K,EAAI,EAAGA,EAAI,EAAGA,IAEvByK,EAAmBa,EAAiBZ,EAAe,GAIpDD,EAAmBmC,EAAiBlC,EAAe,GArFpD,IAAyB5G,EAAOsJ,EAyFhC,MAAM/C,EAAS,GASf,OANAA,EAAOvN,KAAMjD,KAAKiS,aAAc,kBAAmB,KAAqBV,EAAOmB,EAASG,IAExFrC,EAAOvN,KAAMjD,KAAKiS,aAAc,cAAe,IAAyBV,EAAOoB,EAAaG,IAC5FtC,EAAOvN,KAAMjD,KAAKiS,aAAc,YAAa,KAAqBV,EAAOtM,EAAWwM,IACpFjB,EAAOvN,KAAMjD,KAAKiS,aAAc,OAAQ,IAAqBV,EAAOqB,EAAMG,IAEnE,IAAI,IAAe,IAAM,EAAGvC,GAMpC,aAAciD,EAAMC,EAAoBnC,EAAOa,EAAQuB,GAOtD,GAAKpC,EAAM/U,OAAS,EAAI,CAEvB+U,EAAQA,EAAM9N,QACd2O,EAASA,EAAO3O,QAChBkQ,EAAiBA,EAAelQ,QAEhC,MAAMmQ,EAASxB,EAAO5V,OAAS+U,EAAM/U,OAC/BqX,EAAoBF,EAAenX,OAAS+U,EAAM/U,OAExD,IAAI+G,EAAQ,EAEZ,IAAM,IAAIuQ,EAAa,EAAGC,EAAWxC,EAAM/U,OAAQsX,EAAaC,EAAUD,IAAgB,CAEzF,IAAM,IAAIzV,EAAI,EAAGA,EAAIuV,EAAQvV,IAE5B,GAAK+T,EAAQ7O,EAAQqQ,EAASvV,KAAQ+T,GAAU7O,EAAQ,GAAMqQ,EAASvV,IACrE+T,EAAQ7O,EAAQqQ,EAASvV,KAAQ+T,EAAQ0B,EAAaF,EAASvV,GAAM,CAEtEkF,IACA,MAMF,GAAKuQ,EAAavQ,EAAQ,CAEzBgO,EAAOhO,GAAUgO,EAAOuC,GAExB,IAAM,IAAIzV,EAAI,EAAGA,EAAIuV,EAAQvV,IAE5B+T,EAAQ7O,EAAQqQ,EAASvV,GAAM+T,EAAQ0B,EAAaF,EAASvV,GAI9D,IAAM,IAAIA,EAAI,EAAGA,EAAIwV,EAAmBxV,IAEvCsV,EAAgBpQ,EAAQsQ,EAAoBxV,GAAMsV,EAAgBG,EAAaD,EAAoBxV,IAQtGkT,EAAM/U,OAAS+G,EAAQ,EACvB6O,EAAO5V,QAAW+G,EAAQ,GAAMqQ,EAChCD,EAAenX,QAAW+G,EAAQ,GAAMsQ,EAIzC,MAAMG,EAAQ,IAAIN,EAAoBD,EAAMlC,EAAOa,GAQnD,OANA4B,EAAMC,kBAAoB,SAA8CpW,GAEvE,OAAO,IAAI,EAA0BmC,KAAKuR,MAAOvR,KAAKoS,OAAQpS,KAAKkU,eAAgBrW,EAAQ,IAAIsW,aAAcR,KAIvGK,GAQT,MAAM,UAAiC,IAEtC,YAAaI,EAAoBC,EAAcC,EAAYC,EAAcpK,GAExE1O,MAAO2Y,EAAoBC,EAAcC,EAAYC,GAErDvU,KAAKwU,oBAAsBrK,EAI5B,aAAcsK,EAAIC,EAAI5F,EAAG6F,GAExB,MAAM9W,EAASmC,KAAKuU,aACdnC,EAASpS,KAAKqU,aACdT,EAAS5T,KAAK4U,UACdzK,EAASnK,KAAKwU,oBAEdK,EAAUJ,EAAKb,EACfkB,EAAUD,EAAUjB,EAKpBmB,EAAcJ,EAAKD,EAAO,IAAiB,GAAQ5F,EAAI4F,IAASC,EAAKD,GAE3E,GAAgB,IAAXd,EAAe,CAEnB,MAAMoB,EAAK7K,EAAa,EAALsK,EAAS,GACtBQ,EAAK9K,EAAa,EAALsK,EAAS,GACtBS,EAAK/K,EAAa,EAALsK,EAAS,GACtBU,EAAKhL,EAAa,EAALsK,EAAS,GAEtB3L,EAAQ9I,KAAKoV,WAAYJ,EAAIC,EAAIC,EAAIC,EAAIJ,GAE/C,IAAWM,UAAWxX,EAAQ,EAAGuU,EAAQ0C,EAAS1C,EAAQyC,EAAS/L,QAE7D,GAAgB,IAAX8K,EAEX,IAAM,IAAIvV,EAAI,EAAGA,IAAMuV,IAAWvV,EAAI,CAErC,MAAM2W,EAAK7K,EAAa,GAALsK,EAAc,EAAJpW,EAAQ,GAC/B4W,EAAK9K,EAAa,GAALsK,EAAc,EAAJpW,EAAQ,GAC/B6W,EAAK/K,EAAa,GAALsK,EAAc,EAAJpW,EAAQ,GAC/B8W,EAAKhL,EAAa,GAALsK,EAAc,EAAJpW,EAAQ,GAE/ByK,EAAQ9I,KAAKoV,WAAYJ,EAAIC,EAAIC,EAAIC,EAAIJ,GAE/ClX,EAAQQ,GAAM+T,EAAQ0C,EAAUzW,IAAQ,EAAIyK,GAAUsJ,EAAQyC,EAAUxW,GAAMyK,MAIzE,CAEN,MAAMkM,EAAK7K,EAAa,EAALsK,EAAS,GACtBQ,EAAK9K,EAAa,EAALsK,EAAS,GACtBS,EAAK/K,EAAa,EAALsK,EAAS,GACtBU,EAAKhL,EAAa,EAALsK,EAAS,GAEtB3L,EAAQ9I,KAAKoV,WAAYJ,EAAIC,EAAIC,EAAIC,EAAIJ,GAE/ClX,EAAQ,GAAMuU,EAAQ0C,IAAc,EAAIhM,GAAUsJ,EAAQyC,GAAY/L,EAIvE,OAAOjL,EAIR,WAAYmX,EAAIC,EAAIC,EAAIC,EAAIhW,GAuC3B,IAAIhB,EAAI,GACJ2Q,EAAI3Q,EACJmX,EAAI,EAAMxG,EACd,MAEMyG,EAAOtO,KAEb,IAAIuO,EAAMC,EAAMC,EAEhB,IAAM,IAAIrX,EAAI,EAAGA,EANJ,GAMcA,IAAO,CAEjCmX,EAAO,EAAMF,EAAIA,EAAIxG,EACrB2G,EAAO,EAAMH,EAAIxG,EAAIA,EACrB4G,EAAM5G,EAAIA,EAAIA,EAEd,MAAM6G,EAAOH,EAAOR,EAASS,EAAOR,EAAO,EAAU9V,EAErD,GAAKoW,EAAKK,IAAKD,GAbJ,KAaiB,MAE5BxX,GAAK,EAEL2Q,GAAO6G,EAAK,EAAMxX,GAAMA,EACxBmX,EAAI,EAAMxG,EAIX,OAAS0G,EAAON,EAASO,EAAON,EAAOO,GCt+DzC,MAAM,UAAkB,IAEvB,YAAala,GAEZC,MAAOD,GAIR,MAAOE,EAAQma,GAEd,MAAMC,EAAM,CAAEC,QAAS,GAAI3Y,MAAO,EAAGC,OAAQ,EAAGmK,OAAQ,KAAMwO,YAAa,GAuC3E,SAASC,EAAenP,GAEvB,OAAOA,EAAMoP,WAAY,IACtBpP,EAAMoP,WAAY,IAAO,IACzBpP,EAAMoP,WAAY,IAAO,KACzBpP,EAAMoP,WAAY,IAAO,IAe7B,SAASC,EAAaza,EAAQ0a,EAAYhZ,EAAOC,GAEhD,MAAMgZ,EAAajZ,EAAQC,EAAS,EAC9BiZ,EAAY,IAAI3Z,WAAYjB,EAAQ0a,EAAYC,GAChDE,EAAY,IAAI5Z,WAAY0Z,GAClC,IAAIG,EAAM,EACN5b,EAAM,EACV,IAAM,IAAIwE,EAAI,EAAGA,EAAI/B,EAAQ+B,IAE5B,IAAM,IAAID,EAAI,EAAGA,EAAI/B,EAAO+B,IAAO,CAElC,MAAMkS,EAAIiF,EAAW1b,GAAOA,IAC5B,MAAM6b,EAAIH,EAAW1b,GAAOA,IAC5B,MAAM8b,EAAIJ,EAAW1b,GAAOA,IAC5B,MAAMwW,EAAIkF,EAAW1b,GAAOA,IAC5B2b,EAAWC,GAAQE,EAAGF,IACtBD,EAAWC,GAAQC,EAAGD,IACtBD,EAAWC,GAAQnF,EAAGmF,IACtBD,EAAWC,GAAQpF,EAAGoF,IAMxB,OAAOD,EAIR,MAAMI,EAAcV,EAAe,QAC7BW,EAAcX,EAAe,QAC7BY,EAAcZ,EAAe,QAC7Ba,EAAcb,EAAe,QA8B7BrZ,EAAS,IAAIma,WAAYrb,EAAQ,EA5Bf,IA8BxB,GAlHkB,YAkHbkB,EA1Ba,GA6BjB,OADAzC,QAAQsC,MAAO,8DACRqZ,EAIR,GA/FoB,GA+FblZ,EAxBa,IA2BnB,OADAzC,QAAQsC,MAAO,0EACRqZ,EAIR,IAAIkB,EAEJ,MAAMC,EAASra,EAhCM,IAkCrB,IAAIsa,GAAqB,EAEzB,OAASD,GAER,KAAKN,EAEJK,EAAa,EACblB,EAAItO,OAAS,IACb,MAED,KAAKoP,EAEJI,EAAa,GACblB,EAAItO,OAAS,IACb,MAED,KAAKqP,EAEJG,EAAa,GACblB,EAAItO,OAAS,IACb,MAED,KAAKsP,EAEJE,EAAa,EACblB,EAAItO,OAAS,IACb,MAED,QAEC,KAAmC,KAA9B5K,EA/DiB,KAgEO,SAAzBA,EA/De,KAgEU,MAAzBA,EA/De,KAgEU,IAAzBA,EA/De,KAgEU,WAAzBA,EA/De,KAwElB,OADAzC,QAAQsC,MAAO,mDAtIMqK,EAsI4DmQ,EApI5EE,OAAOC,aACL,IAARtQ,EACEA,GAAS,EAAM,IACfA,GAAS,GAAO,IAChBA,GAAS,GAAO,OAiIVgP,EAPPoB,GAAqB,EACrBF,EAAa,GACblB,EAAItO,OAAS,IAlIhB,IAAwBV,EA6IxBgP,EAAIE,YAAc,EA9KO,OAgLpBpZ,EA5Fa,KA4F6C,IAAhBiZ,IAE9CC,EAAIE,YAAc/O,KAAKC,IAAK,EAAGtK,EA1FR,KA8FxB,MAAMya,EAAQza,EAnFI,IAqFlB,GADAkZ,EAAIwB,aA/KqB,IA+KTD,GACXvB,EAAIwB,cA/K0B,KAgL9BD,MA/K8B,KAgL9BA,MA/K8B,KAgL9BA,MA/K8B,KAgL9BA,MA/K8B,MAgL9BA,MA/K8B,MAgL9BA,IAIJ,OADAld,QAAQsC,MAAO,mDACRqZ,EAIRA,EAAI1Y,MAAQR,EAhHM,GAiHlBkZ,EAAIzY,OAAST,EAlHM,GAoHnB,IAAIwZ,EAAaxZ,EAtHA,GAsHqB,EAItC,MAAM6J,EAAQqP,EAAIwB,UAAY,EAAI,EAElC,IAAM,IAAI9Q,EAAO,EAAGA,EAAOC,EAAOD,IAAU,CAE3C,IAAIpJ,EAAQ0Y,EAAI1Y,MACZC,EAASyY,EAAIzY,OAEjB,IAAM,IAAIgB,EAAI,EAAGA,EAAIyX,EAAIE,YAAa3X,IAAO,CAE5C,IAAIkY,EAAWF,EAEVa,GAEJX,EAAYJ,EAAaza,EAAQ0a,EAAYhZ,EAAOC,GACpDgZ,EAAaE,EAAU/Z,SAIvB6Z,EAAapP,KAAKC,IAAK,EAAG9J,GAAU,EAAI6J,KAAKC,IAAK,EAAG7J,GAAW,EAAI2Z,EACpET,EAAY,IAAI5Z,WAAYjB,EAAQ0a,EAAYC,IAIjD,MAAMkB,EAAS,CAAE,KAAQhB,EAAW,MAASnZ,EAAO,OAAUC,GAC9DyY,EAAIC,QAAQ9S,KAAMsU,GAElBnB,GAAcC,EAEdjZ,EAAQ6J,KAAKC,IAAK9J,GAAS,EAAG,GAC9BC,EAAS4J,KAAKC,IAAK7J,GAAU,EAAG,IAMlC,OAAOyY,G,iaC/QT,IAiBe0B,EAjBiB,WAC9B,IACE,GACyB,YAAvB,oBAAOC,YAAP,cAAOA,eAC4B,mBAA5BA,YAAYC,YACnB,CACA,IAAMC,EAAS,IAAIF,YAAYG,OAC7Bjb,WAAWkb,GAAG,EAAK,GAAM,IAAM,IAAM,EAAM,EAAM,EAAM,IAEzD,GAAIF,aAAkBF,YAAYG,OAChC,OAAO,IAAIH,YAAYK,SAASH,aAAmBF,YAAYK,UAGnE,MAAOrJ,IACT,OAAO,EAduB,G,0XCAhC,IAAMsJ,EAAe,kBAAM,MAoEZC,EA1DO,SAAC,GAAD,IACpBC,EADoB,EACpBA,GADoB,KAEpBC,MAFoB,EAGpBlR,aAHoB,MAGb,kBAHa,MAIpBvG,eAJoB,MAIVsX,EAJU,MAKpBxX,cALoB,MAKXwX,EALW,EAMjBI,EANiB,qDAQpB,IAAIC,SAAQ,SAACC,EAASC,GACpB,IAAIC,EAAgBlJ,SAASmJ,eAAeP,GAEtCQ,IAAoBF,EAW1B,GATKA,IACHA,EAAgBlJ,SAASC,cAAc,UACvCoJ,OAAOC,KAAKR,GAAMS,SAAQ,SAAAtO,GAAG,OAAKiO,EAAcjO,GAAO6N,EAAK7N,MAC5DiO,EAAcN,GAAKA,EACnBM,EAAcL,OAAQ,EACtBK,EAAcvR,KAAOA,GAGAuR,EAAcM,SACjB,CAClB,GAAIN,EAAcO,UAAW,CAC3B,IAAMrc,EAAQ,IAAI2E,MAAM,+BAExB,OADAX,EAAQ,CAAEhE,UACH6b,EAAO,CAAE7b,UAGlB,OADA8D,EAAO,CAAEwY,YAAOjP,QAASyO,IAClBF,EAAQ,CAAEU,YAAOjP,QAASyO,IAsBnC,GAnBAA,EAAcS,iBAAiB,SAAS,SAAAvc,GAItC,OAHA8b,EAAcM,UAAW,EACzBN,EAAcO,WAAY,EAC1BrY,EAAQ,CAAEhE,UACH6b,EAAO,CAAE7b,aAGd0b,EAAKvd,KACP2d,EAAcS,iBAAiB,QAAQ,SAAAD,GAGrC,OAFAR,EAAcM,UAAW,EACzBtY,EAAO,CAAEwY,QAAOjP,QAASyO,IAClBF,EAAQ,CAAEU,QAAOjP,QAASyO,OAIhCE,GACHpJ,SAAS4J,qBAAqB,QAAQ,GAAGC,YAAYX,IAGlDJ,EAAKvd,IAGR,OAFA2d,EAAcM,UAAW,EACzBtY,EAAO,CAAEuJ,QAASyO,IACXF,EAAQ,CAAEvO,QAASyO,QCnEjB,MAA0B,4DCmB5BY,GCnBE,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,ICAA,IfmBeC,GAGjBC,EAAa,CACxBC,UAAW,KACXC,aAAc,MACdC,cAAe,KACfC,iBAAkB,QAClBC,MAAO,MACPC,SAAU,OgB5BG,MAA0B,6C,q6CCgCzC,IAAMC,EAAiB,IAAIC,IAC3BD,EAAeE,WAAW,UAAW,IAAIC,GACzC,IAAMC,EAAY,IAAIC,EAAUL,GAC1BM,EAAkB,CACtB,eACA,gBACA,QACA,mBACA,YAEIC,EAAuB,CAC3BC,UAAW,CAAEC,IAAK,EAAGnT,IAAK,EAAGoT,KAAM,MACnCC,gBAAiB,CAAEF,IAAK,EAAGnT,IAAK,EAAGoT,KAAM,MACzCE,cAAe,CAAEH,IAAK,EAAGnT,IAAK,GAAIoT,KAAM,KACxCG,iBAAkB,GAClBC,UAAW,CAAEL,KAAM,EAAGnT,IAAK,EAAGoT,KAAM,KACpCK,UAAW,CAAEN,KAAM,EAAGnT,IAAK,EAAGoT,KAAM,KACpCM,UAAW,CAAEP,KAAM,EAAGnT,IAAK,EAAGoT,KAAM,MAGzBO,EAAb,a,kOAAA,U,QAAA,yJACEzL,OAAS0L,IAAMC,YADjB,EAEEC,IAAM,KAFR,EAGEC,OAAS,KAHX,EAIEC,eAAiB,KAJnB,EAKEC,MAAQ,KALV,EAMEC,MAAQ,KANV,EAOEC,gBAAkB,KAPpB,EAQEC,SAAW,KARb,EASEC,sBAAwB,KAT1B,EAUEC,MAAQ,KAVV,EAWEC,eAAiB,KAXnB,EAYEC,eAAiB,KAZnB,EAaEC,kBAAoB,CAClBC,eAAe,EACfC,IAAK,IAfT,EAiBEC,kBAAoB,KAjBtB,EAkBEC,YAAc,KAlBhB,EAmBEC,WAAa,KAnBf,EAoBEC,mBAAqB,IAAIC,IAAmB,CAAEC,UAAW,IApB3D,EAqBEC,cAAgB,CACdhB,MAAO,CACLhB,UAAW,EACXG,gBAAiB,GACjBC,cAAe,EACfC,kBAAkB,EAClBC,WAAY,EACZC,UAAW,EACXC,UAAW,GAEbmB,YAAa,CACXxC,cAAc,EACdC,eAAe,EACfE,OAAO,EACPD,kBAAkB,EAClBE,UAAU,EACV0C,SAAU,IArChB,EAwCEC,gBAAkB,CAChBC,MAAO,KACPnB,MAAO,GACPoB,YAAa,KACbC,kBAAmB,KACnBV,YAAa,CACX/R,OAAQ,KA9Cd,EAkDE0S,aAAe,WACb,MAQI,EAAKN,cAAchB,MAPrBhB,EADF,EACEA,UACAG,EAFF,EAEEA,gBACAC,EAHF,EAGEA,cACAC,EAJF,EAIEA,iBACAC,EALF,EAKEA,UACAC,EANF,EAMEA,UACAC,EAPF,EAOEA,UAEF,EAAKQ,MAAMhB,UAAYA,GAAa,EAAIG,GACxC,EAAKa,MAAM/W,SAAS7F,IAAIkc,EAAWC,EAAWC,GAC9C,EAAK+B,YAAYC,SAEjB,EAAKvB,gBAAgBjB,UAAYA,EAAYG,EAC7C,EAAKc,gBAAgBhX,SAAS7F,IAAIkc,EAAWC,EAAWC,GACxD,EAAKS,gBAAgBwB,aAAetC,EACpC,EAAKuC,aAAarP,QAAUgN,KAAsBF,EAElD,IAAMU,EAAS,EAAKI,gBAAgB0B,OAAO9B,OAC3CA,EAAO+B,MAAQxC,EACfS,EAAOgC,MAAQzC,EACfS,EAAOiC,IAAM1C,EACbS,EAAOkC,QAAU3C,EACjBS,EAAOmC,yBACP,EAAKN,aAAaF,SAClBnjB,OAAO4jB,sBAAsB,EAAKC,kBA5EtC,EA+EEC,UAAY,WACV,EAAKpC,MAAQ,IAAIqC,IACjB,EAAKrC,MAAMtW,IAAI,IAAI4Y,IAAW,IAE9B,IAAMrC,EAAQ,IAAIsC,IAAiB,UAAW,GAC9CtC,EAAMyB,YAAa,EACnB,EAAKzB,MAAQA,EAIb,MAA4C,EAAKgB,cAAchB,MAAvDV,EAAR,EAAQA,UAAWC,EAAnB,EAAmBA,UAAWC,EAA9B,EAA8BA,UAC9B,EAAKQ,MAAM/W,SAAS7F,IAAIkc,EAAWC,EAAWC,GAC9C,EAAK+B,YAAc,IAAIgB,IAAuBvC,EAAO,GAErD,IAAMC,EAAkBD,EAAMwC,QAC9BvC,EAAgB0B,OAAO9B,OAAO4C,IAAM,EACpCxC,EAAgB0B,OAAOe,QAAQtf,IAAI,KAAM,MACzC6c,EAAgB0B,OAAOgB,WAAa,IACpC,EAAK1C,gBAAkBA,EACvB,EAAKyB,aAAe,IAAIkB,IAAa3C,EAAgB0B,OAAO9B,QAE5D,EAAKE,MAAMtW,IAAIuW,GACf,EAAKD,MAAMtW,IAAI,EAAK8X,aACpB,EAAKxB,MAAMtW,IAAIwW,GACf,EAAKF,MAAMtW,IAAI,EAAKiY,cAEpB,EAAKR,gBAAgBC,MAAQ,EAAKvB,IAAIiD,UAAU,SAChD,IAAMC,EAAe,EAAK9B,cAAchB,MAClC+C,EAAiB,EAAK7B,gBAAgBC,MAC5C7D,OAAOC,KAAKwB,GAAsBvB,SAAQ,SAAAwF,GACxC,IAAMC,EAASlE,EAAqBiE,GACpC,EAAK9B,gBAAgBlB,MAAMgD,GAAaD,EAAetZ,IACrDqZ,EACAE,GAEEC,EAAO/D,OACT,EAAKgC,gBAAgBlB,MAAMgD,GAAa,EAAK9B,gBAAgBlB,MAC3DgD,GAEC/D,IAAIgE,EAAOhE,KACXnT,IAAImX,EAAOnX,KACXoT,KAAK+D,EAAO/D,OAEjB,EAAKgC,gBAAgBlB,MAAMgD,GAAa,EAAK9B,gBAAgBlB,MAC3DgD,GACAE,SAAS,EAAK5B,kBA5HtB,EAgIE6B,aAAe,WACb,IAAMjD,EAAW,IAAIkD,KAAc,CACjCpP,OAAQ,EAAKA,OAAOqP,QACpBC,WAAW,IAEb,EAAKpD,SAAWA,EAChBA,EAASqD,yBAA0B,EAEnCrD,EAASsD,oBAAsB,EAC/BtD,EAASuD,UAAU3W,SAAU,EAC7BoT,EAASuD,UAAU7X,KAAO8X,IAC1BxD,EAASyD,cAAc,SACvB,EAAKxD,sBAAwB,EAAKP,IAAIiD,UAAU,YAChD,EAAK1C,sBAAsB1W,IAAI,EAAKyW,SAAU,2BAC9C,EAAKC,sBACF1W,IAAI,EAAKyW,SAAU,uBACnBjB,IAAI,GACJnT,IAAI,GACJoT,KAAK,KACR,EAAKiB,sBACF1W,IAAI,EAAKyW,SAASuD,UAAW,WAC7BrkB,KAAK,oBACR,EAAKwkB,aACL,EAAKC,sBAvJT,EA0JE3B,gBAAkB,WAChB,EAAKhC,SAAS4D,OAAO,EAAK/D,MAAO,EAAKF,SA3J1C,EA8JEkE,KAAO,WACL,EAAKjE,eAAe0B,SACpB,EAAKX,mBAAmBW,OAAO,EAAKpB,MAAM4D,YAC1C,EAAK9B,kBACD,EAAK3B,kBAAkBC,gBACzB,EAAKF,eAAiBjiB,OAAO4jB,sBAAsB,EAAK8B,QAnK9D,EAuKEH,WAAa,WACX,IAAM5P,EAAS,EAAKA,OAAOqP,QACrBrhB,EAAQgS,EAAOiQ,YACfhiB,EAAS+R,EAAOkQ,aAEtB,EAAKrE,OAAS,IAAIsE,IAAkB,GAAIniB,EAAQC,EAAQ,GAAK,KAC7D,EAAK4d,OAAO5W,SAAS7F,IAAI,EAAG,EAAG,GAE/B,EAAK0c,eAAiB,IAAIsE,IAAc,EAAKvE,OAAQ7L,GACrD,EAAK8L,eAAetT,OAAOpJ,IAAI,EAAG,EAAG,GACrC,EAAK0c,eAAe0B,SACpB,EAAK1B,eAAelC,iBAAiB,UAAU,WACxC,EAAK2C,kBAAkBC,eAC1B,EAAK0B,sBApLb,EAyLE2B,mBAAqBQ,KAAS,WAC5B,GAAK,EAAKrQ,OAAOqP,QAAjB,CAGA,IAAMrP,EAAS,EAAKA,OAAOqP,QACrBnD,EAAW,EAAKA,SAChBle,EAAQgS,EAAOiQ,YACfhiB,EAAS+R,EAAOkQ,aACtBhE,EAASoE,QAAQtiB,EAAOC,GACxBie,EAASqE,cAAc1Y,KAAKoT,IAAI5gB,OAAOmmB,iBAAkB,IAEzD,EAAK3E,OAAO4E,OAASziB,EAAQC,EAC7B,EAAK4d,OAAOmC,yBACP,EAAKzB,kBAAkBC,eAC1B,EAAK0B,qBAEN,KAzML,EA2MEwC,YAAc,YAAc,IAAXtlB,EAAW,EAAXA,KACf,OAAO,EAAKuhB,YAAYhY,SAASgc,MAAK,SAAAC,GAAC,OAAIxlB,IAASwlB,EAAExlB,SA5M1D,EA+MEylB,qBAAuB,WACrB,EAAK3D,gBAAgBE,YAAc,EAAKxB,IAAIiD,UAAU,eACtD,IAAMiC,EAAe,EAAK5D,gBAAgBE,YAC1C,EAAKF,gBAAgBP,YAAYxC,aAAe2G,EAC7Crb,IAAI,EAAKuX,cAAcL,YAAa,gBACpCuC,UAAS,WACR,IAAMva,EAAW,EAAK+b,YAAY,CAAEtlB,KAAM6e,EAAWE,eAC/C9L,EAAU,EAAK2O,cAAcL,YAAYxC,aAC/CxV,EAAS0J,QAAUA,EACnB1J,EAAS0H,SAAWgC,EACpBhU,OAAO4jB,sBAAsB,EAAKC,oBAEtC,EAAKhB,gBAAgBP,YAAYvC,cAAgB0G,EAC9Crb,IAAI,EAAKuX,cAAcL,YAAa,iBACpCuC,UAAS,WACR,IAAMva,EAAW,EAAK+b,YAAY,CAAEtlB,KAAM6e,EAAWG,gBAC/C/L,EAAU,EAAK2O,cAAcL,YAAYvC,cAC/CzV,EAAS0J,QAAUA,EACnB1J,EAAS0H,SAAWgC,EACpB,EAAKsO,YAAYoE,sBAAsB,IAAM,IAAO1S,EAChDA,GAAW,EAAK2O,cAAcL,YAAYtC,kBAC5C,EAAK6C,gBAAgBP,YAAYtC,iBAAiB2G,UAAS,GAE7D3mB,OAAO4jB,sBAAsB,EAAKC,oBAEtC,EAAKhB,gBAAgBP,YAAYtC,iBAAmByG,EACjDrb,IAAI,EAAKuX,cAAcL,YAAa,oBACpCuC,UAAS,WACR,IAAMva,EAAW,EAAK+b,YAAY,CAChCtlB,KAAM6e,EAAWI,mBAEbhM,EAAU,EAAK2O,cAAcL,YAAYtC,iBAC/C1V,EAAS0J,QAAUA,EACnB1J,EAAS0H,SAAWgC,EAChBA,GAAW,EAAK2O,cAAcL,YAAYvC,eAC5C,EAAK8C,gBAAgBP,YAAYvC,cAAc4G,UAAS,GAE1D3mB,OAAO4jB,sBAAsB,EAAKC,oBAEtC,EAAKhB,gBAAgBP,YAAYpC,SAAWuG,EACzCrb,IAAI,EAAKuX,cAAcL,YAAa,YACpCuC,UAAS,WACR,IAAM+B,EAAgB,EAAKP,YAAY,CAAEtlB,KAAM6e,EAAWK,QACpD4G,EAAmB,EAAKR,YAAY,CACxCtlB,KAAM6e,EAAWM,WAEb4G,EAAW,EAAKnE,cAAcL,YAAYpC,SAChD0G,EAAc5S,SAAW8S,EACzBF,EAAc5U,UAAY8U,EAC1BD,EAAiB7S,QAAU8S,EAC3BD,EAAiB7U,SAAW8U,EAC5B9mB,OAAO4jB,sBAAsB,EAAKC,oBAEtC,EAAKhB,gBAAgBG,kBACnB,EAAKH,gBAAgBE,YAAYyB,UAAU,UAC7CvF,OAAOC,KAAK,EAAKoD,YAAY7J,uBAAuB0G,SAAQ,SAAA4H,GAC1D,EAAKlE,gBAAgBP,YAAY/R,OAAOwW,GACtC,EAAKlE,gBAAgBG,kBAAkB5X,IACrC,EAAKkX,YAAYoE,sBACjB,EAAKpE,YAAY7J,sBAAsBsO,IAEtCnG,IAAI,GACJnT,IAAI,GACJoT,KAAK,KACL9f,KAAKgmB,GACLlC,UAAS,kBAAM7kB,OAAO4jB,sBAAsB,EAAKC,wBAhR5D,EAoREmD,WAAa,WACXzG,EAAU0G,kBACRlE,EACA,CAACmE,IACD,YAAyB,IAAtB9e,EAAsB,EAAtBA,KAAME,EAAgB,EAAhBA,UACPF,EAAK8C,MAAMnG,IAAI,GAAK,GAAK,IACzBqD,EAAKwC,SAAS7F,IAAI,EAAG,EAAG,GACxBqD,EAAK+e,eAAgB,EACrB/e,EAAKgb,YAAa,EAClB,EAAK1B,MAAMtW,IAAIhD,GACfpI,OAAO+iB,YAAc3a,EACrB,EAAKka,YAAcla,EAGnBA,EAAKse,sBAAsB,IAAM,GAEjC,IAAMU,EAAY,EAAKf,YAAY,CAAEtlB,KAAM6e,EAAWC,YACtDuH,EAAUpT,SAAU,EACpBoT,EAAUpV,QAAU,EAEpByO,EAAgBtB,SAAQ,SAAAkI,GACtB,IAAMC,EAAc,EAAK3E,cAAcL,YAAY+E,GAC7C/c,EAAW,EAAK+b,YAAY,CAAEtlB,KAAM6e,EAAWyH,KACrD/c,EAAS0J,QAAUsT,EACnBhd,EAAS0H,SAAWsV,KAGtB,EAAKd,uBAEL,EAAKhE,mBAAmBpX,IAAIhD,EAAM,CAAEE,YAAWif,SAAS,IACxD,EAAK/E,mBAAmBgF,OAAO,aAAa,GAE5C,EAAKxF,eAAiBhiB,OAAOynB,WAAW,EAAK5D,gBAAiB,SApTtE,S,EAAA,G,EAAA,iC,EAAA,yBAyTE,mHACQ6D,EAAkBnJ,EAAc,CACpCC,GAAI,UACJrd,IAAK4c,EACD,oCACA,iCAENxX,KAAKgb,IAAM,IAAIoG,IAAQ,CAAEC,UAAU,EAAMC,QAAQ,EAAOC,YAAY,IACpEvhB,KAAKwb,MAAQ,IAAIgG,IACjBxhB,KAAKud,YACLvd,KAAKue,eACLve,KAAK0c,eACL1c,KAAK8b,kBAAoB9b,KAAKgb,IAC3BnW,IAAI7E,KAAK2b,kBAAmB,iBAC5B2C,UAAS,WACJ,EAAK3C,kBAAkBC,eACzB,EAAKK,mBAAmBgF,OAAO,aAAa,GAC5C,EAAKzF,MAAMjL,QACX,EAAK4O,SAEL,EAAK3D,MAAMiG,OACX,EAAKxF,mBAAmBgF,OAAO,aAAa,OAGlDxnB,OAAOuf,iBAAiB,SAAUhZ,KAAKif,oBAxBzC,UAyBQkC,EAzBR,yBA4BwB1nB,OAAOioB,OA5B/B,QA4BQC,EA5BR,OA6BEloB,OAAOioB,KAAOC,EACd3hB,KAAKygB,aA9BP,gDAzTF,E,8KAAA,+EA0VE,WACMzgB,KAAKgb,KACPhb,KAAKgb,IAAI4G,UAEXnoB,OAAOooB,qBAAqB7hB,KAAK0b,gBACjCjiB,OAAOqoB,oBAAoB,SAAU9hB,KAAKif,oBAC1CxlB,OAAOsoB,aAAa/hB,KAAKyb,kBAhW7B,oBAmWE,WACE,OACE,kBAACuG,EAAD,KACE,kBAACC,EAAD,CAAQC,IAAKliB,KAAKoP,e,2BAtW1B,GAA0B0L,IAAMqH,eA4W1BH,EAAa9mB,UAAOC,IAAV,uEAAGD,CAAH,gBAIV+mB,EAAS/mB,UAAOkU,OAAV,mEAAGlU,CAAH,sDAMG2f,O,mIC1aA,MAA0B,+B,4yCCQzC,IAAMuH,EAAgB,yCAETC,EAAb,a,kOAAA,U,MAAA,oE,EAAA,G,EAAA,qBACE,WACE,MAA8BriB,KAAK1E,MAA3BgnB,EAAR,EAAQA,MAAO1oB,EAAf,EAAeA,WACT2oB,EAAY3oB,EAAU,UACrBwoB,EADqB,iBACCxoB,GACzBwoB,EACJ,OACE,kBAACI,EAAD,KACE,kBAACC,EAAD,CAAMC,KAAMH,EAAW3a,OAAO,UAC5B,yBAAKhN,IAAK+nB,EAAYC,IAAI,YAE5B,kBAACH,EAAD,CAAMC,KAAI,iBAAYJ,GAAS1a,OAAO,UACpC,yBAAKhN,ICtBA,6nBDsBgBgoB,IAAI,iB,2BAZnC,GAA4B9H,IAAMqH,eAmBlCE,EAAOvnB,UAAY,CACjBwnB,MAAOvnB,IAAU8nB,OACjBjpB,WAAYmB,IAAU8nB,QAGxBR,EAAOpnB,aAAe,CACpBqnB,MAAO,sBACP1oB,WAAY,IAGd,IAAM4oB,EAAetnB,UAAOC,IAAV,2EAAGD,CAAH,sFAQZunB,EAAOvnB,UAAOkW,EAAV,mEAAGlW,CAAH,iLAkBKmnB,O,iCEjEf,sDAOAS,IAAS5D,OAAO,kBAAC,IAAD,MAAS7P,SAASmJ,eAAe,c,iBCPjD,IAAI/B,EAGJA,EAAI,WACH,OAAOzW,KADJ,GAIJ,IAECyW,EAAIA,GAAK,IAAIsM,SAAS,cAAb,GACR,MAAOtU,GAEc,iBAAXhV,SAAqBgd,EAAIhd,QAOrCke,EAAOqL,QAAUvM","file":"js/bundle~bundle~31ecd969.0dd19fdb.js","sourcesContent":["// App.jsx\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { hot } from 'react-hot-loader/root';\nimport styled, {\n  createGlobalStyle,\n  StyleSheetManager,\n} from 'styled-components';\nimport styledNormalize from 'styled-normalize';\nimport { Helmet } from 'react-helmet';\n\nimport Main from '../component/Main.jsx';\nimport Footer from '../component/Footer.jsx';\nimport XMenLogoSource from '../../img/x-men-school.svg';\n\nconst GlobalStyle = createGlobalStyle`\n  ${styledNormalize};\n  *, ::after, ::before { box-sizing: border-box; }\n  body {\n    background-color: #101010;\n    color: #efefef;\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\",\n      Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n    font-weight: 400;\n    -webkit-tap-highlight-color: transparent;\n    overscroll-behavior-y: contain;\n  }\n  button {\n    background-color: rgba(0, 0, 0, 0);\n    cursor: pointer;\n    &:disabled {\n      cursor: not-allowed;\n    }\n  }\n  input::placeholder,\n  input::-webkit-input-placeholder,\n  input::-moz-placeholder {\n    line-height: normal !important;\n    vertical-align: middle;\n  }\n  a { color: inherit; text-decoration: none; }\n  a > * { opacity: inherit; }\n  a:hover { opacity: .7; }\n`;\n\nconst isServer = typeof window === 'undefined';\nconst title = 'Portfolio';\nconst description = \"Bill's portfolio\";\nconst branchName = isServer\n  ? process.env.BRANCH_NAME\n  : window.__SSR_ENVIRONMENT__.branchName;\n\nconst App = ({ request }) => {\n  // eslint-disable-next-line no-console\n  console.log('App() request:', request);\n  return (\n    <>\n      <Helmet defaultTitle=\"Portfolio\" titleTemplate=\"%s - Portfolio\">\n        <meta charSet=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n\n        <meta name=\"author\" content=\"Bill\" />\n        <meta name=\"description\" content={description} />\n\n        <meta\n          property=\"og:url\"\n          content=\"https://github.com/bill42362/portfolio\"\n        />\n        <meta property=\"og:type\" content=\"website\" />\n        <meta property=\"og:title\" content={title} />\n        <meta property=\"og:description\" content={description} />\n        <meta property=\"og:site_name\" content={title} />\n        <meta property=\"twitter:card\" content=\"summary\" />\n        <meta property=\"twitter:site\" content=\"@bill_portfolio\" />\n        {/* <meta property=\"twitter:image\" content={twitterImageSource} /> */}\n      </Helmet>\n      <GlobalStyle />\n      <StyledApp>\n        {!window && <img src={XMenLogoSource} title=\"Xavier school\" />}\n        <Main />\n        <Footer branchName={branchName} />\n      </StyledApp>\n    </>\n  );\n};\n\nApp.propTypes = {\n  request: PropTypes.object,\n};\n\nApp.defaultProps = {\n  request: null,\n};\n\nconst StyledApp = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  height: 100vh;\n  background-color: #222f3e;\n`;\n\nconst Body = ({ sheet, ...props }) => {\n  if (sheet.instance) {\n    return (\n      <StyleSheetManager sheet={sheet.instance}>\n        <App {...props} />\n      </StyleSheetManager>\n    );\n  } else {\n    return <App {...props} />;\n  }\n};\n\nBody.propTypes = {\n  ...App.propTypes,\n  sheet: PropTypes.object,\n};\n\nBody.defaultProps = {\n  ...App.defaultProps,\n  sheet: {},\n};\n\nexport default hot(Body);\n","export default __webpack_public_path__ + \"img/x-men-school.0928a818.svg\";","import {\n\tDataTextureLoader,\n\tLinearMipmapLinearFilter\n} from 'three';\n\nclass TGALoader extends DataTextureLoader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tparse( buffer ) {\n\n\t\t// reference from vthibault, https://github.com/vthibault/roBrowser/blob/master/src/Loaders/Targa.js\n\n\t\tfunction tgaCheckHeader( header ) {\n\n\t\t\tswitch ( header.image_type ) {\n\n\t\t\t\t// check indexed type\n\n\t\t\t\tcase TGA_TYPE_INDEXED:\n\t\t\t\tcase TGA_TYPE_RLE_INDEXED:\n\t\t\t\t\tif ( header.colormap_length > 256 || header.colormap_size !== 24 || header.colormap_type !== 1 ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for indexed type.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\t// check colormap type\n\n\t\t\t\tcase TGA_TYPE_RGB:\n\t\t\t\tcase TGA_TYPE_GREY:\n\t\t\t\tcase TGA_TYPE_RLE_RGB:\n\t\t\t\tcase TGA_TYPE_RLE_GREY:\n\t\t\t\t\tif ( header.colormap_type ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for colormap type.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\t// What the need of a file without data ?\n\n\t\t\t\tcase TGA_TYPE_NO_DATA:\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\n\n\t\t\t\t\t// Invalid type ?\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type \"%s\".', header.image_type );\n\n\t\t\t}\n\n\t\t\t// check image width and height\n\n\t\t\tif ( header.width <= 0 || header.height <= 0 ) {\n\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid image size.' );\n\n\t\t\t}\n\n\t\t\t// check image pixel size\n\n\t\t\tif ( header.pixel_size !== 8 && header.pixel_size !== 16 &&\n\t\t\t\theader.pixel_size !== 24 && header.pixel_size !== 32 ) {\n\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid pixel size \"%s\".', header.pixel_size );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// parse tga image buffer\n\n\t\tfunction tgaParse( use_rle, use_pal, header, offset, data ) {\n\n\t\t\tlet pixel_data,\n\t\t\t\tpalettes;\n\n\t\t\tconst pixel_size = header.pixel_size >> 3;\n\t\t\tconst pixel_total = header.width * header.height * pixel_size;\n\n\t\t\t // read palettes\n\n\t\t\t if ( use_pal ) {\n\n\t\t\t\t palettes = data.subarray( offset, offset += header.colormap_length * ( header.colormap_size >> 3 ) );\n\n\t\t\t }\n\n\t\t\t // read RLE\n\n\t\t\t if ( use_rle ) {\n\n\t\t\t\t pixel_data = new Uint8Array( pixel_total );\n\n\t\t\t\tlet c, count, i;\n\t\t\t\tlet shift = 0;\n\t\t\t\tconst pixels = new Uint8Array( pixel_size );\n\n\t\t\t\twhile ( shift < pixel_total ) {\n\n\t\t\t\t\tc = data[ offset ++ ];\n\t\t\t\t\tcount = ( c & 0x7f ) + 1;\n\n\t\t\t\t\t// RLE pixels\n\n\t\t\t\t\tif ( c & 0x80 ) {\n\n\t\t\t\t\t\t// bind pixel tmp array\n\n\t\t\t\t\t\tfor ( i = 0; i < pixel_size; ++ i ) {\n\n\t\t\t\t\t\t\tpixels[ i ] = data[ offset ++ ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// copy pixel array\n\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\n\n\t\t\t\t\t\t\tpixel_data.set( pixels, shift + i * pixel_size );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshift += pixel_size * count;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// raw pixels\n\n\t\t\t\t\t\tcount *= pixel_size;\n\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\n\n\t\t\t\t\t\t\tpixel_data[ shift + i ] = data[ offset ++ ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshift += count;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t } else {\n\n\t\t\t\t// raw pixels\n\n\t\t\t\tpixel_data = data.subarray(\n\t\t\t\t\t offset, offset += ( use_pal ? header.width * header.height : pixel_total )\n\t\t\t\t);\n\n\t\t\t }\n\n\t\t\t return {\n\t\t\t\tpixel_data: pixel_data,\n\t\t\t\tpalettes: palettes\n\t\t\t };\n\n\t\t}\n\n\t\tfunction tgaGetImageData8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image, palettes ) {\n\n\t\t\tconst colormap = palettes;\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\n\n\t\t\t\t\tcolor = image[ i ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = colormap[ ( color * 3 ) + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = colormap[ ( color * 3 ) + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = colormap[ ( color * 3 ) + 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\n\n\t\t\t\t\tcolor = image[ i + 0 ] + ( image[ i + 1 ] << 8 ); // Inversed ?\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = ( color & 0x7C00 ) >> 7;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = ( color & 0x03E0 ) >> 2;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = ( color & 0x001F ) >> 3;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = ( color & 0x8000 ) ? 0 : 255;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData24bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 3 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData32bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 4 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 3 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageDataGrey8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\n\n\t\t\t\t\tcolor = image[ i ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageDataGrey16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 1 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction getTgaRGBA( data, width, height, image, palette ) {\n\n\t\t\tlet x_start,\n\t\t\t\ty_start,\n\t\t\t\tx_step,\n\t\t\t\ty_step,\n\t\t\t\tx_end,\n\t\t\t\ty_end;\n\n\t\t\tswitch ( ( header.flags & TGA_ORIGIN_MASK ) >> TGA_ORIGIN_SHIFT ) {\n\n\t\t\t\tdefault:\n\t\t\t\tcase TGA_ORIGIN_UL:\n\t\t\t\t\tx_start = 0;\n\t\t\t\t\tx_step = 1;\n\t\t\t\t\tx_end = width;\n\t\t\t\t\ty_start = 0;\n\t\t\t\t\ty_step = 1;\n\t\t\t\t\ty_end = height;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_BL:\n\t\t\t\t\tx_start = 0;\n\t\t\t\t\tx_step = 1;\n\t\t\t\t\tx_end = width;\n\t\t\t\t\ty_start = height - 1;\n\t\t\t\t\ty_step = - 1;\n\t\t\t\t\ty_end = - 1;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_UR:\n\t\t\t\t\tx_start = width - 1;\n\t\t\t\t\tx_step = - 1;\n\t\t\t\t\tx_end = - 1;\n\t\t\t\t\ty_start = 0;\n\t\t\t\t\ty_step = 1;\n\t\t\t\t\ty_end = height;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_BR:\n\t\t\t\t\tx_start = width - 1;\n\t\t\t\t\tx_step = - 1;\n\t\t\t\t\tx_end = - 1;\n\t\t\t\t\ty_start = height - 1;\n\t\t\t\t\ty_step = - 1;\n\t\t\t\t\ty_end = - 1;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( use_grey ) {\n\n\t\t\t\tswitch ( header.pixel_size ) {\n\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\ttgaGetImageDataGrey8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttgaGetImageDataGrey16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tswitch ( header.pixel_size ) {\n\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\ttgaGetImageData8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image, palette );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttgaGetImageData16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 24:\n\t\t\t\t\t\ttgaGetImageData24bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 32:\n\t\t\t\t\t\ttgaGetImageData32bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Load image data according to specific method\n\t\t\t// let func = 'tgaGetImageData' + (use_grey ? 'Grey' : '') + (header.pixel_size) + 'bits';\n\t\t\t// func(data, y_start, y_step, y_end, x_start, x_step, x_end, width, image, palette );\n\t\t\treturn data;\n\n\t\t}\n\n\t\t// TGA constants\n\n\t\tconst TGA_TYPE_NO_DATA = 0,\n\t\t\tTGA_TYPE_INDEXED = 1,\n\t\t\tTGA_TYPE_RGB = 2,\n\t\t\tTGA_TYPE_GREY = 3,\n\t\t\tTGA_TYPE_RLE_INDEXED = 9,\n\t\t\tTGA_TYPE_RLE_RGB = 10,\n\t\t\tTGA_TYPE_RLE_GREY = 11,\n\n\t\t\tTGA_ORIGIN_MASK = 0x30,\n\t\t\tTGA_ORIGIN_SHIFT = 0x04,\n\t\t\tTGA_ORIGIN_BL = 0x00,\n\t\t\tTGA_ORIGIN_BR = 0x01,\n\t\t\tTGA_ORIGIN_UL = 0x02,\n\t\t\tTGA_ORIGIN_UR = 0x03;\n\n\t\tif ( buffer.length < 19 ) console.error( 'THREE.TGALoader: Not enough data to contain header.' );\n\n\t\tlet offset = 0;\n\n\t\tconst content = new Uint8Array( buffer ),\n\t\t\theader = {\n\t\t\t\tid_length: content[ offset ++ ],\n\t\t\t\tcolormap_type: content[ offset ++ ],\n\t\t\t\timage_type: content[ offset ++ ],\n\t\t\t\tcolormap_index: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tcolormap_length: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tcolormap_size: content[ offset ++ ],\n\t\t\t\torigin: [\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8\n\t\t\t\t],\n\t\t\t\twidth: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\theight: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tpixel_size: content[ offset ++ ],\n\t\t\t\tflags: content[ offset ++ ]\n\t\t\t};\n\n\t\t// check tga if it is valid format\n\n\t\ttgaCheckHeader( header );\n\n\t\tif ( header.id_length + offset > buffer.length ) {\n\n\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\n\n\t\t}\n\n\t\t// skip the needn't data\n\n\t\toffset += header.id_length;\n\n\t\t// get targa information about RLE compression and palette\n\n\t\tlet use_rle = false,\n\t\t\tuse_pal = false,\n\t\t\tuse_grey = false;\n\n\t\tswitch ( header.image_type ) {\n\n\t\t\tcase TGA_TYPE_RLE_INDEXED:\n\t\t\t\tuse_rle = true;\n\t\t\t\tuse_pal = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_INDEXED:\n\t\t\t\tuse_pal = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RLE_RGB:\n\t\t\t\tuse_rle = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RGB:\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RLE_GREY:\n\t\t\t\tuse_rle = true;\n\t\t\t\tuse_grey = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_GREY:\n\t\t\t\tuse_grey = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t//\n\n\t\tconst imageData = new Uint8Array( header.width * header.height * 4 );\n\t\tconst result = tgaParse( use_rle, use_pal, header, offset, content );\n\t\tgetTgaRGBA( imageData, header.width, header.height, result.pixel_data, result.palettes );\n\n\t\treturn {\n\n\t\t\tdata: imageData,\n\t\t\twidth: header.width,\n\t\t\theight: header.height,\n\t\t\tflipY: true,\n\t\t\tgenerateMipmaps: true,\n\t\t\tminFilter: LinearMipmapLinearFilter,\n\n\t\t};\n\n\t}\n\n}\n\nexport { TGALoader };\n","import {\n\tAddOperation,\n\tAnimationClip,\n\tBone,\n\tBufferGeometry,\n\tColor,\n\tCustomBlending,\n\tDoubleSide,\n\tDstAlphaFactor,\n\tEuler,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tFrontSide,\n\tInterpolant,\n\tLoader,\n\tLoaderUtils,\n\tMeshToonMaterial,\n\tMultiplyOperation,\n\tNearestFilter,\n\tNumberKeyframeTrack,\n\tOneMinusSrcAlphaFactor,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSrcAlphaFactor,\n\tTextureLoader,\n\tUint16BufferAttribute,\n\tVector3,\n\tVectorKeyframeTrack\n} from 'three';\nimport { TGALoader } from '../loaders/TGALoader.js';\nimport { MMDParser } from '../libs/mmdparser.module.js';\n\n/**\n * Dependencies\n *  - mmd-parser https://github.com/takahirox/mmd-parser\n *  - TGALoader\n *  - OutlineEffect\n *\n * MMDLoader creates Three.js Objects from MMD resources as\n * PMD, PMX, VMD, and VPD files.\n *\n * PMD/PMX is a model data format, VMD is a motion data format\n * VPD is a posing data format used in MMD(Miku Miku Dance).\n *\n * MMD official site\n *  - https://sites.google.com/view/evpvp/\n *\n * PMD, VMD format (in Japanese)\n *  - http://blog.goo.ne.jp/torisu_tetosuki/e/209ad341d3ece2b1b4df24abf619d6e4\n *\n * PMX format\n *  - https://gist.github.com/felixjones/f8a06bd48f9da9a4539f\n *\n * TODO\n *  - light motion in vmd support.\n *  - SDEF support.\n *  - uv/material/bone morphing support.\n *  - more precise grant skinning support.\n *  - shadow support.\n */\n\n/**\n * @param {THREE.LoadingManager} manager\n */\nclass MMDLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.loader = new FileLoader( this.manager );\n\n\t\tthis.parser = null; // lazy generation\n\t\tthis.meshBuilder = new MeshBuilder( this.manager );\n\t\tthis.animationBuilder = new AnimationBuilder();\n\n\t}\n\n\t/**\n\t * @param {string} animationPath\n\t * @return {MMDLoader}\n\t */\n\tsetAnimationPath( animationPath ) {\n\n\t\tthis.animationPath = animationPath;\n\t\treturn this;\n\n\t}\n\n\t// Load MMD assets as Three.js Object\n\n\t/**\n\t * Loads Model file (.pmd or .pmx) as a SkinnedMesh.\n\t *\n\t * @param {string} url - url to Model(.pmd or .pmx) file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst builder = this.meshBuilder.setCrossOrigin( this.crossOrigin );\n\n\t\t// resource path\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\tresourcePath = this.path;\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\tconst modelExtension = this._extractExtension( url ).toLowerCase();\n\n\t\t// Should I detect by seeing header?\n\t\tif ( modelExtension !== 'pmd' && modelExtension !== 'pmx' ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.MMDLoader: Unknown model file extension .' + modelExtension + '.' ) );\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tthis[ modelExtension === 'pmd' ? 'loadPMD' : 'loadPMX' ]( url, function ( data ) {\n\n\t\t\tonLoad(\tbuilder.build( data, resourcePath, onProgress, onError )\t);\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads Motion file(s) (.vmd) as a AnimationClip.\n\t * If two or more files are specified, they'll be merged.\n\t *\n\t * @param {string|Array<string>} url - url(s) to animation(.vmd) file(s)\n\t * @param {SkinnedMesh|THREE.Camera} object - tracks will be fitting to this object\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadAnimation( url, object, onLoad, onProgress, onError ) {\n\n\t\tconst builder = this.animationBuilder;\n\n\t\tthis.loadVMD( url, function ( vmd ) {\n\n\t\t\tonLoad( object.isCamera\n\t\t\t\t? builder.buildCameraAnimation( vmd )\n\t\t\t\t: builder.build( vmd, object ) );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads mode file and motion file(s) as an object containing\n\t * a SkinnedMesh and a AnimationClip.\n\t * Tracks of AnimationClip are fitting to the model.\n\t *\n\t * @param {string} modelUrl - url to Model(.pmd or .pmx) file\n\t * @param {string|Array{string}} vmdUrl - url(s) to animation(.vmd) file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadWithAnimation( modelUrl, vmdUrl, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tthis.load( modelUrl, function ( mesh ) {\n\n\t\t\tscope.loadAnimation( vmdUrl, mesh, function ( animation ) {\n\n\t\t\t\tonLoad( {\n\t\t\t\t\tmesh: mesh,\n\t\t\t\t\tanimation: animation\n\t\t\t\t} );\n\n\t\t\t}, onProgress, onError );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t// Load MMD assets as Object data parsed by MMDParser\n\n\t/**\n\t * Loads .pmd file as an Object.\n\t *\n\t * @param {string} url - url to .pmd file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadPMD( url, onLoad, onProgress, onError ) {\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( undefined )\n\t\t\t.setPath( this.path )\n\t\t\t.setResponseType( 'arraybuffer' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials )\n\t\t\t.load( url, function ( buffer ) {\n\n\t\t\t\tonLoad( parser.parsePmd( buffer, true ) );\n\n\t\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads .pmx file as an Object.\n\t *\n\t * @param {string} url - url to .pmx file\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadPMX( url, onLoad, onProgress, onError ) {\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( undefined )\n\t\t\t.setPath( this.path )\n\t\t\t.setResponseType( 'arraybuffer' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials )\n\t\t\t.load( url, function ( buffer ) {\n\n\t\t\t\tonLoad( parser.parsePmx( buffer, true ) );\n\n\t\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Loads .vmd file as an Object. If two or more files are specified\n\t * they'll be merged.\n\t *\n\t * @param {string|Array<string>} url - url(s) to .vmd file(s)\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadVMD( url, onLoad, onProgress, onError ) {\n\n\t\tconst urls = Array.isArray( url ) ? url : [ url ];\n\n\t\tconst vmds = [];\n\t\tconst vmdNum = urls.length;\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( undefined )\n\t\t\t.setPath( this.animationPath )\n\t\t\t.setResponseType( 'arraybuffer' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials );\n\n\t\tfor ( let i = 0, il = urls.length; i < il; i ++ ) {\n\n\t\t\tthis.loader.load( urls[ i ], function ( buffer ) {\n\n\t\t\t\tvmds.push( parser.parseVmd( buffer, true ) );\n\n\t\t\t\tif ( vmds.length === vmdNum ) onLoad( parser.mergeVmds( vmds ) );\n\n\t\t\t}, onProgress, onError );\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Loads .vpd file as an Object.\n\t *\n\t * @param {string} url - url to .vpd file\n\t * @param {boolean} isUnicode\n\t * @param {function} onLoad\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t */\n\tloadVPD( url, isUnicode, onLoad, onProgress, onError ) {\n\n\t\tconst parser = this._getParser();\n\n\t\tthis.loader\n\t\t\t.setMimeType( isUnicode ? undefined : 'text/plain; charset=shift_jis' )\n\t\t\t.setPath( this.animationPath )\n\t\t\t.setResponseType( 'text' )\n\t\t\t.setRequestHeader( this.requestHeader )\n\t\t\t.setWithCredentials( this.withCredentials )\n\t\t\t.load( url, function ( text ) {\n\n\t\t\t\tonLoad( parser.parseVpd( text, true ) );\n\n\t\t\t}, onProgress, onError );\n\n\t}\n\n\t// private methods\n\n\t_extractExtension( url ) {\n\n\t\tconst index = url.lastIndexOf( '.' );\n\t\treturn index < 0 ? '' : url.slice( index + 1 );\n\n\t}\n\n\t_getParser() {\n\n\t\tif ( this.parser === null ) {\n\n\t\t\tif ( typeof MMDParser === 'undefined' ) {\n\n\t\t\t\tthrow new Error( 'THREE.MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser' );\n\n\t\t\t}\n\n\t\t\tthis.parser = new MMDParser.Parser(); // eslint-disable-line no-undef\n\n\t\t}\n\n\t\treturn this.parser;\n\n\t}\n\n}\n\n// Utilities\n\n/*\n\t * base64 encoded defalut toon textures toon00.bmp - toon10.bmp.\n\t * We don't need to request external toon image files.\n\t * This idea is from http://www20.atpages.jp/katwat/three.js_r58/examples/mytest37/mmd.three.js\n\t */\nconst DEFAULT_TOON_TEXTURES = [\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=',\n\t'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII='\n];\n\n// Builders. They build Three.js object from Object data parsed by MMDParser.\n\n/**\n * @param {THREE.LoadingManager} manager\n */\nclass MeshBuilder {\n\n\tconstructor( manager ) {\n\n\t\tthis.crossOrigin = 'anonymous';\n\t\tthis.geometryBuilder = new GeometryBuilder();\n\t\tthis.materialBuilder = new MaterialBuilder( manager );\n\n\t}\n\n\t/**\n\t * @param {string} crossOrigin\n\t * @return {MeshBuilder}\n\t */\n\tsetCrossOrigin( crossOrigin ) {\n\n\t\tthis.crossOrigin = crossOrigin;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * @param {Object} data - parsed PMD/PMX data\n\t * @param {string} resourcePath\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t * @return {SkinnedMesh}\n\t */\n\tbuild( data, resourcePath, onProgress, onError ) {\n\n\t\tconst geometry = this.geometryBuilder.build( data );\n\t\tconst material = this.materialBuilder\n\t\t\t.setCrossOrigin( this.crossOrigin )\n\t\t\t.setResourcePath( resourcePath )\n\t\t\t.build( data, geometry, onProgress, onError );\n\n\t\tconst mesh = new SkinnedMesh( geometry, material );\n\n\t\tconst skeleton = new Skeleton( initBones( mesh ) );\n\t\tmesh.bind( skeleton );\n\n\t\t// console.log( mesh ); // for console debug\n\n\t\treturn mesh;\n\n\t}\n\n}\n\n// TODO: Try to remove this function\n\nfunction initBones( mesh ) {\n\n\tconst geometry = mesh.geometry;\n\n\tconst bones = [];\n\n\tif ( geometry && geometry.bones !== undefined ) {\n\n\t\t// first, create array of 'Bone' objects from geometry data\n\n\t\tfor ( let i = 0, il = geometry.bones.length; i < il; i ++ ) {\n\n\t\t\tconst gbone = geometry.bones[ i ];\n\n\t\t\t// create new 'Bone' object\n\n\t\t\tconst bone = new Bone();\n\t\t\tbones.push( bone );\n\n\t\t\t// apply values\n\n\t\t\tbone.name = gbone.name;\n\t\t\tbone.position.fromArray( gbone.pos );\n\t\t\tbone.quaternion.fromArray( gbone.rotq );\n\t\t\tif ( gbone.scl !== undefined ) bone.scale.fromArray( gbone.scl );\n\n\t\t}\n\n\t\t// second, create bone hierarchy\n\n\t\tfor ( let i = 0, il = geometry.bones.length; i < il; i ++ ) {\n\n\t\t\tconst gbone = geometry.bones[ i ];\n\n\t\t\tif ( ( gbone.parent !== - 1 ) && ( gbone.parent !== null ) && ( bones[ gbone.parent ] !== undefined ) ) {\n\n\t\t\t\t// subsequent bones in the hierarchy\n\n\t\t\t\tbones[ gbone.parent ].add( bones[ i ] );\n\n\t\t\t} else {\n\n\t\t\t\t// topmost bone, immediate child of the skinned mesh\n\n\t\t\t\tmesh.add( bones[ i ] );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t// now the bones are part of the scene graph and children of the skinned mesh.\n\t// let's update the corresponding matrices\n\n\tmesh.updateMatrixWorld( true );\n\n\treturn bones;\n\n}\n\n//\n\nclass GeometryBuilder {\n\n\t/**\n\t * @param {Object} data - parsed PMD/PMX data\n\t * @return {BufferGeometry}\n\t */\n\tbuild( data ) {\n\n\t\t// for geometry\n\t\tconst positions = [];\n\t\tconst uvs = [];\n\t\tconst normals = [];\n\n\t\tconst indices = [];\n\n\t\tconst groups = [];\n\n\t\tconst bones = [];\n\t\tconst skinIndices = [];\n\t\tconst skinWeights = [];\n\n\t\tconst morphTargets = [];\n\t\tconst morphPositions = [];\n\n\t\tconst iks = [];\n\t\tconst grants = [];\n\n\t\tconst rigidBodies = [];\n\t\tconst constraints = [];\n\n\t\t// for work\n\t\tlet offset = 0;\n\t\tconst boneTypeTable = {};\n\n\t\t// positions, normals, uvs, skinIndices, skinWeights\n\n\t\tfor ( let i = 0; i < data.metadata.vertexCount; i ++ ) {\n\n\t\t\tconst v = data.vertices[ i ];\n\n\t\t\tfor ( let j = 0, jl = v.position.length; j < jl; j ++ ) {\n\n\t\t\t\tpositions.push( v.position[ j ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = v.normal.length; j < jl; j ++ ) {\n\n\t\t\t\tnormals.push( v.normal[ j ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0, jl = v.uv.length; j < jl; j ++ ) {\n\n\t\t\t\tuvs.push( v.uv[ j ] );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\n\n\t\t\t\tskinIndices.push( v.skinIndices.length - 1 >= j ? v.skinIndices[ j ] : 0.0 );\n\n\t\t\t}\n\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\n\n\t\t\t\tskinWeights.push( v.skinWeights.length - 1 >= j ? v.skinWeights[ j ] : 0.0 );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// indices\n\n\t\tfor ( let i = 0; i < data.metadata.faceCount; i ++ ) {\n\n\t\t\tconst face = data.faces[ i ];\n\n\t\t\tfor ( let j = 0, jl = face.indices.length; j < jl; j ++ ) {\n\n\t\t\t\tindices.push( face.indices[ j ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// groups\n\n\t\tfor ( let i = 0; i < data.metadata.materialCount; i ++ ) {\n\n\t\t\tconst material = data.materials[ i ];\n\n\t\t\tgroups.push( {\n\t\t\t\toffset: offset * 3,\n\t\t\t\tcount: material.faceCount * 3\n\t\t\t} );\n\n\t\t\toffset += material.faceCount;\n\n\t\t}\n\n\t\t// bones\n\n\t\tfor ( let i = 0; i < data.metadata.rigidBodyCount; i ++ ) {\n\n\t\t\tconst body = data.rigidBodies[ i ];\n\t\t\tlet value = boneTypeTable[ body.boneIndex ];\n\n\t\t\t// keeps greater number if already value is set without any special reasons\n\t\t\tvalue = value === undefined ? body.type : Math.max( body.type, value );\n\n\t\t\tboneTypeTable[ body.boneIndex ] = value;\n\n\t\t}\n\n\t\tfor ( let i = 0; i < data.metadata.boneCount; i ++ ) {\n\n\t\t\tconst boneData = data.bones[ i ];\n\n\t\t\tconst bone = {\n\t\t\t\tindex: i,\n\t\t\t\ttransformationClass: boneData.transformationClass,\n\t\t\t\tparent: boneData.parentIndex,\n\t\t\t\tname: boneData.name,\n\t\t\t\tpos: boneData.position.slice( 0, 3 ),\n\t\t\t\trotq: [ 0, 0, 0, 1 ],\n\t\t\t\tscl: [ 1, 1, 1 ],\n\t\t\t\trigidBodyType: boneTypeTable[ i ] !== undefined ? boneTypeTable[ i ] : - 1\n\t\t\t};\n\n\t\t\tif ( bone.parent !== - 1 ) {\n\n\t\t\t\tbone.pos[ 0 ] -= data.bones[ bone.parent ].position[ 0 ];\n\t\t\t\tbone.pos[ 1 ] -= data.bones[ bone.parent ].position[ 1 ];\n\t\t\t\tbone.pos[ 2 ] -= data.bones[ bone.parent ].position[ 2 ];\n\n\t\t\t}\n\n\t\t\tbones.push( bone );\n\n\t\t}\n\n\t\t// iks\n\n\t\t// TODO: remove duplicated codes between PMD and PMX\n\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\tfor ( let i = 0; i < data.metadata.ikCount; i ++ ) {\n\n\t\t\t\tconst ik = data.iks[ i ];\n\n\t\t\t\tconst param = {\n\t\t\t\t\ttarget: ik.target,\n\t\t\t\t\teffector: ik.effector,\n\t\t\t\t\titeration: ik.iteration,\n\t\t\t\t\tmaxAngle: ik.maxAngle * 4,\n\t\t\t\t\tlinks: []\n\t\t\t\t};\n\n\t\t\t\tfor ( let j = 0, jl = ik.links.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst link = {};\n\t\t\t\t\tlink.index = ik.links[ j ].index;\n\t\t\t\t\tlink.enabled = true;\n\n\t\t\t\t\tif ( data.bones[ link.index ].name.indexOf( 'ひざ' ) >= 0 ) {\n\n\t\t\t\t\t\tlink.limitation = new Vector3( 1.0, 0.0, 0.0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tparam.links.push( link );\n\n\t\t\t\t}\n\n\t\t\t\tiks.push( param );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tfor ( let i = 0; i < data.metadata.boneCount; i ++ ) {\n\n\t\t\t\tconst ik = data.bones[ i ].ik;\n\n\t\t\t\tif ( ik === undefined ) continue;\n\n\t\t\t\tconst param = {\n\t\t\t\t\ttarget: i,\n\t\t\t\t\teffector: ik.effector,\n\t\t\t\t\titeration: ik.iteration,\n\t\t\t\t\tmaxAngle: ik.maxAngle,\n\t\t\t\t\tlinks: []\n\t\t\t\t};\n\n\t\t\t\tfor ( let j = 0, jl = ik.links.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst link = {};\n\t\t\t\t\tlink.index = ik.links[ j ].index;\n\t\t\t\t\tlink.enabled = true;\n\n\t\t\t\t\tif ( ik.links[ j ].angleLimitation === 1 ) {\n\n\t\t\t\t\t\t// Revert if rotationMin/Max doesn't work well\n\t\t\t\t\t\t// link.limitation = new Vector3( 1.0, 0.0, 0.0 );\n\n\t\t\t\t\t\tconst rotationMin = ik.links[ j ].lowerLimitationAngle;\n\t\t\t\t\t\tconst rotationMax = ik.links[ j ].upperLimitationAngle;\n\n\t\t\t\t\t\t// Convert Left to Right coordinate by myself because\n\t\t\t\t\t\t// MMDParser doesn't convert. It's a MMDParser's bug\n\n\t\t\t\t\t\tconst tmp1 = - rotationMax[ 0 ];\n\t\t\t\t\t\tconst tmp2 = - rotationMax[ 1 ];\n\t\t\t\t\t\trotationMax[ 0 ] = - rotationMin[ 0 ];\n\t\t\t\t\t\trotationMax[ 1 ] = - rotationMin[ 1 ];\n\t\t\t\t\t\trotationMin[ 0 ] = tmp1;\n\t\t\t\t\t\trotationMin[ 1 ] = tmp2;\n\n\t\t\t\t\t\tlink.rotationMin = new Vector3().fromArray( rotationMin );\n\t\t\t\t\t\tlink.rotationMax = new Vector3().fromArray( rotationMax );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tparam.links.push( link );\n\n\t\t\t\t}\n\n\t\t\t\tiks.push( param );\n\n\t\t\t\t// Save the reference even from bone data for efficiently\n\t\t\t\t// simulating PMX animation system\n\t\t\t\tbones[ i ].ik = param;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// grants\n\n\t\tif ( data.metadata.format === 'pmx' ) {\n\n\t\t\t// bone index -> grant entry map\n\t\t\tconst grantEntryMap = {};\n\n\t\t\tfor ( let i = 0; i < data.metadata.boneCount; i ++ ) {\n\n\t\t\t\tconst boneData = data.bones[ i ];\n\t\t\t\tconst grant = boneData.grant;\n\n\t\t\t\tif ( grant === undefined ) continue;\n\n\t\t\t\tconst param = {\n\t\t\t\t\tindex: i,\n\t\t\t\t\tparentIndex: grant.parentIndex,\n\t\t\t\t\tratio: grant.ratio,\n\t\t\t\t\tisLocal: grant.isLocal,\n\t\t\t\t\taffectRotation: grant.affectRotation,\n\t\t\t\t\taffectPosition: grant.affectPosition,\n\t\t\t\t\ttransformationClass: boneData.transformationClass\n\t\t\t\t};\n\n\t\t\t\tgrantEntryMap[ i ] = { parent: null, children: [], param: param, visited: false };\n\n\t\t\t}\n\n\t\t\tconst rootEntry = { parent: null, children: [], param: null, visited: false };\n\n\t\t\t// Build a tree representing grant hierarchy\n\n\t\t\tfor ( const boneIndex in grantEntryMap ) {\n\n\t\t\t\tconst grantEntry = grantEntryMap[ boneIndex ];\n\t\t\t\tconst parentGrantEntry = grantEntryMap[ grantEntry.parentIndex ] || rootEntry;\n\n\t\t\t\tgrantEntry.parent = parentGrantEntry;\n\t\t\t\tparentGrantEntry.children.push( grantEntry );\n\n\t\t\t}\n\n\t\t\t// Sort grant parameters from parents to children because\n\t\t\t// grant uses parent's transform that parent's grant is already applied\n\t\t\t// so grant should be applied in order from parents to children\n\n\t\t\tfunction traverse( entry ) {\n\n\t\t\t\tif ( entry.param ) {\n\n\t\t\t\t\tgrants.push( entry.param );\n\n\t\t\t\t\t// Save the reference even from bone data for efficiently\n\t\t\t\t\t// simulating PMX animation system\n\t\t\t\t\tbones[ entry.param.index ].grant = entry.param;\n\n\t\t\t\t}\n\n\t\t\t\tentry.visited = true;\n\n\t\t\t\tfor ( let i = 0, il = entry.children.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst child = entry.children[ i ];\n\n\t\t\t\t\t// Cut off a loop if exists. (Is a grant loop invalid?)\n\t\t\t\t\tif ( ! child.visited ) traverse( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttraverse( rootEntry );\n\n\t\t}\n\n\t\t// morph\n\n\t\tfunction updateAttributes( attribute, morph, ratio ) {\n\n\t\t\tfor ( let i = 0; i < morph.elementCount; i ++ ) {\n\n\t\t\t\tconst element = morph.elements[ i ];\n\n\t\t\t\tlet index;\n\n\t\t\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\t\t\tindex = data.morphs[ 0 ].elements[ element.index ].index;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tindex = element.index;\n\n\t\t\t\t}\n\n\t\t\t\tattribute.array[ index * 3 + 0 ] += element.position[ 0 ] * ratio;\n\t\t\t\tattribute.array[ index * 3 + 1 ] += element.position[ 1 ] * ratio;\n\t\t\t\tattribute.array[ index * 3 + 2 ] += element.position[ 2 ] * ratio;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( let i = 0; i < data.metadata.morphCount; i ++ ) {\n\n\t\t\tconst morph = data.morphs[ i ];\n\t\t\tconst params = { name: morph.name };\n\n\t\t\tconst attribute = new Float32BufferAttribute( data.metadata.vertexCount * 3, 3 );\n\t\t\tattribute.name = morph.name;\n\n\t\t\tfor ( let j = 0; j < data.metadata.vertexCount * 3; j ++ ) {\n\n\t\t\t\tattribute.array[ j ] = positions[ j ];\n\n\t\t\t}\n\n\t\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\t\tif ( i !== 0 ) {\n\n\t\t\t\t\tupdateAttributes( attribute, morph, 1.0 );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tif ( morph.type === 0 ) { // group\n\n\t\t\t\t\tfor ( let j = 0; j < morph.elementCount; j ++ ) {\n\n\t\t\t\t\t\tconst morph2 = data.morphs[ morph.elements[ j ].index ];\n\t\t\t\t\t\tconst ratio = morph.elements[ j ].ratio;\n\n\t\t\t\t\t\tif ( morph2.type === 1 ) {\n\n\t\t\t\t\t\t\tupdateAttributes( attribute, morph2, ratio );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// TODO: implement\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( morph.type === 1 ) { // vertex\n\n\t\t\t\t\tupdateAttributes( attribute, morph, 1.0 );\n\n\t\t\t\t} else if ( morph.type === 2 ) { // bone\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 3 ) { // uv\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 4 ) { // additional uv1\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 5 ) { // additional uv2\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 6 ) { // additional uv3\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 7 ) { // additional uv4\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t} else if ( morph.type === 8 ) { // material\n\n\t\t\t\t\t// TODO: implement\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmorphTargets.push( params );\n\t\t\tmorphPositions.push( attribute );\n\n\t\t}\n\n\t\t// rigid bodies from rigidBodies field.\n\n\t\tfor ( let i = 0; i < data.metadata.rigidBodyCount; i ++ ) {\n\n\t\t\tconst rigidBody = data.rigidBodies[ i ];\n\t\t\tconst params = {};\n\n\t\t\tfor ( const key in rigidBody ) {\n\n\t\t\t\tparams[ key ] = rigidBody[ key ];\n\n\t\t\t}\n\n\t\t\t/*\n\t\t\t\t * RigidBody position parameter in PMX seems global position\n\t\t\t\t * while the one in PMD seems offset from corresponding bone.\n\t\t\t\t * So unify being offset.\n\t\t\t\t */\n\t\t\tif ( data.metadata.format === 'pmx' ) {\n\n\t\t\t\tif ( params.boneIndex !== - 1 ) {\n\n\t\t\t\t\tconst bone = data.bones[ params.boneIndex ];\n\t\t\t\t\tparams.position[ 0 ] -= bone.position[ 0 ];\n\t\t\t\t\tparams.position[ 1 ] -= bone.position[ 1 ];\n\t\t\t\t\tparams.position[ 2 ] -= bone.position[ 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\trigidBodies.push( params );\n\n\t\t}\n\n\t\t// constraints from constraints field.\n\n\t\tfor ( let i = 0; i < data.metadata.constraintCount; i ++ ) {\n\n\t\t\tconst constraint = data.constraints[ i ];\n\t\t\tconst params = {};\n\n\t\t\tfor ( const key in constraint ) {\n\n\t\t\t\tparams[ key ] = constraint[ key ];\n\n\t\t\t}\n\n\t\t\tconst bodyA = rigidBodies[ params.rigidBodyIndex1 ];\n\t\t\tconst bodyB = rigidBodies[ params.rigidBodyIndex2 ];\n\n\t\t\t// Refer to http://www20.atpages.jp/katwat/wp/?p=4135\n\t\t\tif ( bodyA.type !== 0 && bodyB.type === 2 ) {\n\n\t\t\t\tif ( bodyA.boneIndex !== - 1 && bodyB.boneIndex !== - 1 &&\n\t\t\t\t\t     data.bones[ bodyB.boneIndex ].parentIndex === bodyA.boneIndex ) {\n\n\t\t\t\t\tbodyB.type = 1;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconstraints.push( params );\n\n\t\t}\n\n\t\t// build BufferGeometry.\n\n\t\tconst geometry = new BufferGeometry();\n\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( positions, 3 ) );\n\t\tgeometry.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\t\tgeometry.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\n\t\tgeometry.setAttribute( 'skinIndex', new Uint16BufferAttribute( skinIndices, 4 ) );\n\t\tgeometry.setAttribute( 'skinWeight', new Float32BufferAttribute( skinWeights, 4 ) );\n\t\tgeometry.setIndex( indices );\n\n\t\tfor ( let i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\tgeometry.addGroup( groups[ i ].offset, groups[ i ].count, i );\n\n\t\t}\n\n\t\tgeometry.bones = bones;\n\n\t\tgeometry.morphTargets = morphTargets;\n\t\tgeometry.morphAttributes.position = morphPositions;\n\t\tgeometry.morphTargetsRelative = false;\n\n\t\tgeometry.userData.MMD = {\n\t\t\tbones: bones,\n\t\t\tiks: iks,\n\t\t\tgrants: grants,\n\t\t\trigidBodies: rigidBodies,\n\t\t\tconstraints: constraints,\n\t\t\tformat: data.metadata.format\n\t\t};\n\n\t\tgeometry.computeBoundingSphere();\n\n\t\treturn geometry;\n\n\t}\n\n}\n\n//\n\n/**\n * @param {THREE.LoadingManager} manager\n */\nclass MaterialBuilder {\n\n\tconstructor( manager ) {\n\n\t\tthis.manager = manager;\n\n\t\tthis.textureLoader = new TextureLoader( this.manager );\n\t\tthis.tgaLoader = null; // lazy generation\n\n\t\tthis.crossOrigin = 'anonymous';\n\t\tthis.resourcePath = undefined;\n\n\t}\n\n\t/**\n\t * @param {string} crossOrigin\n\t * @return {MaterialBuilder}\n\t */\n\tsetCrossOrigin( crossOrigin ) {\n\n\t\tthis.crossOrigin = crossOrigin;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * @param {string} resourcePath\n\t * @return {MaterialBuilder}\n\t */\n\tsetResourcePath( resourcePath ) {\n\n\t\tthis.resourcePath = resourcePath;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * @param {Object} data - parsed PMD/PMX data\n\t * @param {BufferGeometry} geometry - some properties are dependend on geometry\n\t * @param {function} onProgress\n\t * @param {function} onError\n\t * @return {Array<MeshToonMaterial>}\n\t */\n\tbuild( data, geometry /*, onProgress, onError */ ) {\n\n\t\tconst materials = [];\n\n\t\tconst textures = {};\n\n\t\tthis.textureLoader.setCrossOrigin( this.crossOrigin );\n\n\t\t// materials\n\n\t\tfor ( let i = 0; i < data.metadata.materialCount; i ++ ) {\n\n\t\t\tconst material = data.materials[ i ];\n\n\t\t\tconst params = { userData: {} };\n\n\t\t\tif ( material.name !== undefined ) params.name = material.name;\n\n\t\t\t/*\n\t\t\t\t * Color\n\t\t\t\t *\n\t\t\t\t * MMD         MeshToonMaterial\n\t\t\t\t * diffuse  -  color\n\t\t\t\t * ambient  -  emissive * a\n\t\t\t\t *               (a = 1.0 without map texture or 0.2 with map texture)\n\t\t\t\t *\n\t\t\t\t * MeshToonMaterial doesn't have ambient. Set it to emissive instead.\n\t\t\t\t * It'll be too bright if material has map texture so using coef 0.2.\n\t\t\t\t */\n\t\t\tparams.color = new Color().fromArray( material.diffuse );\n\t\t\tparams.opacity = material.diffuse[ 3 ];\n\t\t\tparams.emissive = new Color().fromArray( material.ambient );\n\t\t\tparams.transparent = params.opacity !== 1.0;\n\n\t\t\t//\n\n\t\t\tparams.skinning = geometry.bones.length > 0 ? true : false;\n\t\t\tparams.morphTargets = geometry.morphTargets.length > 0 ? true : false;\n\t\t\tparams.fog = true;\n\n\t\t\t// blend\n\n\t\t\tparams.blending = CustomBlending;\n\t\t\tparams.blendSrc = SrcAlphaFactor;\n\t\t\tparams.blendDst = OneMinusSrcAlphaFactor;\n\t\t\tparams.blendSrcAlpha = SrcAlphaFactor;\n\t\t\tparams.blendDstAlpha = DstAlphaFactor;\n\n\t\t\t// side\n\n\t\t\tif ( data.metadata.format === 'pmx' && ( material.flag & 0x1 ) === 1 ) {\n\n\t\t\t\tparams.side = DoubleSide;\n\n\t\t\t} else {\n\n\t\t\t\tparams.side = params.opacity === 1.0 ? FrontSide : DoubleSide;\n\n\t\t\t}\n\n\t\t\tif ( data.metadata.format === 'pmd' ) {\n\n\t\t\t\t// map, envMap\n\n\t\t\t\tif ( material.fileName ) {\n\n\t\t\t\t\tconst fileName = material.fileName;\n\t\t\t\t\tconst fileNames = fileName.split( '*' );\n\n\t\t\t\t\t// fileNames[ 0 ]: mapFileName\n\t\t\t\t\t// fileNames[ 1 ]: envMapFileName( optional )\n\n\t\t\t\t\tparams.map = this._loadTexture( fileNames[ 0 ], textures );\n\n\t\t\t\t\tif ( fileNames.length > 1 ) {\n\n\t\t\t\t\t\tconst extension = fileNames[ 1 ].slice( - 4 ).toLowerCase();\n\n\t\t\t\t\t\tparams.envMap = this._loadTexture(\n\t\t\t\t\t\t\tfileNames[ 1 ],\n\t\t\t\t\t\t\ttextures\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tparams.combine = extension === '.sph'\n\t\t\t\t\t\t\t? MultiplyOperation\n\t\t\t\t\t\t\t: AddOperation;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// gradientMap\n\n\t\t\t\tconst toonFileName = ( material.toonIndex === - 1 )\n\t\t\t\t\t? 'toon00.bmp'\n\t\t\t\t\t: data.toonTextures[ material.toonIndex ].fileName;\n\n\t\t\t\tparams.gradientMap = this._loadTexture(\n\t\t\t\t\ttoonFileName,\n\t\t\t\t\ttextures,\n\t\t\t\t\t{\n\t\t\t\t\t\tisToonTexture: true,\n\t\t\t\t\t\tisDefaultToonTexture: this._isDefaultToonTexture( toonFileName )\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\t// parameters for OutlineEffect\n\n\t\t\t\tparams.userData.outlineParameters = {\n\t\t\t\t\tthickness: material.edgeFlag === 1 ? 0.003 : 0.0,\n\t\t\t\t\tcolor: [ 0, 0, 0 ],\n\t\t\t\t\talpha: 1.0,\n\t\t\t\t\tvisible: material.edgeFlag === 1\n\t\t\t\t};\n\n\t\t\t} else {\n\n\t\t\t\t// map\n\n\t\t\t\tif ( material.textureIndex !== - 1 ) {\n\n\t\t\t\t\tparams.map = this._loadTexture( data.textures[ material.textureIndex ], textures );\n\n\t\t\t\t}\n\n\t\t\t\t// envMap TODO: support m.envFlag === 3\n\n\t\t\t\tif ( material.envTextureIndex !== - 1 && ( material.envFlag === 1 || material.envFlag == 2 ) ) {\n\n\t\t\t\t\tparams.envMap = this._loadTexture(\n\t\t\t\t\t\tdata.textures[ material.envTextureIndex ],\n\t\t\t\t\t\ttextures\n\t\t\t\t\t);\n\n\t\t\t\t\tparams.combine = material.envFlag === 1\n\t\t\t\t\t\t? MultiplyOperation\n\t\t\t\t\t\t: AddOperation;\n\n\t\t\t\t}\n\n\t\t\t\t// gradientMap\n\n\t\t\t\tlet toonFileName, isDefaultToon;\n\n\t\t\t\tif ( material.toonIndex === - 1 || material.toonFlag !== 0 ) {\n\n\t\t\t\t\ttoonFileName = 'toon' + ( '0' + ( material.toonIndex + 1 ) ).slice( - 2 ) + '.bmp';\n\t\t\t\t\tisDefaultToon = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttoonFileName = data.textures[ material.toonIndex ];\n\t\t\t\t\tisDefaultToon = false;\n\n\t\t\t\t}\n\n\t\t\t\tparams.gradientMap = this._loadTexture(\n\t\t\t\t\ttoonFileName,\n\t\t\t\t\ttextures,\n\t\t\t\t\t{\n\t\t\t\t\t\tisToonTexture: true,\n\t\t\t\t\t\tisDefaultToonTexture: isDefaultToon\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\t// parameters for OutlineEffect\n\t\t\t\tparams.userData.outlineParameters = {\n\t\t\t\t\tthickness: material.edgeSize / 300, // TODO: better calculation?\n\t\t\t\t\tcolor: material.edgeColor.slice( 0, 3 ),\n\t\t\t\t\talpha: material.edgeColor[ 3 ],\n\t\t\t\t\tvisible: ( material.flag & 0x10 ) !== 0 && material.edgeSize > 0.0\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\tif ( params.map !== undefined ) {\n\n\t\t\t\tif ( ! params.transparent ) {\n\n\t\t\t\t\tthis._checkImageTransparency( params.map, geometry, i );\n\n\t\t\t\t}\n\n\t\t\t\tparams.emissive.multiplyScalar( 0.2 );\n\n\t\t\t}\n\n\t\t\tmaterials.push( new MeshToonMaterial( params ) );\n\n\t\t}\n\n\t\tif ( data.metadata.format === 'pmx' ) {\n\n\t\t\t// set transparent true if alpha morph is defined.\n\n\t\t\tfunction checkAlphaMorph( elements, materials ) {\n\n\t\t\t\tfor ( let i = 0, il = elements.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst element = elements[ i ];\n\n\t\t\t\t\tif ( element.index === - 1 ) continue;\n\n\t\t\t\t\tconst material = materials[ element.index ];\n\n\t\t\t\t\tif ( material.opacity !== element.diffuse[ 3 ] ) {\n\n\t\t\t\t\t\tmaterial.transparent = true;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = data.morphs.length; i < il; i ++ ) {\n\n\t\t\t\tconst morph = data.morphs[ i ];\n\t\t\t\tconst elements = morph.elements;\n\n\t\t\t\tif ( morph.type === 0 ) {\n\n\t\t\t\t\tfor ( let j = 0, jl = elements.length; j < jl; j ++ ) {\n\n\t\t\t\t\t\tconst morph2 = data.morphs[ elements[ j ].index ];\n\n\t\t\t\t\t\tif ( morph2.type !== 8 ) continue;\n\n\t\t\t\t\t\tcheckAlphaMorph( morph2.elements, materials );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( morph.type === 8 ) {\n\n\t\t\t\t\tcheckAlphaMorph( elements, materials );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn materials;\n\n\t}\n\n\t// private methods\n\n\t_getTGALoader() {\n\n\t\tif ( this.tgaLoader === null ) {\n\n\t\t\tif ( TGALoader === undefined ) {\n\n\t\t\t\tthrow new Error( 'THREE.MMDLoader: Import TGALoader' );\n\n\t\t\t}\n\n\t\t\tthis.tgaLoader = new TGALoader( this.manager );\n\n\t\t}\n\n\t\treturn this.tgaLoader;\n\n\t}\n\n\t_isDefaultToonTexture( name ) {\n\n\t\tif ( name.length !== 10 ) return false;\n\n\t\treturn /toon(10|0[0-9])\\.bmp/.test( name );\n\n\t}\n\n\t_loadTexture( filePath, textures, params, onProgress, onError ) {\n\n\t\tparams = params || {};\n\n\t\tconst scope = this;\n\n\t\tlet fullPath;\n\n\t\tif ( params.isDefaultToonTexture === true ) {\n\n\t\t\tlet index;\n\n\t\t\ttry {\n\n\t\t\t\tindex = parseInt( filePath.match( /toon([0-9]{2})\\.bmp$/ )[ 1 ] );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tconsole.warn( 'THREE.MMDLoader: ' + filePath + ' seems like a '\n\t\t\t\t\t\t+ 'not right default texture path. Using toon00.bmp instead.' );\n\n\t\t\t\tindex = 0;\n\n\t\t\t}\n\n\t\t\tfullPath = DEFAULT_TOON_TEXTURES[ index ];\n\n\t\t} else {\n\n\t\t\tfullPath = this.resourcePath + filePath;\n\n\t\t}\n\n\t\tif ( textures[ fullPath ] !== undefined ) return textures[ fullPath ];\n\n\t\tlet loader = this.manager.getHandler( fullPath );\n\n\t\tif ( loader === null ) {\n\n\t\t\tloader = ( filePath.slice( - 4 ).toLowerCase() === '.tga' )\n\t\t\t\t? this._getTGALoader()\n\t\t\t\t: this.textureLoader;\n\n\t\t}\n\n\t\tconst texture = loader.load( fullPath, function ( t ) {\n\n\t\t\t// MMD toon texture is Axis-Y oriented\n\t\t\t// but Three.js gradient map is Axis-X oriented.\n\t\t\t// So here replaces the toon texture image with the rotated one.\n\t\t\tif ( params.isToonTexture === true ) {\n\n\t\t\t\tt.image = scope._getRotatedImage( t.image );\n\n\t\t\t\tt.magFilter = NearestFilter;\n\t\t\t\tt.minFilter = NearestFilter;\n\n\t\t\t}\n\n\t\t\tt.flipY = false;\n\t\t\tt.wrapS = RepeatWrapping;\n\t\t\tt.wrapT = RepeatWrapping;\n\n\t\t\tfor ( let i = 0; i < texture.readyCallbacks.length; i ++ ) {\n\n\t\t\t\ttexture.readyCallbacks[ i ]( texture );\n\n\t\t\t}\n\n\t\t\tdelete texture.readyCallbacks;\n\n\t\t}, onProgress, onError );\n\n\t\ttexture.readyCallbacks = [];\n\n\t\ttextures[ fullPath ] = texture;\n\n\t\treturn texture;\n\n\t}\n\n\t_getRotatedImage( image ) {\n\n\t\tconst canvas = document.createElement( 'canvas' );\n\t\tconst context = canvas.getContext( '2d' );\n\n\t\tconst width = image.width;\n\t\tconst height = image.height;\n\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\n\t\tcontext.clearRect( 0, 0, width, height );\n\t\tcontext.translate( width / 2.0, height / 2.0 );\n\t\tcontext.rotate( 0.5 * Math.PI ); // 90.0 * Math.PI / 180.0\n\t\tcontext.translate( - width / 2.0, - height / 2.0 );\n\t\tcontext.drawImage( image, 0, 0 );\n\n\t\treturn context.getImageData( 0, 0, width, height );\n\n\t}\n\n\t// Check if the partial image area used by the texture is transparent.\n\t_checkImageTransparency( map, geometry, groupIndex ) {\n\n\t\tmap.readyCallbacks.push( function ( texture ) {\n\n\t\t\t// Is there any efficient ways?\n\t\t\tfunction createImageData( image ) {\n\n\t\t\t\tconst canvas = document.createElement( 'canvas' );\n\t\t\t\tcanvas.width = image.width;\n\t\t\t\tcanvas.height = image.height;\n\n\t\t\t\tconst context = canvas.getContext( '2d' );\n\t\t\t\tcontext.drawImage( image, 0, 0 );\n\n\t\t\t\treturn context.getImageData( 0, 0, canvas.width, canvas.height );\n\n\t\t\t}\n\n\t\t\tfunction detectImageTransparency( image, uvs, indices ) {\n\n\t\t\t\tconst width = image.width;\n\t\t\t\tconst height = image.height;\n\t\t\t\tconst data = image.data;\n\t\t\t\tconst threshold = 253;\n\n\t\t\t\tif ( data.length / ( width * height ) !== 4 ) return false;\n\n\t\t\t\tfor ( let i = 0; i < indices.length; i += 3 ) {\n\n\t\t\t\t\tconst centerUV = { x: 0.0, y: 0.0 };\n\n\t\t\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\t\t\tconst index = indices[ i * 3 + j ];\n\t\t\t\t\t\tconst uv = { x: uvs[ index * 2 + 0 ], y: uvs[ index * 2 + 1 ] };\n\n\t\t\t\t\t\tif ( getAlphaByUv( image, uv ) < threshold ) return true;\n\n\t\t\t\t\t\tcenterUV.x += uv.x;\n\t\t\t\t\t\tcenterUV.y += uv.y;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tcenterUV.x /= 3;\n\t\t\t\t\tcenterUV.y /= 3;\n\n\t\t\t\t\tif ( getAlphaByUv( image, centerUV ) < threshold ) return true;\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t\t/*\n\t\t\t\t * This method expects\n\t\t\t\t *   texture.flipY = false\n\t\t\t\t *   texture.wrapS = RepeatWrapping\n\t\t\t\t *   texture.wrapT = RepeatWrapping\n\t\t\t\t * TODO: more precise\n\t\t\t\t */\n\t\t\tfunction getAlphaByUv( image, uv ) {\n\n\t\t\t\tconst width = image.width;\n\t\t\t\tconst height = image.height;\n\n\t\t\t\tlet x = Math.round( uv.x * width ) % width;\n\t\t\t\tlet y = Math.round( uv.y * height ) % height;\n\n\t\t\t\tif ( x < 0 ) x += width;\n\t\t\t\tif ( y < 0 ) y += height;\n\n\t\t\t\tconst index = y * width + x;\n\n\t\t\t\treturn image.data[ index * 4 + 3 ];\n\n\t\t\t}\n\n\t\t\tconst imageData = texture.image.data !== undefined\n\t\t\t\t? texture.image\n\t\t\t\t: createImageData( texture.image );\n\n\t\t\tconst group = geometry.groups[ groupIndex ];\n\n\t\t\tif ( detectImageTransparency(\n\t\t\t\timageData,\n\t\t\t\tgeometry.attributes.uv.array,\n\t\t\t\tgeometry.index.array.slice( group.start, group.start + group.count ) ) ) {\n\n\t\t\t\tmap.transparent = true;\n\n\t\t\t}\n\n\t\t} );\n\n\t}\n\n}\n\n//\n\nclass AnimationBuilder {\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n\t * @return {AnimationClip}\n\t */\n\tbuild( vmd, mesh ) {\n\n\t\t// combine skeletal and morph animations\n\n\t\tconst tracks = this.buildSkeletalAnimation( vmd, mesh ).tracks;\n\t\tconst tracks2 = this.buildMorphAnimation( vmd, mesh ).tracks;\n\n\t\tfor ( let i = 0, il = tracks2.length; i < il; i ++ ) {\n\n\t\t\ttracks.push( tracks2[ i ] );\n\n\t\t}\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n\t * @return {AnimationClip}\n\t */\n\tbuildSkeletalAnimation( vmd, mesh ) {\n\n\t\tfunction pushInterpolation( array, interpolation, index ) {\n\n\t\t\tarray.push( interpolation[ index + 0 ] / 127 ); // x1\n\t\t\tarray.push( interpolation[ index + 8 ] / 127 ); // x2\n\t\t\tarray.push( interpolation[ index + 4 ] / 127 ); // y1\n\t\t\tarray.push( interpolation[ index + 12 ] / 127 ); // y2\n\n\t\t}\n\n\t\tconst tracks = [];\n\n\t\tconst motions = {};\n\t\tconst bones = mesh.skeleton.bones;\n\t\tconst boneNameDictionary = {};\n\n\t\tfor ( let i = 0, il = bones.length; i < il; i ++ ) {\n\n\t\t\tboneNameDictionary[ bones[ i ].name ] = true;\n\n\t\t}\n\n\t\tfor ( let i = 0; i < vmd.metadata.motionCount; i ++ ) {\n\n\t\t\tconst motion = vmd.motions[ i ];\n\t\t\tconst boneName = motion.boneName;\n\n\t\t\tif ( boneNameDictionary[ boneName ] === undefined ) continue;\n\n\t\t\tmotions[ boneName ] = motions[ boneName ] || [];\n\t\t\tmotions[ boneName ].push( motion );\n\n\t\t}\n\n\t\tfor ( const key in motions ) {\n\n\t\t\tconst array = motions[ key ];\n\n\t\t\tarray.sort( function ( a, b ) {\n\n\t\t\t\treturn a.frameNum - b.frameNum;\n\n\t\t\t} );\n\n\t\t\tconst times = [];\n\t\t\tconst positions = [];\n\t\t\tconst rotations = [];\n\t\t\tconst pInterpolations = [];\n\t\t\tconst rInterpolations = [];\n\n\t\t\tconst basePosition = mesh.skeleton.getBoneByName( key ).position.toArray();\n\n\t\t\tfor ( let i = 0, il = array.length; i < il; i ++ ) {\n\n\t\t\t\tconst time = array[ i ].frameNum / 30;\n\t\t\t\tconst position = array[ i ].position;\n\t\t\t\tconst rotation = array[ i ].rotation;\n\t\t\t\tconst interpolation = array[ i ].interpolation;\n\n\t\t\t\ttimes.push( time );\n\n\t\t\t\tfor ( let j = 0; j < 3; j ++ ) positions.push( basePosition[ j ] + position[ j ] );\n\t\t\t\tfor ( let j = 0; j < 4; j ++ ) rotations.push( rotation[ j ] );\n\t\t\t\tfor ( let j = 0; j < 3; j ++ ) pushInterpolation( pInterpolations, interpolation, j );\n\n\t\t\t\tpushInterpolation( rInterpolations, interpolation, 3 );\n\n\t\t\t}\n\n\t\t\tconst targetName = '.bones[' + key + ']';\n\n\t\t\ttracks.push( this._createTrack( targetName + '.position', VectorKeyframeTrack, times, positions, pInterpolations ) );\n\t\t\ttracks.push( this._createTrack( targetName + '.quaternion', QuaternionKeyframeTrack, times, rotations, rInterpolations ) );\n\n\t\t}\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @param {SkinnedMesh} mesh - tracks will be fitting to mesh\n\t * @return {AnimationClip}\n\t */\n\tbuildMorphAnimation( vmd, mesh ) {\n\n\t\tconst tracks = [];\n\n\t\tconst morphs = {};\n\t\tconst morphTargetDictionary = mesh.morphTargetDictionary;\n\n\t\tfor ( let i = 0; i < vmd.metadata.morphCount; i ++ ) {\n\n\t\t\tconst morph = vmd.morphs[ i ];\n\t\t\tconst morphName = morph.morphName;\n\n\t\t\tif ( morphTargetDictionary[ morphName ] === undefined ) continue;\n\n\t\t\tmorphs[ morphName ] = morphs[ morphName ] || [];\n\t\t\tmorphs[ morphName ].push( morph );\n\n\t\t}\n\n\t\tfor ( const key in morphs ) {\n\n\t\t\tconst array = morphs[ key ];\n\n\t\t\tarray.sort( function ( a, b ) {\n\n\t\t\t\treturn a.frameNum - b.frameNum;\n\n\t\t\t} );\n\n\t\t\tconst times = [];\n\t\t\tconst values = [];\n\n\t\t\tfor ( let i = 0, il = array.length; i < il; i ++ ) {\n\n\t\t\t\ttimes.push( array[ i ].frameNum / 30 );\n\t\t\t\tvalues.push( array[ i ].weight );\n\n\t\t\t}\n\n\t\t\ttracks.push( new NumberKeyframeTrack( '.morphTargetInfluences[' + morphTargetDictionary[ key ] + ']', times, values ) );\n\n\t\t}\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t/**\n\t * @param {Object} vmd - parsed VMD data\n\t * @return {AnimationClip}\n\t */\n\tbuildCameraAnimation( vmd ) {\n\n\t\tfunction pushVector3( array, vec ) {\n\n\t\t\tarray.push( vec.x );\n\t\t\tarray.push( vec.y );\n\t\t\tarray.push( vec.z );\n\n\t\t}\n\n\t\tfunction pushQuaternion( array, q ) {\n\n\t\t\tarray.push( q.x );\n\t\t\tarray.push( q.y );\n\t\t\tarray.push( q.z );\n\t\t\tarray.push( q.w );\n\n\t\t}\n\n\t\tfunction pushInterpolation( array, interpolation, index ) {\n\n\t\t\tarray.push( interpolation[ index * 4 + 0 ] / 127 ); // x1\n\t\t\tarray.push( interpolation[ index * 4 + 1 ] / 127 ); // x2\n\t\t\tarray.push( interpolation[ index * 4 + 2 ] / 127 ); // y1\n\t\t\tarray.push( interpolation[ index * 4 + 3 ] / 127 ); // y2\n\n\t\t}\n\n\t\tconst cameras = vmd.cameras === undefined ? [] : vmd.cameras.slice();\n\n\t\tcameras.sort( function ( a, b ) {\n\n\t\t\treturn a.frameNum - b.frameNum;\n\n\t\t} );\n\n\t\tconst times = [];\n\t\tconst centers = [];\n\t\tconst quaternions = [];\n\t\tconst positions = [];\n\t\tconst fovs = [];\n\n\t\tconst cInterpolations = [];\n\t\tconst qInterpolations = [];\n\t\tconst pInterpolations = [];\n\t\tconst fInterpolations = [];\n\n\t\tconst quaternion = new Quaternion();\n\t\tconst euler = new Euler();\n\t\tconst position = new Vector3();\n\t\tconst center = new Vector3();\n\n\t\tfor ( let i = 0, il = cameras.length; i < il; i ++ ) {\n\n\t\t\tconst motion = cameras[ i ];\n\n\t\t\tconst time = motion.frameNum / 30;\n\t\t\tconst pos = motion.position;\n\t\t\tconst rot = motion.rotation;\n\t\t\tconst distance = motion.distance;\n\t\t\tconst fov = motion.fov;\n\t\t\tconst interpolation = motion.interpolation;\n\n\t\t\ttimes.push( time );\n\n\t\t\tposition.set( 0, 0, - distance );\n\t\t\tcenter.set( pos[ 0 ], pos[ 1 ], pos[ 2 ] );\n\n\t\t\teuler.set( - rot[ 0 ], - rot[ 1 ], - rot[ 2 ] );\n\t\t\tquaternion.setFromEuler( euler );\n\n\t\t\tposition.add( center );\n\t\t\tposition.applyQuaternion( quaternion );\n\n\t\t\tpushVector3( centers, center );\n\t\t\tpushQuaternion( quaternions, quaternion );\n\t\t\tpushVector3( positions, position );\n\n\t\t\tfovs.push( fov );\n\n\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\tpushInterpolation( cInterpolations, interpolation, j );\n\n\t\t\t}\n\n\t\t\tpushInterpolation( qInterpolations, interpolation, 3 );\n\n\t\t\t// use the same parameter for x, y, z axis.\n\t\t\tfor ( let j = 0; j < 3; j ++ ) {\n\n\t\t\t\tpushInterpolation( pInterpolations, interpolation, 4 );\n\n\t\t\t}\n\n\t\t\tpushInterpolation( fInterpolations, interpolation, 5 );\n\n\t\t}\n\n\t\tconst tracks = [];\n\n\t\t// I expect an object whose name 'target' exists under THREE.Camera\n\t\ttracks.push( this._createTrack( 'target.position', VectorKeyframeTrack, times, centers, cInterpolations ) );\n\n\t\ttracks.push( this._createTrack( '.quaternion', QuaternionKeyframeTrack, times, quaternions, qInterpolations ) );\n\t\ttracks.push( this._createTrack( '.position', VectorKeyframeTrack, times, positions, pInterpolations ) );\n\t\ttracks.push( this._createTrack( '.fov', NumberKeyframeTrack, times, fovs, fInterpolations ) );\n\n\t\treturn new AnimationClip( '', - 1, tracks );\n\n\t}\n\n\t// private method\n\n\t_createTrack( node, typedKeyframeTrack, times, values, interpolations ) {\n\n\t\t/*\n\t\t\t * optimizes here not to let KeyframeTrackPrototype optimize\n\t\t\t * because KeyframeTrackPrototype optimizes times and values but\n\t\t\t * doesn't optimize interpolations.\n\t\t\t */\n\t\tif ( times.length > 2 ) {\n\n\t\t\ttimes = times.slice();\n\t\t\tvalues = values.slice();\n\t\t\tinterpolations = interpolations.slice();\n\n\t\t\tconst stride = values.length / times.length;\n\t\t\tconst interpolateStride = interpolations.length / times.length;\n\n\t\t\tlet index = 1;\n\n\t\t\tfor ( let aheadIndex = 2, endIndex = times.length; aheadIndex < endIndex; aheadIndex ++ ) {\n\n\t\t\t\tfor ( let i = 0; i < stride; i ++ ) {\n\n\t\t\t\t\tif ( values[ index * stride + i ] !== values[ ( index - 1 ) * stride + i ] ||\n\t\t\t\t\t\t\tvalues[ index * stride + i ] !== values[ aheadIndex * stride + i ] ) {\n\n\t\t\t\t\t\tindex ++;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( aheadIndex > index ) {\n\n\t\t\t\t\ttimes[ index ] = times[ aheadIndex ];\n\n\t\t\t\t\tfor ( let i = 0; i < stride; i ++ ) {\n\n\t\t\t\t\t\tvalues[ index * stride + i ] = values[ aheadIndex * stride + i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( let i = 0; i < interpolateStride; i ++ ) {\n\n\t\t\t\t\t\tinterpolations[ index * interpolateStride + i ] = interpolations[ aheadIndex * interpolateStride + i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttimes.length = index + 1;\n\t\t\tvalues.length = ( index + 1 ) * stride;\n\t\t\tinterpolations.length = ( index + 1 ) * interpolateStride;\n\n\t\t}\n\n\t\tconst track = new typedKeyframeTrack( node, times, values );\n\n\t\ttrack.createInterpolant = function InterpolantFactoryMethodCubicBezier( result ) {\n\n\t\t\treturn new CubicBezierInterpolation( this.times, this.values, this.getValueSize(), result, new Float32Array( interpolations ) );\n\n\t\t};\n\n\t\treturn track;\n\n\t}\n\n}\n\n// interpolation\n\nclass CubicBezierInterpolation extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer, params ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t\tthis.interpolationParams = params;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\t\tconst params = this.interpolationParams;\n\n\t\tconst offset1 = i1 * stride;\n\t\tconst offset0 = offset1 - stride;\n\n\t\t// No interpolation if next key frame is in one frame in 30fps.\n\t\t// This is from MMD animation spec.\n\t\t// '1.5' is for precision loss. times are Float32 in Three.js Animation system.\n\t\tconst weight1 = ( ( t1 - t0 ) < 1 / 30 * 1.5 ) ? 0.0 : ( t - t0 ) / ( t1 - t0 );\n\n\t\tif ( stride === 4 ) { // Quaternion\n\n\t\t\tconst x1 = params[ i1 * 4 + 0 ];\n\t\t\tconst x2 = params[ i1 * 4 + 1 ];\n\t\t\tconst y1 = params[ i1 * 4 + 2 ];\n\t\t\tconst y2 = params[ i1 * 4 + 3 ];\n\n\t\t\tconst ratio = this._calculate( x1, x2, y1, y2, weight1 );\n\n\t\t\tQuaternion.slerpFlat( result, 0, values, offset0, values, offset1, ratio );\n\n\t\t} else if ( stride === 3 ) { // Vector3\n\n\t\t\tfor ( let i = 0; i !== stride; ++ i ) {\n\n\t\t\t\tconst x1 = params[ i1 * 12 + i * 4 + 0 ];\n\t\t\t\tconst x2 = params[ i1 * 12 + i * 4 + 1 ];\n\t\t\t\tconst y1 = params[ i1 * 12 + i * 4 + 2 ];\n\t\t\t\tconst y2 = params[ i1 * 12 + i * 4 + 3 ];\n\n\t\t\t\tconst ratio = this._calculate( x1, x2, y1, y2, weight1 );\n\n\t\t\t\tresult[ i ] = values[ offset0 + i ] * ( 1 - ratio ) + values[ offset1 + i ] * ratio;\n\n\t\t\t}\n\n\t\t} else { // Number\n\n\t\t\tconst x1 = params[ i1 * 4 + 0 ];\n\t\t\tconst x2 = params[ i1 * 4 + 1 ];\n\t\t\tconst y1 = params[ i1 * 4 + 2 ];\n\t\t\tconst y2 = params[ i1 * 4 + 3 ];\n\n\t\t\tconst ratio = this._calculate( x1, x2, y1, y2, weight1 );\n\n\t\t\tresult[ 0 ] = values[ offset0 ] * ( 1 - ratio ) + values[ offset1 ] * ratio;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\t_calculate( x1, x2, y1, y2, x ) {\n\n\t\t/*\n\t\t\t * Cubic Bezier curves\n\t\t\t *   https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B.C3.A9zier_curves\n\t\t\t *\n\t\t\t * B(t) = ( 1 - t ) ^ 3 * P0\n\t\t\t *      + 3 * ( 1 - t ) ^ 2 * t * P1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * P2\n\t\t\t *      + t ^ 3 * P3\n\t\t\t *      ( 0 <= t <= 1 )\n\t\t\t *\n\t\t\t * MMD uses Cubic Bezier curves for bone and camera animation interpolation.\n\t\t\t *   http://d.hatena.ne.jp/edvakf/20111016/1318716097\n\t\t\t *\n\t\t\t *    x = ( 1 - t ) ^ 3 * x0\n\t\t\t *      + 3 * ( 1 - t ) ^ 2 * t * x1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * x2\n\t\t\t *      + t ^ 3 * x3\n\t\t\t *    y = ( 1 - t ) ^ 3 * y0\n\t\t\t *      + 3 * ( 1 - t ) ^ 2 * t * y1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * y2\n\t\t\t *      + t ^ 3 * y3\n\t\t\t *      ( x0 = 0, y0 = 0 )\n\t\t\t *      ( x3 = 1, y3 = 1 )\n\t\t\t *      ( 0 <= t, x1, x2, y1, y2 <= 1 )\n\t\t\t *\n\t\t\t * Here solves this equation with Bisection method,\n\t\t\t *   https://en.wikipedia.org/wiki/Bisection_method\n\t\t\t * gets t, and then calculate y.\n\t\t\t *\n\t\t\t * f(t) = 3 * ( 1 - t ) ^ 2 * t * x1\n\t\t\t *      + 3 * ( 1 - t ) * t^2 * x2\n\t\t\t *      + t ^ 3 - x = 0\n\t\t\t *\n\t\t\t * (Another option: Newton's method\n\t\t\t *    https://en.wikipedia.org/wiki/Newton%27s_method)\n\t\t\t */\n\n\t\tlet c = 0.5;\n\t\tlet t = c;\n\t\tlet s = 1.0 - t;\n\t\tconst loop = 15;\n\t\tconst eps = 1e-5;\n\t\tconst math = Math;\n\n\t\tlet sst3, stt3, ttt;\n\n\t\tfor ( let i = 0; i < loop; i ++ ) {\n\n\t\t\tsst3 = 3.0 * s * s * t;\n\t\t\tstt3 = 3.0 * s * t * t;\n\t\t\tttt = t * t * t;\n\n\t\t\tconst ft = ( sst3 * x1 ) + ( stt3 * x2 ) + ( ttt ) - x;\n\n\t\t\tif ( math.abs( ft ) < eps ) break;\n\n\t\t\tc /= 2.0;\n\n\t\t\tt += ( ft < 0 ) ? c : - c;\n\t\t\ts = 1.0 - t;\n\n\t\t}\n\n\t\treturn ( sst3 * y1 ) + ( stt3 * y2 ) + ttt;\n\n\t}\n\n}\n\nexport { MMDLoader };\n","import {\n\tCompressedTextureLoader,\n\tRGBAFormat,\n\tRGBA_S3TC_DXT3_Format,\n\tRGBA_S3TC_DXT5_Format,\n\tRGB_ETC1_Format,\n\tRGB_S3TC_DXT1_Format\n} from 'three';\n\nclass DDSLoader extends CompressedTextureLoader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tparse( buffer, loadMipmaps ) {\n\n\t\tconst dds = { mipmaps: [], width: 0, height: 0, format: null, mipmapCount: 1 };\n\n\t\t// Adapted from @toji's DDS utils\n\t\t// https://github.com/toji/webgl-texture-utils/blob/master/texture-util/dds.js\n\n\t\t// All values and structures referenced from:\n\t\t// http://msdn.microsoft.com/en-us/library/bb943991.aspx/\n\n\t\tconst DDS_MAGIC = 0x20534444;\n\n\t\t// let DDSD_CAPS = 0x1;\n\t\t// let DDSD_HEIGHT = 0x2;\n\t\t// let DDSD_WIDTH = 0x4;\n\t\t// let DDSD_PITCH = 0x8;\n\t\t// let DDSD_PIXELFORMAT = 0x1000;\n\t\tconst DDSD_MIPMAPCOUNT = 0x20000;\n\t\t// let DDSD_LINEARSIZE = 0x80000;\n\t\t// let DDSD_DEPTH = 0x800000;\n\n\t\t// let DDSCAPS_COMPLEX = 0x8;\n\t\t// let DDSCAPS_MIPMAP = 0x400000;\n\t\t// let DDSCAPS_TEXTURE = 0x1000;\n\n\t\tconst DDSCAPS2_CUBEMAP = 0x200;\n\t\tconst DDSCAPS2_CUBEMAP_POSITIVEX = 0x400;\n\t\tconst DDSCAPS2_CUBEMAP_NEGATIVEX = 0x800;\n\t\tconst DDSCAPS2_CUBEMAP_POSITIVEY = 0x1000;\n\t\tconst DDSCAPS2_CUBEMAP_NEGATIVEY = 0x2000;\n\t\tconst DDSCAPS2_CUBEMAP_POSITIVEZ = 0x4000;\n\t\tconst DDSCAPS2_CUBEMAP_NEGATIVEZ = 0x8000;\n\t\t// let DDSCAPS2_VOLUME = 0x200000;\n\n\t\t// let DDPF_ALPHAPIXELS = 0x1;\n\t\t// let DDPF_ALPHA = 0x2;\n\t\tconst DDPF_FOURCC = 0x4;\n\t\t// let DDPF_RGB = 0x40;\n\t\t// let DDPF_YUV = 0x200;\n\t\t// let DDPF_LUMINANCE = 0x20000;\n\n\t\tfunction fourCCToInt32( value ) {\n\n\t\t\treturn value.charCodeAt( 0 ) +\n\t\t\t\t( value.charCodeAt( 1 ) << 8 ) +\n\t\t\t\t( value.charCodeAt( 2 ) << 16 ) +\n\t\t\t\t( value.charCodeAt( 3 ) << 24 );\n\n\t\t}\n\n\t\tfunction int32ToFourCC( value ) {\n\n\t\t\treturn String.fromCharCode(\n\t\t\t\tvalue & 0xff,\n\t\t\t\t( value >> 8 ) & 0xff,\n\t\t\t\t( value >> 16 ) & 0xff,\n\t\t\t\t( value >> 24 ) & 0xff\n\t\t\t);\n\n\t\t}\n\n\t\tfunction loadARGBMip( buffer, dataOffset, width, height ) {\n\n\t\t\tconst dataLength = width * height * 4;\n\t\t\tconst srcBuffer = new Uint8Array( buffer, dataOffset, dataLength );\n\t\t\tconst byteArray = new Uint8Array( dataLength );\n\t\t\tlet dst = 0;\n\t\t\tlet src = 0;\n\t\t\tfor ( let y = 0; y < height; y ++ ) {\n\n\t\t\t\tfor ( let x = 0; x < width; x ++ ) {\n\n\t\t\t\t\tconst b = srcBuffer[ src ]; src ++;\n\t\t\t\t\tconst g = srcBuffer[ src ]; src ++;\n\t\t\t\t\tconst r = srcBuffer[ src ]; src ++;\n\t\t\t\t\tconst a = srcBuffer[ src ]; src ++;\n\t\t\t\t\tbyteArray[ dst ] = r; dst ++;\t//r\n\t\t\t\t\tbyteArray[ dst ] = g; dst ++;\t//g\n\t\t\t\t\tbyteArray[ dst ] = b; dst ++;\t//b\n\t\t\t\t\tbyteArray[ dst ] = a; dst ++;\t//a\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn byteArray;\n\n\t\t}\n\n\t\tconst FOURCC_DXT1 = fourCCToInt32( 'DXT1' );\n\t\tconst FOURCC_DXT3 = fourCCToInt32( 'DXT3' );\n\t\tconst FOURCC_DXT5 = fourCCToInt32( 'DXT5' );\n\t\tconst FOURCC_ETC1 = fourCCToInt32( 'ETC1' );\n\n\t\tconst headerLengthInt = 31; // The header length in 32 bit ints\n\n\t\t// Offsets into the header array\n\n\t\tconst off_magic = 0;\n\n\t\tconst off_size = 1;\n\t\tconst off_flags = 2;\n\t\tconst off_height = 3;\n\t\tconst off_width = 4;\n\n\t\tconst off_mipmapCount = 7;\n\n\t\tconst off_pfFlags = 20;\n\t\tconst off_pfFourCC = 21;\n\t\tconst off_RGBBitCount = 22;\n\t\tconst off_RBitMask = 23;\n\t\tconst off_GBitMask = 24;\n\t\tconst off_BBitMask = 25;\n\t\tconst off_ABitMask = 26;\n\n\t\t// let off_caps = 27;\n\t\tconst off_caps2 = 28;\n\t\t// let off_caps3 = 29;\n\t\t// let off_caps4 = 30;\n\n\t\t// Parse header\n\n\t\tconst header = new Int32Array( buffer, 0, headerLengthInt );\n\n\t\tif ( header[ off_magic ] !== DDS_MAGIC ) {\n\n\t\t\tconsole.error( 'THREE.DDSLoader.parse: Invalid magic number in DDS header.' );\n\t\t\treturn dds;\n\n\t\t}\n\n\t\tif ( ! header[ off_pfFlags ] & DDPF_FOURCC ) {\n\n\t\t\tconsole.error( 'THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code.' );\n\t\t\treturn dds;\n\n\t\t}\n\n\t\tlet blockBytes;\n\n\t\tconst fourCC = header[ off_pfFourCC ];\n\n\t\tlet isRGBAUncompressed = false;\n\n\t\tswitch ( fourCC ) {\n\n\t\t\tcase FOURCC_DXT1:\n\n\t\t\t\tblockBytes = 8;\n\t\t\t\tdds.format = RGB_S3TC_DXT1_Format;\n\t\t\t\tbreak;\n\n\t\t\tcase FOURCC_DXT3:\n\n\t\t\t\tblockBytes = 16;\n\t\t\t\tdds.format = RGBA_S3TC_DXT3_Format;\n\t\t\t\tbreak;\n\n\t\t\tcase FOURCC_DXT5:\n\n\t\t\t\tblockBytes = 16;\n\t\t\t\tdds.format = RGBA_S3TC_DXT5_Format;\n\t\t\t\tbreak;\n\n\t\t\tcase FOURCC_ETC1:\n\n\t\t\t\tblockBytes = 8;\n\t\t\t\tdds.format = RGB_ETC1_Format;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif ( header[ off_RGBBitCount ] === 32\n\t\t\t\t\t&& header[ off_RBitMask ] & 0xff0000\n\t\t\t\t\t&& header[ off_GBitMask ] & 0xff00\n\t\t\t\t\t&& header[ off_BBitMask ] & 0xff\n\t\t\t\t\t&& header[ off_ABitMask ] & 0xff000000 ) {\n\n\t\t\t\t\tisRGBAUncompressed = true;\n\t\t\t\t\tblockBytes = 64;\n\t\t\t\t\tdds.format = RGBAFormat;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'THREE.DDSLoader.parse: Unsupported FourCC code ', int32ToFourCC( fourCC ) );\n\t\t\t\t\treturn dds;\n\n\t\t\t\t}\n\n\t\t}\n\n\t\tdds.mipmapCount = 1;\n\n\t\tif ( header[ off_flags ] & DDSD_MIPMAPCOUNT && loadMipmaps !== false ) {\n\n\t\t\tdds.mipmapCount = Math.max( 1, header[ off_mipmapCount ] );\n\n\t\t}\n\n\t\tconst caps2 = header[ off_caps2 ];\n\t\tdds.isCubemap = caps2 & DDSCAPS2_CUBEMAP ? true : false;\n\t\tif ( dds.isCubemap && (\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_POSITIVEX ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_NEGATIVEX ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_POSITIVEY ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_NEGATIVEY ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_POSITIVEZ ) ||\n\t\t\t! ( caps2 & DDSCAPS2_CUBEMAP_NEGATIVEZ )\n\t\t) ) {\n\n\t\t\tconsole.error( 'THREE.DDSLoader.parse: Incomplete cubemap faces' );\n\t\t\treturn dds;\n\n\t\t}\n\n\t\tdds.width = header[ off_width ];\n\t\tdds.height = header[ off_height ];\n\n\t\tlet dataOffset = header[ off_size ] + 4;\n\n\t\t// Extract mipmaps buffers\n\n\t\tconst faces = dds.isCubemap ? 6 : 1;\n\n\t\tfor ( let face = 0; face < faces; face ++ ) {\n\n\t\t\tlet width = dds.width;\n\t\t\tlet height = dds.height;\n\n\t\t\tfor ( let i = 0; i < dds.mipmapCount; i ++ ) {\n\n\t\t\t\tlet byteArray, dataLength;\n\n\t\t\t\tif ( isRGBAUncompressed ) {\n\n\t\t\t\t\tbyteArray = loadARGBMip( buffer, dataOffset, width, height );\n\t\t\t\t\tdataLength = byteArray.length;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tdataLength = Math.max( 4, width ) / 4 * Math.max( 4, height ) / 4 * blockBytes;\n\t\t\t\t\tbyteArray = new Uint8Array( buffer, dataOffset, dataLength );\n\n\t\t\t\t}\n\n\t\t\t\tconst mipmap = { 'data': byteArray, 'width': width, 'height': height };\n\t\t\t\tdds.mipmaps.push( mipmap );\n\n\t\t\t\tdataOffset += dataLength;\n\n\t\t\t\twidth = Math.max( width >> 1, 1 );\n\t\t\t\theight = Math.max( height >> 1, 1 );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn dds;\n\n\t}\n\n}\n\nexport { DDSLoader };\n","// isWebAssemblySupported.js\n// https://stackoverflow.com/a/47880734/2605764\n\nconst isWebAssemblySupported = (() => {\n  try {\n    if (\n      typeof WebAssembly === 'object' &&\n      typeof WebAssembly.instantiate === 'function'\n    ) {\n      const module = new WebAssembly.Module(\n        Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00)\n      );\n      if (module instanceof WebAssembly.Module)\n        return new WebAssembly.Instance(module) instanceof WebAssembly.Instance;\n    }\n    // eslint-disable-next-line no-empty\n  } catch (e) {}\n  return false;\n})();\n\nexport default isWebAssemblySupported;\n","// loadScriptTag.js\n'use strict';\n\nconst nullFunction = () => null;\n\n/**\n * Load <script> tag. Same id tag will only load once.\n * @param {object} arguments - props will copy to script tag.\n * @param {string} {id} - unique script tag id.\n * @param {function} {onError} - onError function.\n * @param {function} {onLoad} - onLoad function.\n * @returns {Promise} resolved after script loaded.\n */\nconst loadScriptTag = ({\n  id,\n  async,\n  type = 'text/javascript',\n  onError = nullFunction,\n  onLoad = nullFunction,\n  ...rest\n}) =>\n  new Promise((resolve, reject) => {\n    let scriptElement = document.getElementById(id);\n\n    const isScriptMounted = !!scriptElement;\n\n    if (!scriptElement) {\n      scriptElement = document.createElement('script');\n      Object.keys(rest).forEach(key => (scriptElement[key] = rest[key]));\n      scriptElement.id = id;\n      scriptElement.async = true;\n      scriptElement.type = type;\n    }\n\n    const isScriptLoaded = scriptElement.isLoaded;\n    if (isScriptLoaded) {\n      if (scriptElement.isErrored) {\n        const error = new Error('<script>.isErrored is true.');\n        onError({ error });\n        return reject({ error });\n      }\n      onLoad({ event, element: scriptElement });\n      return resolve({ event, element: scriptElement });\n    }\n\n    scriptElement.addEventListener('error', error => {\n      scriptElement.isLoaded = true;\n      scriptElement.isErrored = true;\n      onError({ error });\n      return reject({ error });\n    });\n\n    if (rest.src) {\n      scriptElement.addEventListener('load', event => {\n        scriptElement.isLoaded = true;\n        onLoad({ event, element: scriptElement });\n        return resolve({ event, element: scriptElement });\n      });\n    }\n\n    if (!isScriptMounted) {\n      document.getElementsByTagName('head')[0].appendChild(scriptElement);\n    }\n\n    if (!rest.src) {\n      scriptElement.isLoaded = true;\n      onLoad({ element: scriptElement });\n      return resolve({ element: scriptElement });\n    }\n  });\n\nexport default loadScriptTag;\n","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/Horkeukamui-160.a7373f24.pmx\";","// horkeukamuiVariables.js\n\nimport Horkeukamui160Model from '../../model/Horkeukamui/Horkeukamui-160.pmx';\nimport Horkeukamui185Model from '../../model/Horkeukamui/Horkeukamui-185.pmx';\nimport '../../model/Horkeukamui/tex/body_N.png';\nimport '../../model/Horkeukamui/tex/body.dds';\nimport '../../model/Horkeukamui/tex/body2_N.png';\nimport '../../model/Horkeukamui/tex/body2.dds';\nimport '../../model/Horkeukamui/tex/cloth_N.png';\nimport '../../model/Horkeukamui/tex/cloth.dds';\nimport '../../model/Horkeukamui/tex/cloth2.dds';\nimport '../../model/Horkeukamui/tex/cloth3.dds';\nimport '../../model/Horkeukamui/tex/cloth4.dds';\nimport '../../model/Horkeukamui/tex/cloth23_N.png';\nimport '../../model/Horkeukamui/tex/head.dds';\nimport '../../model/Horkeukamui/tex/nose.dds';\nimport '../../model/Horkeukamui/tex/Penis.dds';\nimport '../../model/Horkeukamui/tex/toon.dds';\n\nexport const Horkeukamui160 = Horkeukamui160Model;\nexport const Horkeukamui185 = Horkeukamui185Model;\n\nexport const englishMap = {\n  pubicHair: '丁毛',\n  fundoshiBack: '屁股兜',\n  fundoshiFront: '肚兜',\n  bigFundoshiFront: '大丁丁肚兜',\n  penis: '小丁丁',\n  bigPenis: '大丁丁',\n};\n","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/Horkeukamui-185.240b9f31.pmx\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body2_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/body2.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth2.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth3.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth4.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/cloth23_N.png\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/head.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/nose.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/Penis.dds\";","export default __webpack_public_path__ + \"src/client/model/Horkeukamui/tex/toon.dds\";","export default __webpack_public_path__ + \"src/client/motion/wavefile_v2.745b642f.vmd\";","// Main.jsx\nimport React from 'react';\nimport styled from 'styled-components';\nimport throttle from 'lodash/throttle';\nimport * as dat from 'dat.gui';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { MMDLoader } from 'three/examples/jsm/loaders/MMDLoader.js';\nimport { DDSLoader } from 'three/examples/jsm/loaders/DDSLoader.js';\nimport { MMDAnimationHelper } from 'three/examples/jsm/animation/MMDAnimationHelper.js';\nimport {\n  Scene,\n  WebGLRenderer,\n  PerspectiveCamera,\n  AxesHelper,\n  DirectionalLight,\n  DirectionalLightHelper,\n  LoadingManager,\n  Clock,\n  // ReinhardToneMapping,\n  PCFSoftShadowMap,\n  CameraHelper,\n} from 'three';\n\nimport isWebAssemblySupported from '../resource/isWebAssemblySupported.js';\nimport loadScriptTag from '../resource/loadScriptTag.js';\n\nimport {\n  Horkeukamui160 as Horkeukamui,\n  englishMap,\n} from '../resource/horkeukamuiVariables.js';\nimport WaveMotion from '../../motion/wavefile_v2.vmd';\n\nconst loadingManager = new LoadingManager();\nloadingManager.addHandler(/\\.dds$/i, new DDSLoader());\nconst mmdLoader = new MMDLoader(loadingManager);\nconst initControlKeys = [\n  'fundoshiBack',\n  'fundoshiFront',\n  'penis',\n  'bigFundoshiFront',\n  'bigPenis',\n];\nconst lightControlsConfigs = {\n  intensity: { min: 0, max: 5, step: 0.001 },\n  shadowIntensity: { min: 0, max: 1, step: 0.001 },\n  shadowBoundry: { min: 0, max: 10, step: 0.01 },\n  needShadowHelper: {},\n  positionX: { min: -5, max: 5, step: 0.01 },\n  positionY: { min: -5, max: 5, step: 0.01 },\n  positionZ: { min: -5, max: 5, step: 0.01 },\n};\n\nexport class Main extends React.PureComponent {\n  canvas = React.createRef();\n  gui = null;\n  camera = null;\n  cameraControls = null;\n  scene = null;\n  light = null;\n  lightWithShadow = null;\n  renderer = null;\n  rendererControlFolder = null;\n  clock = null;\n  loadingTimeout = null;\n  animationFrame = null;\n  animationControls = {\n    shouldAnimate: false,\n    fps: 60, // todo\n  };\n  animationToogleUI = null;\n  horkeukamui = null;\n  mmdPhysics = null;\n  mmdAnimationHelper = new MMDAnimationHelper({ afterglow: 2.0 });\n  controlObject = {\n    light: {\n      intensity: 2,\n      shadowIntensity: 0.5,\n      shadowBoundry: 4,\n      needShadowHelper: false,\n      positionX: -3,\n      positionY: 4,\n      positionZ: 2,\n    },\n    horkeukamui: {\n      fundoshiBack: true,\n      fundoshiFront: true,\n      penis: true,\n      bigFundoshiFront: false,\n      bigPenis: false,\n      erection: 0,\n    },\n  };\n  controlUIObject = {\n    Light: null,\n    light: {},\n    Horkeukamui: null,\n    HorkeukamuiMorphs: null,\n    horkeukamui: {\n      morphs: {},\n    },\n  };\n\n  updateLights = () => {\n    const {\n      intensity,\n      shadowIntensity,\n      shadowBoundry,\n      needShadowHelper,\n      positionX,\n      positionY,\n      positionZ,\n    } = this.controlObject.light;\n    this.light.intensity = intensity * (1 - shadowIntensity);\n    this.light.position.set(positionX, positionY, positionZ);\n    this.lightHelper.update();\n\n    this.lightWithShadow.intensity = intensity * shadowIntensity;\n    this.lightWithShadow.position.set(positionX, positionY, positionZ);\n    this.lightWithShadow.castShadow = !!shadowIntensity;\n    this.shadowHelper.visible = needShadowHelper && !!shadowIntensity;\n\n    const camera = this.lightWithShadow.shadow.camera;\n    camera.left = -shadowBoundry;\n    camera.right = shadowBoundry;\n    camera.top = shadowBoundry;\n    camera.bottom = -shadowBoundry;\n    camera.updateProjectionMatrix();\n    this.shadowHelper.update();\n    window.requestAnimationFrame(this.renderNextFrame);\n  };\n\n  initScene = () => {\n    this.scene = new Scene();\n    this.scene.add(new AxesHelper(1));\n\n    const light = new DirectionalLight('#ffffff', 2);\n    light.castShadow = false;\n    this.light = light;\n\n    // need to set position before setup light helper.\n    // otherwise the light plane position will off.\n    const { positionX, positionY, positionZ } = this.controlObject.light;\n    this.light.position.set(positionX, positionY, positionZ);\n    this.lightHelper = new DirectionalLightHelper(light, 1);\n\n    const lightWithShadow = light.clone();\n    lightWithShadow.shadow.camera.far = 7;\n    lightWithShadow.shadow.mapSize.set(1024, 1024);\n    lightWithShadow.shadow.normalBias = 0.05;\n    this.lightWithShadow = lightWithShadow;\n    this.shadowHelper = new CameraHelper(lightWithShadow.shadow.camera);\n\n    this.scene.add(light);\n    this.scene.add(this.lightHelper);\n    this.scene.add(lightWithShadow);\n    this.scene.add(this.shadowHelper);\n\n    this.controlUIObject.Light = this.gui.addFolder('Light');\n    const lightControl = this.controlObject.light;\n    const lightControlUI = this.controlUIObject.Light;\n    Object.keys(lightControlsConfigs).forEach(configKey => {\n      const config = lightControlsConfigs[configKey];\n      this.controlUIObject.light[configKey] = lightControlUI.add(\n        lightControl,\n        configKey\n      );\n      if (config.step) {\n        this.controlUIObject.light[configKey] = this.controlUIObject.light[\n          configKey\n        ]\n          .min(config.min)\n          .max(config.max)\n          .step(config.step);\n      }\n      this.controlUIObject.light[configKey] = this.controlUIObject.light[\n        configKey\n      ].onChange(this.updateLights);\n    });\n  };\n\n  initRenderer = () => {\n    const renderer = new WebGLRenderer({\n      canvas: this.canvas.current,\n      antialias: true,\n    });\n    this.renderer = renderer;\n    renderer.physicallyCorrectLights = true;\n    // renderer.toneMapping = ReinhardToneMapping;\n    renderer.toneMappingExposure = 1;\n    renderer.shadowMap.enabled = true;\n    renderer.shadowMap.type = PCFSoftShadowMap;\n    renderer.setClearColor(0x222f3e);\n    this.rendererControlFolder = this.gui.addFolder('Renderer');\n    this.rendererControlFolder.add(this.renderer, 'physicallyCorrectLights');\n    this.rendererControlFolder\n      .add(this.renderer, 'toneMappingExposure')\n      .min(0)\n      .max(5)\n      .step(0.01);\n    this.rendererControlFolder\n      .add(this.renderer.shadowMap, 'enabled')\n      .name('shadowMapEnabled');\n    this.initCamera();\n    this.handleWindowResize();\n  };\n\n  renderNextFrame = () => {\n    this.renderer.render(this.scene, this.camera);\n  };\n\n  tick = () => {\n    this.cameraControls.update();\n    this.mmdAnimationHelper.update(this.clock.getDelta());\n    this.renderNextFrame();\n    if (this.animationControls.shouldAnimate) {\n      this.animationFrame = window.requestAnimationFrame(this.tick);\n    }\n  };\n\n  initCamera = () => {\n    const canvas = this.canvas.current;\n    const width = canvas.clientWidth;\n    const height = canvas.clientHeight;\n\n    this.camera = new PerspectiveCamera(75, width / height, 0.1, 100);\n    this.camera.position.set(1, 2, 3);\n\n    this.cameraControls = new OrbitControls(this.camera, canvas);\n    this.cameraControls.target.set(0, 2, 0);\n    this.cameraControls.update();\n    this.cameraControls.addEventListener('change', () => {\n      if (!this.animationControls.shouldAnimate) {\n        this.renderNextFrame();\n      }\n    });\n  };\n\n  handleWindowResize = throttle(() => {\n    if (!this.canvas.current) {\n      return;\n    }\n    const canvas = this.canvas.current;\n    const renderer = this.renderer;\n    const width = canvas.clientWidth;\n    const height = canvas.clientHeight;\n    renderer.setSize(width, height);\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n\n    this.camera.aspect = width / height;\n    this.camera.updateProjectionMatrix();\n    if (!this.animationControls.shouldAnimate) {\n      this.renderNextFrame();\n    }\n  }, 100);\n\n  getMaterial = ({ name }) => {\n    return this.horkeukamui.material.find(m => name === m.name);\n  };\n\n  addKamuiControlllers = () => {\n    this.controlUIObject.Horkeukamui = this.gui.addFolder('Horkeukamui');\n    const kamuiControl = this.controlUIObject.Horkeukamui;\n    this.controlUIObject.horkeukamui.fundoshiBack = kamuiControl\n      .add(this.controlObject.horkeukamui, 'fundoshiBack')\n      .onChange(() => {\n        const material = this.getMaterial({ name: englishMap.fundoshiBack });\n        const visible = this.controlObject.horkeukamui.fundoshiBack;\n        material.visible = visible;\n        material.opacity = +visible;\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.horkeukamui.fundoshiFront = kamuiControl\n      .add(this.controlObject.horkeukamui, 'fundoshiFront')\n      .onChange(() => {\n        const material = this.getMaterial({ name: englishMap.fundoshiFront });\n        const visible = this.controlObject.horkeukamui.fundoshiFront;\n        material.visible = visible;\n        material.opacity = +visible;\n        this.horkeukamui.morphTargetInfluences[77] = 0.2 * +visible;\n        if (visible && this.controlObject.horkeukamui.bigFundoshiFront) {\n          this.controlUIObject.horkeukamui.bigFundoshiFront.setValue(false);\n        }\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.horkeukamui.bigFundoshiFront = kamuiControl\n      .add(this.controlObject.horkeukamui, 'bigFundoshiFront')\n      .onChange(() => {\n        const material = this.getMaterial({\n          name: englishMap.bigFundoshiFront,\n        });\n        const visible = this.controlObject.horkeukamui.bigFundoshiFront;\n        material.visible = visible;\n        material.opacity = +visible;\n        if (visible && this.controlObject.horkeukamui.fundoshiFront) {\n          this.controlUIObject.horkeukamui.fundoshiFront.setValue(false);\n        }\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.horkeukamui.bigPenis = kamuiControl\n      .add(this.controlObject.horkeukamui, 'bigPenis')\n      .onChange(() => {\n        const penisMaterial = this.getMaterial({ name: englishMap.penis });\n        const bigPenisMaterial = this.getMaterial({\n          name: englishMap.bigPenis,\n        });\n        const isBigOne = this.controlObject.horkeukamui.bigPenis;\n        penisMaterial.visible = !isBigOne;\n        penisMaterial.opacity = +!isBigOne;\n        bigPenisMaterial.visible = isBigOne;\n        bigPenisMaterial.opacity = +isBigOne;\n        window.requestAnimationFrame(this.renderNextFrame);\n      });\n    this.controlUIObject.HorkeukamuiMorphs =\n      this.controlUIObject.Horkeukamui.addFolder('Morphs');\n    Object.keys(this.horkeukamui.morphTargetDictionary).forEach(targetKey => {\n      this.controlUIObject.horkeukamui.morphs[targetKey] =\n        this.controlUIObject.HorkeukamuiMorphs.add(\n          this.horkeukamui.morphTargetInfluences,\n          this.horkeukamui.morphTargetDictionary[targetKey]\n        )\n          .min(0)\n          .max(1)\n          .step(0.01)\n          .name(targetKey)\n          .onChange(() => window.requestAnimationFrame(this.renderNextFrame));\n    });\n  };\n\n  loadModels = () => {\n    mmdLoader.loadWithAnimation(\n      Horkeukamui,\n      [WaveMotion],\n      ({ mesh, animation }) => {\n        mesh.scale.set(0.2, 0.2, 0.2);\n        mesh.position.set(0, 0, 0);\n        mesh.receiveShadow = true;\n        mesh.castShadow = true;\n        this.scene.add(mesh);\n        window.Horkeukamui = mesh;\n        this.horkeukamui = mesh;\n\n        // prevent penis penetrate fundoshiFront.\n        mesh.morphTargetInfluences[77] = 0.2;\n\n        const penisHair = this.getMaterial({ name: englishMap.pubicHair });\n        penisHair.visible = true;\n        penisHair.opacity = 1;\n\n        initControlKeys.forEach(controlKey => {\n          const needDisplay = this.controlObject.horkeukamui[controlKey];\n          const material = this.getMaterial({ name: englishMap[controlKey] });\n          material.visible = needDisplay;\n          material.opacity = +needDisplay;\n        });\n\n        this.addKamuiControlllers();\n\n        this.mmdAnimationHelper.add(mesh, { animation, physics: true });\n        this.mmdAnimationHelper.enable('animation', false);\n\n        this.loadingTimeout = window.setTimeout(this.renderNextFrame, 500);\n      }\n    );\n  };\n\n  async componentDidMount() {\n    const loadAmmoPromise = loadScriptTag({\n      id: 'ammo-js',\n      src: isWebAssemblySupported\n        ? 'library/ammo/ammo.99d0ec0.wasm.js'\n        : 'library/ammo/ammo.99d0ec0.js',\n    });\n    this.gui = new dat.GUI({ hideable: true, closed: false, closeOnTop: true });\n    this.clock = new Clock();\n    this.initScene();\n    this.initRenderer();\n    this.updateLights();\n    this.animationToogleUI = this.gui\n      .add(this.animationControls, 'shouldAnimate')\n      .onChange(() => {\n        if (this.animationControls.shouldAnimate) {\n          this.mmdAnimationHelper.enable('animation', true);\n          this.clock.start();\n          this.tick();\n        } else {\n          this.clock.stop();\n          this.mmdAnimationHelper.enable('animation', false);\n        }\n      });\n    window.addEventListener('resize', this.handleWindowResize);\n    await loadAmmoPromise;\n    // Need to init ammo.js async.\n    // https://github.com/mrdoob/three.js/pull/16100\n    const AmmoLib = await window.Ammo();\n    window.Ammo = AmmoLib;\n    this.loadModels();\n  }\n\n  componentWillUnmount() {\n    if (this.gui) {\n      this.gui.destory();\n    }\n    window.cancelAnimationFrame(this.animationFrame);\n    window.removeEventListener('resize', this.handleWindowResize);\n    window.clearTimeout(this.loadingTimeout);\n  }\n\n  render() {\n    return (\n      <StyledMain>\n        <Canvas ref={this.canvas} />\n      </StyledMain>\n    );\n  }\n}\n\nconst StyledMain = styled.div`\n  flex: auto;\n`;\n\nconst Canvas = styled.canvas`\n  width: 100%;\n  height: 100%;\n  background-color: #222f3e;\n`;\n\nexport default Main;\n","export default __webpack_public_path__ + \"img/github-icon.e1201fcc.svg\";","// Footer.jsx\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nimport EmailIcon from '../../img/email-icon.svg';\nimport GithubIcon from '../../img/github-icon.svg';\n\nconst githubBaseUrl = 'https://github.com/bill42362/portfolio';\n\nexport class Footer extends React.PureComponent {\n  render() {\n    const { email, branchName } = this.props;\n    const githubUrl = branchName\n      ? `${githubBaseUrl}/tree/${branchName}`\n      : githubBaseUrl;\n    return (\n      <StyledFooter>\n        <Link href={githubUrl} target=\"_blank\">\n          <img src={GithubIcon} alt=\"github\" />\n        </Link>\n        <Link href={`mailto:${email}`} target=\"_blank\">\n          <img src={EmailIcon} alt=\"email\" />\n        </Link>\n      </StyledFooter>\n    );\n  }\n}\n\nFooter.propTypes = {\n  email: PropTypes.string,\n  branchName: PropTypes.string,\n};\n\nFooter.defaultProps = {\n  email: 'bill42362@gmail.com',\n  branchName: '',\n};\n\nconst StyledFooter = styled.div`\n  flex: none;\n  display: flex;\n  justify-content: center;\n  align-items: flex-end;\n  padding: 20px;\n`;\n\nconst Link = styled.a`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  background-color: #576574;\n\n  & + & {\n    margin-left: 8px;\n  }\n  img {\n    width: 60%;\n    height: auto;\n  }\n`;\n\nexport default Footer;\n","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDY3LDYxSDQ1QzIwLjIxOCw2MSwwLDgxLjE5NiwwLDEwNnYzMDBjMCwyNC43MiwyMC4xMjgsNDUsNDUsNDVoNDIyYzI0LjcyLDAsNDUtMjAuMTI4LDQ1LTQ1VjEwNiBDNTEyLDgxLjI4LDQ5MS44NzIsNjEsNDY3LDYxeiBNNDYwLjc4Niw5MUwyNTYuOTU0LDI5NC44MzNMNTEuMzU5LDkxSDQ2MC43ODZ6IE0zMCwzOTkuNzg4VjExMi4wNjlsMTQ0LjQ3OSwxNDMuMjRMMzAsMzk5Ljc4OHogTTUxLjIxMyw0MjFsMTQ0LjU3LTE0NC41N2w1MC42NTcsNTAuMjIyYzUuODY0LDUuODE0LDE1LjMyNyw1Ljc5NSwyMS4xNjctMC4wNDZMMzE3LDI3Ny4yMTNMNDYwLjc4Nyw0MjFINTEuMjEzeiBNNDgyLDM5OS43ODcgTDMzOC4yMTMsMjU2TDQ4MiwxMTIuMjEyVjM5OS43ODd6Ii8+PC9zdmc+\"","// index.js\n'use strict';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './component/App.jsx';\n\nReactDOM.render(<App />, document.getElementById('app-root'));\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n"],"sourceRoot":""}