{"version":3,"sources":["webpack:///./src/client/js/resource/getFaceMeshTransform.js","webpack:///./src/client/js/resource/LinearAlgebra.js","webpack:///./src/client/js/component/App.jsx","webpack:///./src/client/js/resource/faceLandmarkVariables.js","webpack:///./src/client/img/x-men-school.svg","webpack:///./src/client/js/resource/MovingLeastSquare.js","webpack:///./src/client/img/rihanna.png","webpack:///./src/client/js/component/Main.jsx","webpack:///./src/client/img/github-icon.svg","webpack:///./src/client/js/component/Footer.jsx","webpack:///./src/client/img/email-icon.svg","webpack:///./src/client/js/index.js"],"names":["getEyeRadiuses","dotPositions","eyeCenters","getEyeCenters","leftEye","faceLandmarksIndex","rightEye","leftEyeVector","getPointsVector","origin","left","target","lower","outer","rightEyeVector","right","getVectorLength","vector","leftEyeCenter","averageTwoDots","upper","inner","cheekIndexs","cheek","noseCenterIndexs","nose","center","cheekSizeIndexPairs","edgePointsMesh","positions","textCoords","colors","a","b","addTwoVectors","Math","sqrt","aDotB2D","averageTwoDots2D","getPointsVector2D","getVectorLength2D","moveFromPoint","from","to","ratio","direction","GlobalStyle","createGlobalStyle","styledNormalize","isServer","window","title","description","branchName","process","env","BRANCH_NAME","__SSR_ENVIRONMENT__","App","request","console","log","defaultTitle","titleTemplate","charSet","name","content","property","StyledApp","src","XMenLogoSource","propTypes","PropTypes","object","defaultProps","styled","div","Body","sheet","props","instance","shrinkFactor","faceLandmarkConfig","shouldLoadIrisModel","maxContinuousChecks","maxFaces","iouThreshold","predictIrises","middle","chin","edgeAnchorPointPairs","getMovingLeastSquareMesh","pointPairs","stripCount","alpha","lineCount","step","points","Array","fill","map","_","index","xIndex","yIndex","floor","textCoord","weights","pow","weightsSum","reduce","cur","w","pStar","p","qStar","normalVector","normalDistance","pHats","qHats","As","pHat","minusPHatOrth","minusNormalVectorOrth","fvVector","qHat","A","fvLength","newTextCoord","position","elementIndexes","forEach","point","includes","push","flatMap","renderWorkerFileName","faceDetectionWorkerFileName","captureContraints","audio","video","width","height","facingMode","Main","state","canvasHeight","canvas","React","createRef","canvasContext","nextTick","workers","render","faceDetection","morphFaceDetection","captureObjects","lastTime","Date","now","mediaStream","videoTrack","imageCapture","lastImageBitmap","detectObjects","lastDetectedImageBitmap","faceData","faceRenderData","deformObjects","deformData","morphObjects","targetImage","Image","targetImageBitmap","faceRenderBaseData","detectFaceBaseData","controlObject","capturing","shouldCapture","fps","facingUser","detecting","shouldDetect","needFaceDots","deforming","shouldDeformEyes","eyesSize","shouldDeformCheeks","useMlsCheekDeforming","cheekSize","morphing","shouldMorph","shouldLockBaseFase","controlUIObject","gui","Capturing","Detecting","Deforming","Morphing","initDatGui","dat","hideable","closed","closeOnTop","control","ui","addFolder","add","onChange","startCapturing","stopCapturing","min","max","startDetecting","handleDetectConfigChange","handleDeformConfigChange","startMorphing","handleMorphConfigChange","initRendererWorker","offscreenCanvas","current","transferControlToOffscreen","Worker","type","postMessage","payload","sizes","animation","requestAnimationFrame","capture","captureInterval","captureElapsed","captureImage","detect","detectInterval","detectElapsed","detectFace","handleWindowResize","throttle","clientWidth","setState","makeFaceRenderData","faceMeshs","config","updateFrame","updateDeformData","updateMorphRenderData","imageBitmap","morphData","objects","navigator","mediaDevices","getUserMedia","getVideoTracks","ImageCapture","getTracks","t","stop","grabFrame","close","result","array","numComponents","faceMesh","dots","addEventListener","faceDetectionWorkerMessageHandler","data","newFps","detectDuration","setValue","isNewFaceMeshes","makeDeformData","length","circularDeforms","eyeRadiuses","leftEyeDeform","radius","rightEyeDeform","dotTextCoords","cheekDeforms","pair","meshData","vectorRatio","movingLeastSquarePointPairs","concat","movingLeastSquareMesh","handleMorphFaceWorkerMessage","morphRenderBaseData","makeMorphRenderBaseData","morphFaceMeshs","createImageBitmap","makeMorphDeformData","originFaceMeshs","targetFaceMeshs","originMesh","originTextCoords","targetTextCoords","o","updateMorphDeformData","indexes","morphFaceMesh","Delaunator","triangles","makeMorphRenderData","detectFaceMeshs","detectFaceBaseMeshs","morphFaceMeshCount","slice","detectFaceMesh","detectPositions","detectBasePositions","positionsDiff","pIndex","dbp","diff","dIndex","splice","componentDidMount","RihannaImageSource","componentWillUnmount","cancelAnimationFrame","terminate","removeEventListener","this","StyledMain","Canvas","ref","PureComponent","attrs","style","githubBaseUrl","Footer","email","githubUrl","StyledFooter","Link","href","GithubIcon","alt","string","ReactDOM","document","getElementById"],"mappings":"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","file":"js/bundle~bundle~5b60049d.a10d2064.js","sourcesContent":["// getFaceMeshTransform.js\nimport {\n  averageTwoDots,\n  getPointsVector,\n  getVectorLength,\n  moveFromPoint,\n} from '../resource/LinearAlgebra.js';\nimport { faceLandmarksIndex } from '../resource/faceLandmarkVariables.js';\n\nexport const getEyeRadiuses = ({ dotPositions }) => {\n  const eyeCenters = getEyeCenters({ dotPositions });\n  const leftEye = faceLandmarksIndex.leftEye;\n  const rightEye = faceLandmarksIndex.rightEye;\n  const leftEyeVector = getPointsVector({\n    origin: eyeCenters.left,\n    target: dotPositions[leftEye.lower.outer[0]],\n  });\n  const rightEyeVector = getPointsVector({\n    origin: eyeCenters.right,\n    target: dotPositions[rightEye.lower.outer[0]],\n  });\n  return {\n    left: getVectorLength({ vector: leftEyeVector }),\n    right: getVectorLength({ vector: rightEyeVector }),\n  };\n};\n\nexport const getEyeCenters = ({ dotPositions }) => {\n  const leftEye = faceLandmarksIndex.leftEye;\n  const leftEyeCenter = averageTwoDots(\n    averageTwoDots(\n      dotPositions[leftEye.upper.inner[2]],\n      dotPositions[leftEye.upper.inner[4]]\n    ),\n    averageTwoDots(\n      dotPositions[leftEye.lower.inner[3]],\n      dotPositions[leftEye.lower.inner[5]]\n    )\n  );\n  const rightEye = faceLandmarksIndex.rightEye;\n  const rightEyeCenter = averageTwoDots(\n    averageTwoDots(\n      dotPositions[rightEye.upper.inner[2]],\n      dotPositions[rightEye.upper.inner[4]]\n    ),\n    averageTwoDots(\n      dotPositions[rightEye.lower.inner[3]],\n      dotPositions[rightEye.lower.inner[5]]\n    )\n  );\n\n  return { left: leftEyeCenter, right: rightEyeCenter };\n};\n\nexport const getEnlargeEyes = ({ dotPositions, ratio }) => {\n  const result = dotPositions.map(p => [...p]);\n\n  const eyeCenters = getEyeCenters({ dotPositions });\n\n  const leftEye = faceLandmarksIndex.leftEye;\n  Object.keys(leftEye.upper).forEach(layer => {\n    leftEye.upper[layer].forEach(landmarkIndex => {\n      result[landmarkIndex] = moveFromPoint({\n        from: eyeCenters.left,\n        to: result[landmarkIndex],\n        ratio,\n      });\n    });\n  });\n  Object.keys(leftEye.lower).forEach(layer => {\n    leftEye.lower[layer].forEach(landmarkIndex => {\n      result[landmarkIndex] = moveFromPoint({\n        from: eyeCenters.left,\n        to: result[landmarkIndex],\n        ratio,\n      });\n    });\n  });\n\n  const rightEye = faceLandmarksIndex.rightEye;\n  Object.keys(rightEye.upper).forEach(layer => {\n    rightEye.upper[layer].forEach(landmarkIndex => {\n      result[landmarkIndex] = moveFromPoint({\n        from: eyeCenters.right,\n        to: result[landmarkIndex],\n        ratio,\n      });\n    });\n  });\n  Object.keys(rightEye.lower).forEach(layer => {\n    rightEye.lower[layer].forEach(landmarkIndex => {\n      result[landmarkIndex] = moveFromPoint({\n        from: eyeCenters.right,\n        to: result[landmarkIndex],\n        ratio,\n      });\n    });\n  });\n\n  return result;\n};\n\nconst cheekIndexs = faceLandmarksIndex.cheek;\nconst noseCenterIndexs = faceLandmarksIndex.nose.center;\nexport const cheekSizeIndexPairs = [\n  { origin: cheekIndexs.left.inner[9], target: noseCenterIndexs[8] },\n  { origin: cheekIndexs.left.inner[8], target: noseCenterIndexs[8] },\n  { origin: cheekIndexs.left.inner[7], target: noseCenterIndexs[6] },\n  { origin: cheekIndexs.left.inner[6], target: noseCenterIndexs[6] },\n  { origin: cheekIndexs.left.inner[5], target: noseCenterIndexs[4] },\n  { origin: cheekIndexs.left.inner[4], target: noseCenterIndexs[4] },\n  { origin: cheekIndexs.left.inner[3], target: noseCenterIndexs[0] },\n  { origin: cheekIndexs.left.inner[2], target: noseCenterIndexs[0] },\n  { origin: cheekIndexs.left.inner[1], target: noseCenterIndexs[0] },\n  //{ origin: faceLandmarksIndex.chin.inner, target: noseCenterIndexs[0] },\n  { origin: cheekIndexs.right.inner[9], target: noseCenterIndexs[8] },\n  { origin: cheekIndexs.right.inner[8], target: noseCenterIndexs[8] },\n  { origin: cheekIndexs.right.inner[7], target: noseCenterIndexs[6] },\n  { origin: cheekIndexs.right.inner[6], target: noseCenterIndexs[6] },\n  { origin: cheekIndexs.right.inner[5], target: noseCenterIndexs[4] },\n  { origin: cheekIndexs.right.inner[4], target: noseCenterIndexs[4] },\n  { origin: cheekIndexs.right.inner[3], target: noseCenterIndexs[0] },\n  { origin: cheekIndexs.right.inner[2], target: noseCenterIndexs[0] },\n  { origin: cheekIndexs.right.inner[1], target: noseCenterIndexs[0] },\n];\n\nexport const edgePointsMesh = {\n  positions: [\n    [-1, -1, 0],\n    [0, -1, 0],\n    [1, -1, 0],\n    [-1, 0, 0],\n    [1, 0, 0],\n    [-1, 1, 0],\n    [0, 1, 0],\n    [1, 1, 0],\n  ],\n  textCoords: [\n    [0, 1],\n    [0.5, 1],\n    [1, 1],\n    [0, 0.5],\n    [1, 0.5],\n    [0, 0],\n    [0.5, 0],\n    [1, 0],\n  ],\n  colors: [\n    [0, 1, 1],\n    [0, 1, 1],\n    [0, 1, 1],\n    [0, 1, 1],\n    [0, 1, 1],\n    [0, 1, 1],\n    [0, 1, 1],\n    [0, 1, 1],\n  ],\n};\n","// LinearAlgebra.js\n\nexport const averageTwoDots = (a, b) => {\n  return [(a[0] + b[0]) / 2, (a[1] + b[1]) / 2, (a[2] + b[2]) / 2];\n};\nexport const averageThreeDots = (a, b, c) => {\n  return [(a[0] + b[0] + c[0]) / 3, (a[1] + b[1] + c[1]) / 3, 0.5];\n};\nexport const addTwoVectors = (a, b) => {\n  return [a[0] + b[0], a[1] + b[1], a[2] + b[2]];\n};\nexport const getPointsVector = ({ origin, target }) => {\n  return [target[0] - origin[0], target[1] - origin[1], target[2] - target[2]];\n};\nexport const getVectorLength = ({ vector }) => {\n  return Math.sqrt(\n    vector[0] * vector[0] + vector[1] * vector[1] + vector[2] * vector[2]\n  );\n};\n\nexport const aDotB2D = ({ a, b }) => a[0] * b[0] + a[1] * b[1];\nexport const averageTwoDots2D = (a, b) => {\n  return [(a[0] + b[0]) / 2, (a[1] + b[1]) / 2];\n};\nexport const getPointsVector2D = ({ origin, target }) => {\n  return [target[0] - origin[0], target[1] - origin[1]];\n};\nexport const getVectorLength2D = ({ vector }) => {\n  return Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\n};\n\nexport const moveFromPoint = ({ from, to, ratio }) => {\n  const direction = getPointsVector({ origin: from, target: to });\n  return [\n    from[0] + direction[0] * ratio,\n    from[1] + direction[1] * ratio,\n    from[2] + direction[2] * ratio,\n  ];\n};\n","// App.jsx\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { hot } from 'react-hot-loader/root';\nimport styled, {\n  createGlobalStyle,\n  StyleSheetManager,\n} from 'styled-components';\nimport styledNormalize from 'styled-normalize';\nimport { Helmet } from 'react-helmet';\n\nimport Main from '../component/Main.jsx';\nimport Footer from '../component/Footer.jsx';\nimport XMenLogoSource from '../../img/x-men-school.svg';\n\nconst GlobalStyle = createGlobalStyle`\n  ${styledNormalize};\n  *, ::after, ::before { box-sizing: border-box; }\n  body {\n    background-color: #101010;\n    color: #efefef;\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\",\n      Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n    font-weight: 400;\n    -webkit-tap-highlight-color: transparent;\n    overscroll-behavior-y: contain;\n  }\n  button {\n    background-color: rgba(0, 0, 0, 0);\n    cursor: pointer;\n    &:disabled {\n      cursor: not-allowed;\n    }\n  }\n  input::placeholder,\n  input::-webkit-input-placeholder,\n  input::-moz-placeholder {\n    line-height: normal !important;\n    vertical-align: middle;\n  }\n  a { color: inherit; text-decoration: none; }\n  a > * { opacity: inherit; }\n  a:hover { opacity: .7; }\n`;\n\nconst isServer = typeof window === 'undefined';\nconst title = 'Portfolio';\nconst description = \"Bill's portfolio\";\nconst branchName = isServer\n  ? process.env.BRANCH_NAME\n  : window.__SSR_ENVIRONMENT__.branchName;\n\nconst App = ({ request }) => {\n  // eslint-disable-next-line no-console\n  console.log('App() request:', request);\n  return (\n    <>\n      <Helmet defaultTitle=\"Portfolio\" titleTemplate=\"%s - Portfolio\">\n        <meta charSet=\"utf-8\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n\n        <meta name=\"author\" content=\"Bill\" />\n        <meta name=\"description\" content={description} />\n\n        <meta\n          property=\"og:url\"\n          content=\"https://github.com/bill42362/portfolio\"\n        />\n        <meta property=\"og:type\" content=\"website\" />\n        <meta property=\"og:title\" content={title} />\n        <meta property=\"og:description\" content={description} />\n        <meta property=\"og:site_name\" content={title} />\n        <meta property=\"twitter:card\" content=\"summary\" />\n        <meta property=\"twitter:site\" content=\"@bill_portfolio\" />\n        {/* <meta property=\"twitter:image\" content={twitterImageSource} /> */}\n      </Helmet>\n      <GlobalStyle />\n      <StyledApp>\n        {!window && <img src={XMenLogoSource} title=\"Xavier school\" />}\n        <Main />\n        <Footer branchName={branchName} />\n      </StyledApp>\n    </>\n  );\n};\n\nApp.propTypes = {\n  request: PropTypes.object,\n};\n\nApp.defaultProps = {\n  request: null,\n};\n\nconst StyledApp = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  height: 100vh;\n  background-color: #222f3e;\n`;\n\nconst Body = ({ sheet, ...props }) => {\n  if (sheet.instance) {\n    return (\n      <StyleSheetManager sheet={sheet.instance}>\n        <App {...props} />\n      </StyleSheetManager>\n    );\n  } else {\n    return <App {...props} />;\n  }\n};\n\nBody.propTypes = {\n  ...App.propTypes,\n  sheet: PropTypes.object,\n};\n\nBody.defaultProps = {\n  ...App.defaultProps,\n  sheet: {},\n};\n\nexport default hot(Body);\n","// faceLandmarkVariables.js\n\nexport const shrinkFactor = 4;\n\nexport const faceLandmarkConfig = {\n  shouldLoadIrisModel: false, // true\n  maxContinuousChecks: 3, // 5\n  // detectionConfidence: 0.9, // 0.9\n  maxFaces: 2, // 10\n  iouThreshold: 0.3, // 0.3\n  // scoreThreshold: 0.75, // 0.75\n  // modelUrl: facemeshModlePath, // null\n  // irisModelUrl: null, // null\n  // flipHorizontal: true, // true\n  predictIrises: false, // true\n};\n\n// coords are based on img/face-1024.png\nexport const annotationShape = {\n  leftCheek: 1,\n  leftEyeLower0: 9,\n  leftEyeLower1: 9,\n  leftEyeLower2: [\n    [574, 375],\n    [594, 392],\n    [624, 400],\n    [650, 409],\n    [682, 417],\n    [719, 417],\n    [749, 408],\n    [770, 391],\n    [776, 365],\n  ],\n  leftEyeLower3: 9,\n  leftEyeUpper0: 7,\n  leftEyeUpper1: 7,\n  leftEyeUpper2: [\n    [760, 336],\n    [736, 315],\n    [703, 302],\n    [672, 300],\n    [638, 303],\n    [600, 315],\n    [577, 342],\n  ],\n  leftEyebrowLower: 6,\n  leftEyebrowUpper: 8,\n  lipsLowerInner: 11,\n  lipsLowerOuter: 10,\n  lipsUpperInner: 11,\n  lipsUpperOuter: 11,\n  midwayBetweenEyes: 1,\n  noseBottom: 1,\n  noseLeftCorner: 1,\n  noseRightCorner: 1,\n  noseTip: 1,\n  rightCheek: 1,\n  rightEyeLower0: 9,\n  rightEyeLower1: 9,\n  rightEyeLower2: 9,\n  rightEyeLower3: 9,\n  rightEyeUpper0: 7,\n  rightEyeUpper1: 7,\n  rightEyeUpper2: 7,\n  rightEyebrowLower: 6,\n  rightEyebrowUpper: 8,\n  silhouette: 36,\n};\n\nexport const faceLandmarksIndex = {\n  leftEye: {\n    upper: {\n      inner: [398, 384, 385, 386, 387, 388, 466],\n      middle: [414, 286, 258, 257, 259, 260, 467],\n      outer: [413, 441, 442, 443, 444, 445, 342],\n    },\n    lower: {\n      inner: [362, 382, 381, 380, 374, 373, 390, 249, 263],\n      middle: [463, 341, 256, 252, 253, 254, 339, 255, 359],\n      outer: [464, 453, 452, 451, 450, 449, 448, 261, 446],\n    },\n  },\n  rightEye: {\n    upper: {\n      inner: [173, 157, 158, 159, 160, 161, 246],\n      middle: [190, 56, 28, 27, 29, 30, 247],\n      outer: [189, 221, 222, 223, 224, 225, 113],\n    },\n    lower: {\n      inner: [133, 155, 154, 153, 145, 144, 163, 7, 33],\n      middle: [243, 112, 26, 22, 23, 24, 110, 25, 130],\n      outer: [244, 233, 232, 231, 230, 229, 228, 31, 226],\n    },\n  },\n  cheek: {\n    left: {\n      inner: [208, 32, 211, 210, 214, 192, 213, 147, 123, 116, 143],\n      middle: [171, 140, 170, 169, 135, 138, 215, 177, 137, 227, 34],\n      outer: [148, 176, 149, 150, 136, 172, 58, 132, 93, 234, 127],\n    },\n    right: {\n      inner: [426, 262, 431, 430, 434, 416, 433, 376, 352, 345, 372],\n      middle: [396, 369, 395, 394, 364, 367, 435, 401, 366, 447, 264],\n      outer: [377, 400, 378, 379, 365, 397, 288, 361, 323, 454, 356],\n    },\n  },\n  chin: {\n    inner: 199,\n    middle: 175,\n    outer: 152,\n  },\n  nose: {\n    // the fifth one is nose tip, last one is eyebrow center.\n    center: [2, 94, 19, 1, 4, 5, 195, 197, 6, 168, 8],\n    left: {},\n    right: {},\n  },\n};\n","export default __webpack_public_path__ + \"img/x-men-school.0928a818.svg\";","// MovingLeastSquare.js\n// SCHAEFER, S., MCPHAIL, T., AND WARREN, J. 2006. Image deformation using moving least squares. In SIGGRAPH ’06: ACM SIGGRAPH 2006 Papers, ACM Press, New York, NY, USA, 533–540.\n// https://people.engr.tamu.edu/schaefer/research/mls.pdf\n\nimport {\n  aDotB2D,\n  getPointsVector2D,\n  getVectorLength2D,\n} from '../resource/LinearAlgebra.js';\n\nconst getMovingLeastSquareMesh = ({\n  pointPairs = [],\n  stripCount = 3,\n  alpha = 1,\n} = {}) => {\n  const lineCount = stripCount + 1;\n  const step = 1 / stripCount;\n  const points = new Array(lineCount * lineCount).fill(0).map((_, index) => {\n    const xIndex = index % lineCount;\n    const yIndex = Math.floor(index / lineCount);\n    const textCoord = [step * xIndex, step * yIndex];\n\n    const weights = pointPairs.map(({ origin }) => {\n      return (\n        1 /\n        Math.pow(\n          getVectorLength2D({\n            vector: getPointsVector2D({\n              origin: textCoord,\n              target: origin,\n            }),\n          }) || 1e-100,\n          2 * alpha\n        )\n      );\n    });\n\n    const weightsSum = weights.reduce((cur, w) => cur + w, 0);\n\n    const pStar = pointPairs.reduce(\n      (cur, p, index) => {\n        return [\n          cur[0] + (weights[index] * p.origin[0]) / weightsSum,\n          cur[1] + (weights[index] * p.origin[1]) / weightsSum,\n        ];\n      },\n      [0, 0]\n    );\n    const qStar = pointPairs.reduce(\n      (cur, p, index) => {\n        return [\n          cur[0] + (weights[index] * p.target[0]) / weightsSum,\n          cur[1] + (weights[index] * p.target[1]) / weightsSum,\n        ];\n      },\n      [0, 0]\n    );\n    const normalVector = getPointsVector2D({\n      origin: pStar,\n      target: textCoord,\n    });\n    const normalDistance = getVectorLength2D({ vector: normalVector });\n\n    const pHats = pointPairs.map(p =>\n      getPointsVector2D({\n        origin: pStar,\n        target: p.origin,\n      })\n    );\n    const qHats = pointPairs.map(p =>\n      getPointsVector2D({\n        origin: qStar,\n        target: p.target,\n      })\n    );\n\n    const As = weights.map((w, index) => {\n      const pHat = pHats[index];\n      const minusPHatOrth = [pHat[1], -pHat[0]];\n      const minusNormalVectorOrth = [normalVector[1], -normalVector[0]];\n      return [\n        w * aDotB2D({ a: pHat, b: normalVector }),\n        w * aDotB2D({ a: pHat, b: minusNormalVectorOrth }),\n        w * aDotB2D({ a: minusPHatOrth, b: normalVector }),\n        w * aDotB2D({ a: minusPHatOrth, b: minusNormalVectorOrth }),\n      ];\n    });\n\n    const fvVector = qHats.reduce(\n      (cur, qHat, index) => {\n        const A = As[index];\n        return [\n          cur[0] + qHat[0] * A[0] + qHat[1] * A[2],\n          cur[1] + qHat[0] * A[1] + qHat[1] * A[3],\n        ];\n      },\n      [0, 0]\n    );\n\n    const fvLength = getVectorLength2D({ vector: fvVector }) || 1e-100;\n\n    const newTextCoord = [\n      (normalDistance * fvVector[0]) / fvLength + qStar[0],\n      (normalDistance * fvVector[1]) / fvLength + qStar[1],\n    ];\n\n    const position = [\n      2 * (newTextCoord[0] - 0.5),\n      -2 * (newTextCoord[1] - 0.5),\n      0,\n    ];\n\n    return { textCoord, newTextCoord, position, index: [xIndex, yIndex] };\n  });\n\n  const elementIndexes = [];\n  points.forEach((point, index) => {\n    if (point.index.includes(stripCount)) {\n      // right or bottom edge\n      return;\n    }\n    elementIndexes.push(\n      index,\n      index + 1,\n      index + lineCount + 1,\n      index,\n      index + lineCount + 1,\n      index + lineCount\n    );\n  });\n\n  return {\n    positions: points.map(p => p.position).flatMap(a => a),\n    textCoords: points.map(p => p.textCoord).flatMap(a => a),\n    colors: points.map(() => [1, 0.5, 0]).flatMap(a => a),\n    elementIndexes,\n  };\n};\n\nexport const edgeAnchorPointPairs = [\n  { origin: [0, 0], target: [0, 0] },\n  { origin: [0, 0.25], target: [0, 0.25] },\n  { origin: [0, 0.5], target: [0, 0.5] },\n  { origin: [0, 0.75], target: [0, 0.75] },\n  { origin: [0, 1], target: [0, 1] },\n  { origin: [0.25, 0], target: [0.25, 0] },\n  { origin: [0.5, 0], target: [0.5, 0] },\n  { origin: [0.75, 0], target: [0.75, 0] },\n  { origin: [0.25, 1], target: [0.25, 1] },\n  { origin: [0.5, 1], target: [0.5, 1] },\n  { origin: [0.75, 1], target: [0.75, 1] },\n  { origin: [1, 0], target: [1, 0] },\n  { origin: [1, 0.25], target: [1, 0.25] },\n  { origin: [1, 0.5], target: [1, 0.5] },\n  { origin: [1, 0.75], target: [1, 0.75] },\n  { origin: [1, 1], target: [1, 1] },\n];\n\nexport default getMovingLeastSquareMesh;\n","export default __webpack_public_path__ + \"img/rihanna.e14fa420.png\";","// Main.jsx\nimport React from 'react';\nimport styled from 'styled-components';\nimport * as dat from 'dat.gui';\nimport throttle from 'lodash/throttle';\nimport Delaunator from 'delaunator';\n\nimport {\n  averageTwoDots2D,\n  getPointsVector2D,\n  getVectorLength2D,\n} from '../resource/LinearAlgebra.js';\nimport {\n  getEyeRadiuses,\n  cheekSizeIndexPairs,\n  edgePointsMesh,\n} from '../resource/getFaceMeshTransform.js';\nimport getMovingLeastSquareMesh, {\n  edgeAnchorPointPairs,\n} from '../resource/MovingLeastSquare.js';\n\nimport RihannaImageSource from '../../img/rihanna.png';\n\nconst renderWorkerFileName =\n  window.renderWorkerFileName || '../js/renderWorker.js';\nconst faceDetectionWorkerFileName =\n  window.faceDetectionWorkerFileName || '../js/faceDetectionWorker.js';\nconst captureContraints = {\n  audio: false,\n  video: { width: 1280, height: 720, facingMode: 'user' },\n};\n\nexport class Main extends React.PureComponent {\n  state = { canvasHeight: '100%' };\n  canvas = React.createRef();\n  canvasContext = null;\n  nextTick = null;\n  workers = {\n    render: null,\n    faceDetection: null,\n    morphFaceDetection: null,\n  };\n  captureObjects = {\n    lastTime: Date.now(),\n    mediaStream: null,\n    videoTrack: null,\n    imageCapture: null,\n    lastImageBitmap: null,\n  };\n  detectObjects = {\n    lastTime: Date.now(),\n    lastDetectedImageBitmap: null,\n    faceData: null,\n    faceRenderData: null,\n  };\n  deformObjects = {\n    deformData: null,\n  };\n  morphObjects = {\n    targetImage: new Image(512, 512),\n    targetImageBitmap: null,\n    faceData: null,\n    faceRenderBaseData: null, // to cache textCoords of target image\n    faceRenderData: null,\n    deformData: null,\n    detectFaceBaseData: null, // to store user's reference face data\n  };\n\n  controlObject = {\n    capturing: {\n      shouldCapture: false,\n      fps: 60,\n      facingUser: true,\n    },\n    detecting: {\n      shouldDetect: false,\n      fps: 20,\n      needFaceDots: false,\n      shrinkFactor: 4,\n    },\n    deforming: {\n      shouldDeformEyes: false,\n      eyesSize: 1.3,\n      shouldDeformCheeks: false,\n      useMlsCheekDeforming: false,\n      cheekSize: 0.95,\n    },\n    morphing: {\n      shouldMorph: false,\n      shouldLockBaseFase: false,\n    },\n  };\n  controlUIObject = {\n    gui: null,\n    Capturing: null,\n    capturing: {},\n    Detecting: null,\n    detecting: {},\n    Deforming: null,\n    deforming: {},\n    Morphing: null,\n    morphing: {},\n  };\n\n  initDatGui = () => {\n    const gui = new dat.GUI({\n      hideable: true,\n      closed: false,\n      closeOnTop: true,\n    });\n    this.controlUIObject.gui = gui;\n\n    const control = this.controlObject;\n    const ui = this.controlUIObject;\n\n    ui.Capturing = gui.addFolder('Capturing');\n    ui.capturing.shouldCapture = ui.Capturing.add(\n      control.capturing,\n      'shouldCapture'\n    ).onChange(() => {\n      if (control.capturing.shouldCapture) {\n        this.startCapturing();\n      } else {\n        this.stopCapturing();\n      }\n    });\n    ui.capturing.fps = ui.Capturing.add(control.capturing, 'fps')\n      .min(1)\n      .max(120);\n\n    ui.Detecting = gui.addFolder('Detecting');\n    ui.detecting.shouldDetect = ui.Detecting.add(\n      control.detecting,\n      'shouldDetect'\n    ).onChange(() => {\n      if (control.detecting.shouldDetect) {\n        this.startDetecting();\n      }\n    });\n    ui.detecting.fps = ui.Detecting.add(control.detecting, 'fps')\n      .min(1)\n      .max(60);\n    ui.detecting.needFaceDots = ui.Detecting.add(\n      control.detecting,\n      'needFaceDots'\n    ).onChange(this.handleDetectConfigChange);\n\n    ui.Deforming = gui.addFolder('Deforming');\n    ui.deforming.shouldDeformEyes = ui.Deforming.add(\n      control.deforming,\n      'shouldDeformEyes'\n    ).onChange(this.handleDeformConfigChange);\n    ui.deforming.eyesSize = ui.Deforming.add(control.deforming, 'eyesSize')\n      .min(0)\n      .max(2)\n      .step(0.01)\n      .onChange(this.handleDeformConfigChange);\n    ui.deforming.shouldDeformCheeks = ui.Deforming.add(\n      control.deforming,\n      'shouldDeformCheeks'\n    ).onChange(this.handleDeformConfigChange);\n    ui.deforming.useMlsCheekDeforming = ui.Deforming.add(\n      control.deforming,\n      'useMlsCheekDeforming'\n    ).onChange(this.handleDeformConfigChange);\n    ui.deforming.cheekSize = ui.Deforming.add(control.deforming, 'cheekSize')\n      .min(0.8)\n      .max(1.2)\n      .step(0.001)\n      .onChange(this.handleDeformConfigChange);\n\n    ui.Morphing = gui.addFolder('Morphing');\n    ui.morphing.shouldMorph = ui.Morphing.add(\n      control.morphing,\n      'shouldMorph'\n    ).onChange(() => {\n      if (control.morphing.shouldMorph) {\n        this.startMorphing();\n      }\n      this.handleMorphConfigChange();\n    });\n    ui.morphing.shouldLockBaseFase = ui.Morphing.add(\n      control.morphing,\n      'shouldLockBaseFase'\n    ).onChange(() => {\n      if (control.morphing.shouldLockBaseFase) {\n        this.morphObjects.detectFaceBaseData = this.detectObjects.faceData;\n      } else {\n        this.morphObjects.detectFaceBaseData = null;\n      }\n      this.handleMorphConfigChange();\n    });\n  };\n  initRendererWorker = () => {\n    const offscreenCanvas = this.canvas.current.transferControlToOffscreen();\n    this.workers.render = new Worker(renderWorkerFileName, { type: 'module' });\n    this.workers.render.postMessage(\n      {\n        type: 'canvas',\n        payload: {\n          canvas: offscreenCanvas,\n          sizes: captureContraints.video,\n        },\n      },\n      [offscreenCanvas]\n    );\n  };\n\n  // https://stackoverflow.com/a/19772220/2605764\n  animation = () => {\n    this.nextTick = window.requestAnimationFrame(this.animation);\n    const now = Date.now();\n    const control = this.controlObject;\n\n    if (control.capturing.shouldCapture) {\n      const capture = this.captureObjects;\n      const captureInterval = 1000 / control.capturing.fps;\n      const captureElapsed = now - capture.lastTime;\n      if (captureElapsed > captureInterval) {\n        capture.lastTime = now - (captureElapsed % captureInterval);\n        this.captureImage();\n      }\n    }\n\n    if (control.detecting.shouldDetect) {\n      const detect = this.detectObjects;\n      const detectInterval = 1000 / control.detecting.fps;\n      const detectElapsed = now - detect.lastTime;\n      if (detectElapsed > detectInterval) {\n        detect.lastTime = now - (detectElapsed % detectInterval);\n        this.detectFace();\n      }\n    }\n  };\n\n  handleWindowResize = throttle(() => {\n    if (!this.canvas.current) {\n      return;\n    }\n    const canvas = this.canvas.current;\n    const width = canvas.clientWidth;\n    const { video } = captureContraints;\n    const height = (video.height * width) / video.width;\n    this.setState({ canvasHeight: `${height}px` });\n  }, 100);\n  handleDetectConfigChange = () => {\n    this.detectObjects.faceRenderData = this.makeFaceRenderData({\n      faceMeshs: this.detectObjects.faceData.faceMeshs,\n      config: this.controlObject.detecting,\n    });\n    this.updateFrame();\n  };\n  handleDeformConfigChange = () => {\n    this.updateDeformData();\n    this.updateFrame();\n  };\n  handleMorphConfigChange = () => {\n    //this.updateMorphDeformData();\n    this.updateMorphRenderData();\n    this.updateFrame();\n  };\n\n  updateFrame = () => {\n    this.workers.render?.postMessage({\n      type: 'input-frame',\n      payload: {\n        imageBitmap: this.captureObjects.lastImageBitmap,\n        faceData: this.detectObjects.faceRenderData,\n        deformData: this.deformObjects.deformData,\n        morphData: {\n          imageBitmap: this.morphObjects.targetImageBitmap,\n          faceData: this.morphObjects.faceRenderData,\n        },\n      },\n    });\n  };\n  startCapturing = async () => {\n    try {\n      if (!this.workers.render) {\n        this.initRendererWorker();\n      }\n      const objects = this.captureObjects;\n      objects.mediaStream = await navigator.mediaDevices.getUserMedia(\n        captureContraints\n      );\n      objects.videoTrack = objects.mediaStream.getVideoTracks()[0];\n      objects.imageCapture = new ImageCapture(objects.videoTrack);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.log('startCapturing() error:', error);\n    }\n  };\n  stopCapturing = () => {\n    this.captureObjects.imageCapture = null;\n    this.captureObjects.mediaStream?.getTracks().forEach(t => t.stop());\n    this.captureObjects.videoTrack = null;\n    this.captureObjects.mediaStream = null;\n  };\n  captureImage = async () => {\n    try {\n      const imageBitmap = await this.captureObjects.imageCapture?.grabFrame();\n      if (imageBitmap) {\n        this.captureObjects.lastImageBitmap?.close();\n        this.captureObjects.lastImageBitmap = imageBitmap;\n        this.updateFrame();\n      }\n    } catch (error) {\n      // silent error came from grabing too fast.\n      // eslint-disable-next-line no-console\n      error && console.log('captureImage() error:', error);\n    }\n  };\n\n  makeFaceRenderData = ({ faceMeshs, config }) => {\n    const result = {\n      positions: { array: [], numComponents: 3 },\n      textCoords: { array: [], numComponents: 2 },\n      colors: { array: [], numComponents: 3 },\n    };\n\n    if (config.needFaceDots) {\n      faceMeshs.forEach(faceMesh => {\n        result.positions.array.push(...faceMesh.dots.positions);\n        result.textCoords.array.push(...faceMesh.dots.textCoords);\n        result.colors.array.push(...faceMesh.dots.colors);\n      });\n      result.positions.array = result.positions.array.flatMap(a => a);\n      result.textCoords.array = result.textCoords.array.flatMap(a => a);\n      result.colors.array = result.colors.array.flatMap(a => a);\n    }\n\n    return result;\n  };\n  startDetecting = () => {\n    if (!this.workers.faceDetection) {\n      this.workers.faceDetection = new Worker(faceDetectionWorkerFileName, {\n        type: 'module',\n      });\n      this.workers.faceDetection.addEventListener(\n        'message',\n        this.faceDetectionWorkerMessageHandler\n      );\n    }\n  };\n  faceDetectionWorkerMessageHandler = ({ data }) => {\n    this.detectObjects.faceData = data;\n    if (data) {\n      // decrease detection fps by feedback.\n      const newFps = Math.min(Math.floor(1000 / data.detectDuration) - 1, 20);\n      this.controlUIObject.detecting.fps.setValue(newFps);\n    }\n\n    if (data?.isNewFaceMeshes) {\n      this.detectObjects.faceRenderData = this.makeFaceRenderData({\n        faceMeshs: data.faceMeshs,\n        config: this.controlObject.detecting,\n      });\n      this.updateDeformData();\n      this.updateMorphRenderData();\n      //this.updateMorphDeformData();\n    }\n  };\n  detectFace = () => {\n    const control = this.controlObject;\n    const imageBitmap = this.captureObjects.lastImageBitmap;\n    const lastImageBitmap = this.detectObjects.lastDetectedImageBitmap;\n    if (imageBitmap && imageBitmap !== lastImageBitmap) {\n      this.workers.faceDetection?.postMessage({\n        type: 'input-frame',\n        payload: {\n          imageBitmap,\n          faceLandmarkConfig: control.detecting,\n        },\n      });\n      this.detectObjects.lastDetectedImageBitmap = imageBitmap;\n    }\n  };\n\n  makeDeformData = ({ faceMeshs, config }) => {\n    if (!faceMeshs?.length) {\n      return null;\n    }\n    const circularDeforms = faceMeshs.map(faceMesh => {\n      const result = [];\n      if (config.shouldDeformEyes) {\n        const dotPositions = faceMesh.dots.positions;\n        const eyeRadiuses = getEyeRadiuses({ dotPositions });\n        const eyeCenters = faceMesh.eyeCenters;\n        const leftEyeDeform = {\n          origin: eyeCenters.left.textCoord,\n          target: eyeCenters.left.textCoord,\n          // *0.5 to map from position to textCoord\n          radius: 0.5 * eyeRadiuses.left,\n          ratio: config.eyesSize,\n        };\n        const rightEyeDeform = {\n          origin: eyeCenters.right.textCoord,\n          target: eyeCenters.right.textCoord,\n          // *0.5 to map from position to textCoord\n          radius: 0.5 * eyeRadiuses.right,\n          ratio: config.eyesSize,\n        };\n        result.push(leftEyeDeform, rightEyeDeform);\n      }\n      if (config.shouldDeformCheeks && !config.useMlsCheekDeforming) {\n        const dotTextCoords = faceMesh.dots.textCoords;\n        const cheekDeforms = cheekSizeIndexPairs.map(pair => {\n          const origin = dotTextCoords[pair.origin];\n          const target = dotTextCoords[pair.target];\n          const radius = getVectorLength2D({\n            vector: getPointsVector2D({ origin, target }),\n          });\n          return {\n            origin,\n            target: averageTwoDots2D(origin, target),\n            radius: 0.5 * radius,\n            ratio: config.cheekSize,\n          };\n        });\n        result.push(...cheekDeforms);\n      }\n      return result;\n    });\n\n    let meshData = {\n      positions: [],\n      textCoords: [],\n      colors: [],\n      elementIndexes: [],\n    };\n\n    if (config.shouldDeformCheeks && config.useMlsCheekDeforming) {\n      const vectorRatio = 1 - config.cheekSize;\n      const movingLeastSquarePointPairs = faceMeshs\n        .map(faceMesh => {\n          const dotTextCoords = faceMesh.dots.textCoords;\n          return cheekSizeIndexPairs.map(pair => {\n            const origin = dotTextCoords[pair.origin];\n            const target = dotTextCoords[pair.target];\n            const vector = getPointsVector2D({ origin, target });\n            return {\n              origin,\n              target: [\n                origin[0] + vectorRatio * vector[0],\n                origin[1] + vectorRatio * vector[1],\n              ],\n            };\n          });\n        })\n        .flatMap(a => a);\n\n      meshData = getMovingLeastSquareMesh({\n        pointPairs: movingLeastSquarePointPairs.concat(edgeAnchorPointPairs),\n        stripCount: 99,\n        alpha: 1,\n      });\n    }\n\n    return {\n      circularDeforms: circularDeforms.flatMap(a => a),\n      movingLeastSquareMesh: {\n        positions: { array: meshData.positions, numComponents: 3 },\n        textCoords: { array: meshData.textCoords, numComponents: 3 },\n        colors: { array: meshData.colors, numComponents: 3 },\n        elementIndexes: { array: meshData.elementIndexes, numComponents: 1 },\n      },\n    };\n  };\n  updateDeformData = () => {\n    const faceMeshs = this.detectObjects.faceData?.faceMeshs;\n    const config = this.controlObject.deforming;\n    this.deformObjects.deformData = this.makeDeformData({ faceMeshs, config });\n  };\n\n  handleMorphFaceWorkerMessage = ({ data }) => {\n    this.morphObjects.faceData = data;\n    this.morphObjects.morphRenderBaseData = this.makeMorphRenderBaseData({\n      morphFaceMeshs: data.faceMeshs,\n    });\n    this.updateMorphRenderData();\n    //this.updateMorphDeformData();\n  };\n  startMorphing = async () => {\n    if (!this.workers.morphFaceDetection) {\n      this.workers.morphFaceDetection = new Worker(\n        faceDetectionWorkerFileName,\n        { type: 'module' }\n      );\n      this.workers.morphFaceDetection.addEventListener(\n        'message',\n        this.handleMorphFaceWorkerMessage\n      );\n    }\n    if (!this.morphObjects.targetImageBitmap) {\n      const { targetImage } = this.morphObjects;\n      this.morphObjects.targetImageBitmap = await createImageBitmap(\n        targetImage\n      );\n    }\n    if (!this.morphObjects.faceData) {\n      this.workers.morphFaceDetection?.postMessage({\n        type: 'input-frame',\n        payload: {\n          imageBitmap: this.morphObjects.targetImageBitmap,\n          faceLandmarkConfig: this.controlObject.detecting,\n        },\n      });\n    }\n  };\n  makeMorphDeformData = ({ originFaceMeshs, targetFaceMeshs, config }) => {\n    if (!originFaceMeshs || !targetFaceMeshs) {\n      return null;\n    }\n    let meshData = {\n      positions: [],\n      textCoords: [],\n      colors: [],\n      elementIndexes: [],\n    };\n\n    if (config.shouldMorph) {\n      const pointPairs = originFaceMeshs\n        .map((originMesh, index) => {\n          const originTextCoords = originMesh.dots.textCoords;\n          const targetTextCoords = targetFaceMeshs[index]?.dots.textCoords;\n          if (!targetTextCoords) {\n            return [];\n          }\n          return originTextCoords.map((o, index) => ({\n            origin: o,\n            target: targetTextCoords[index],\n          }));\n        })\n        .flatMap(a => a);\n      meshData = getMovingLeastSquareMesh({\n        pointPairs,\n        stripCount: 19,\n        alpha: 1,\n      });\n    }\n\n    return {\n      movingLeastSquareMesh: {\n        positions: { array: meshData.positions, numComponents: 3 },\n        textCoords: { array: meshData.textCoords, numComponents: 3 },\n        colors: { array: meshData.colors, numComponents: 3 },\n        elementIndexes: { array: meshData.elementIndexes, numComponents: 1 },\n      },\n    };\n  };\n  updateMorphDeformData = () => {\n    this.morphObjects.deformData = this.makeMorphDeformData({\n      originFaceMeshs: this.morphObjects.faceData?.faceMeshs,\n      targetFaceMeshs: this.detectObjects.faceData?.faceMeshs,\n      config: this.controlObject.morphing,\n    });\n  };\n  makeMorphRenderBaseData = ({ morphFaceMeshs }) => {\n    const result = {\n      positions: { array: [], numComponents: 3 },\n      textCoords: { array: [], numComponents: 2 },\n      colors: { array: [], numComponents: 3 },\n      indexes: { array: [], numComponents: 1 },\n    };\n\n    morphFaceMeshs.forEach(morphFaceMesh => {\n      result.positions.array.push(...morphFaceMesh.dots.positions);\n      result.textCoords.array.push(...morphFaceMesh.dots.textCoords);\n      result.colors.array.push(...morphFaceMesh.dots.colors);\n    });\n    result.positions.array.push(...edgePointsMesh.positions);\n    result.textCoords.array.push(...edgePointsMesh.textCoords);\n    result.colors.array.push(...edgePointsMesh.colors);\n    result.indexes.array = Delaunator.from(result.positions.array).triangles;\n\n    result.positions.array = result.positions.array.flatMap(a => a);\n    result.textCoords.array = result.textCoords.array.flatMap(a => a);\n    result.colors.array = result.colors.array.flatMap(a => a);\n\n    return result;\n  };\n  makeMorphRenderData = ({\n    detectFaceMeshs = [],\n    detectFaceBaseMeshs = [],\n    morphRenderBaseData,\n    morphFaceMeshCount = 0,\n    config,\n  }) => {\n    const result = {\n      positions: { array: [], numComponents: 3 },\n      textCoords: { array: [], numComponents: 2 },\n      colors: { array: [], numComponents: 3 },\n      indexes: { array: [], numComponents: 1 },\n    };\n    if (!config.shouldMorph) {\n      return result;\n    }\n\n    result.positions.array = morphRenderBaseData?.positions.array.slice() || [];\n    result.textCoords.array = morphRenderBaseData?.textCoords.array || [];\n    result.colors.array = morphRenderBaseData?.colors.array || [];\n    result.indexes.array = morphRenderBaseData?.indexes.array || [];\n\n    detectFaceMeshs.forEach((detectFaceMesh, index) => {\n      if (index >= morphFaceMeshCount) {\n        return;\n      }\n      const detectPositions = detectFaceMesh.dots.positions;\n      const detectBasePositions = detectFaceBaseMeshs[index]?.dots.positions;\n      if (detectBasePositions) {\n        const positionsDiff = detectPositions\n          .map((p, pIndex) => {\n            const dbp = detectBasePositions[pIndex];\n            return [p[0] - dbp[0], p[1] - dbp[1], dbp[2]];\n          })\n          .flatMap(a => a);\n        positionsDiff.forEach((diff, dIndex) => {\n          result.positions.array[index * positionsDiff.length + dIndex] += diff;\n        });\n      } else {\n        const positions = detectPositions.flatMap(a => a);\n        result.positions.array.splice(\n          positions.length * index,\n          positions.length,\n          ...positions\n        );\n      }\n    });\n\n    return result;\n  };\n  updateMorphRenderData = () => {\n    this.morphObjects.faceRenderData = this.makeMorphRenderData({\n      detectFaceMeshs: this.detectObjects.faceData?.faceMeshs,\n      detectFaceBaseMeshs: this.morphObjects.detectFaceBaseData?.faceMeshs,\n      morphRenderBaseData: this.morphObjects.morphRenderBaseData,\n      morphFaceMeshCount: this.morphObjects.faceData?.faceMeshs.length,\n      config: this.controlObject.morphing,\n    });\n  };\n\n  componentDidMount = () => {\n    this.morphObjects.targetImage.src = RihannaImageSource;\n    this.initDatGui();\n    this.handleWindowResize();\n    window.addEventListener('resize', this.handleWindowResize);\n    this.animation();\n  };\n\n  componentWillUnmount = () => {\n    this.cancelAnimationFrame(this.nextTick);\n\n    this.stopCapturing();\n\n    //this.workers.render?.removeEventListener('message', this.workerMessageHandler);\n    this.workers.render?.terminate();\n    this.workers.render = null;\n    this.workers.faceDetection?.removeEventListener(\n      'message',\n      this.faceDetectionWorkerMessageHandler\n    );\n    this.workers.faceDetection?.terminate();\n    this.workers.faceDetection = null;\n    this.workers.morphFaceDetection?.removeEventListener(\n      'message',\n      this.handleMorphFaceWorkerMessage\n    );\n    this.workers.morphFaceDetection?.terminate();\n    this.workers.morphFaceDetection = null;\n\n    window.removeEventListener('resize', this.handleWindowResize);\n  };\n\n  render() {\n    const { canvasHeight } = this.state;\n    return (\n      <StyledMain>\n        <Canvas height={canvasHeight} ref={this.canvas} />\n      </StyledMain>\n    );\n  }\n}\n\nconst StyledMain = styled.div`\n  flex: auto;\n`;\n\nconst Canvas = styled.canvas.attrs(({ height }) => ({\n  style: { height },\n}))`\n  width: 100%;\n  background-color: #222f3e;\n`;\n\nexport default Main;\n","export default __webpack_public_path__ + \"img/github-icon.e1201fcc.svg\";","// Footer.jsx\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport styled from 'styled-components';\n\nimport EmailIcon from '../../img/email-icon.svg';\nimport GithubIcon from '../../img/github-icon.svg';\n\nconst githubBaseUrl = 'https://github.com/bill42362/portfolio';\n\nexport class Footer extends React.PureComponent {\n  render() {\n    const { email, branchName } = this.props;\n    const githubUrl = branchName\n      ? `${githubBaseUrl}/tree/${branchName}`\n      : githubBaseUrl;\n    return (\n      <StyledFooter>\n        <Link href={githubUrl} target=\"_blank\">\n          <img src={GithubIcon} alt=\"github\" />\n        </Link>\n        <Link href={`mailto:${email}`} target=\"_blank\">\n          <img src={EmailIcon} alt=\"email\" />\n        </Link>\n      </StyledFooter>\n    );\n  }\n}\n\nFooter.propTypes = {\n  email: PropTypes.string,\n  branchName: PropTypes.string,\n};\n\nFooter.defaultProps = {\n  email: 'bill42362@gmail.com',\n  branchName: '',\n};\n\nconst StyledFooter = styled.div`\n  flex: none;\n  display: flex;\n  justify-content: center;\n  align-items: flex-end;\n  padding: 20px;\n`;\n\nconst Link = styled.a`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  border-radius: 50%;\n  width: 36px;\n  height: 36px;\n  background-color: #576574;\n\n  & + & {\n    margin-left: 8px;\n  }\n  img {\n    width: 60%;\n    height: auto;\n  }\n`;\n\nexport default Footer;\n","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBkPSJNNDY3LDYxSDQ1QzIwLjIxOCw2MSwwLDgxLjE5NiwwLDEwNnYzMDBjMCwyNC43MiwyMC4xMjgsNDUsNDUsNDVoNDIyYzI0LjcyLDAsNDUtMjAuMTI4LDQ1LTQ1VjEwNiBDNTEyLDgxLjI4LDQ5MS44NzIsNjEsNDY3LDYxeiBNNDYwLjc4Niw5MUwyNTYuOTU0LDI5NC44MzNMNTEuMzU5LDkxSDQ2MC43ODZ6IE0zMCwzOTkuNzg4VjExMi4wNjlsMTQ0LjQ3OSwxNDMuMjRMMzAsMzk5Ljc4OHogTTUxLjIxMyw0MjFsMTQ0LjU3LTE0NC41N2w1MC42NTcsNTAuMjIyYzUuODY0LDUuODE0LDE1LjMyNyw1Ljc5NSwyMS4xNjctMC4wNDZMMzE3LDI3Ny4yMTNMNDYwLjc4Nyw0MjFINTEuMjEzeiBNNDgyLDM5OS43ODcgTDMzOC4yMTMsMjU2TDQ4MiwxMTIuMjEyVjM5OS43ODd6Ii8+PC9zdmc+\"","// index.js\n'use strict';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './component/App.jsx';\n\nReactDOM.render(<App />, document.getElementById('app-root'));\n"],"sourceRoot":""}